/* esm.sh - esbuild bundle(axios@1.6.2/unsafe/helpers/AxiosTransformStream) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import z from"node:stream";import S from"/v135/axios@1.6.2/denonext/unsafe/utils.js";import w from"/v135/axios@1.6.2/denonext/unsafe/helpers/throttle.js";import W from"/v135/axios@1.6.2/denonext/unsafe/helpers/speedometer.js";var b=Symbol("internals"),p=class extends z.Transform{constructor(t){t=S.toFlatObject(t,{maxRate:0,chunkSize:64*1024,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(m,n)=>!S.isUndefined(n[m])),super({readableHighWaterMark:t.chunkSize});let c=this,s=this[b]={length:t.length,timeWindow:t.timeWindow,ticksRate:t.ticksRate,chunkSize:t.chunkSize,maxRate:t.maxRate,minChunkSize:t.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null},k=W(s.ticksRate*t.samplesCount,s.timeWindow);this.on("newListener",m=>{m==="progress"&&(s.isCaptured||(s.isCaptured=!0))});let e=0;s.updateProgress=w(function(){let n=s.length,a=s.bytesSeen,d=a-e;if(!d||c.destroyed)return;let h=k(d);e=a,__Process$.nextTick(()=>{c.emit("progress",{loaded:a,total:n,progress:n?a/n:void 0,bytes:d,rate:h||void 0,estimated:h&&n&&a<=n?(n-a)/h:void 0})})},s.ticksRate);let f=()=>{s.updateProgress(!0)};this.once("end",f),this.once("error",f)}_read(t){let c=this[b];return c.onReadCallback&&c.onReadCallback(),super._read(t)}_transform(t,c,s){let k=this,e=this[b],f=e.maxRate,m=this.readableHighWaterMark,n=e.timeWindow,a=1e3/n,d=f/a,h=e.minChunkSize!==!1?Math.max(e.minChunkSize,d*.01):0;function x(r,i){let o=__Buffer$.byteLength(r);e.bytesSeen+=o,e.bytes+=o,e.isCaptured&&e.updateProgress(),k.push(r)?__Process$.nextTick(i):e.onReadCallback=()=>{e.onReadCallback=null,__Process$.nextTick(i)}}let g=(r,i)=>{let o=__Buffer$.byteLength(r),y=null,l=m,u,C=0;if(f){let R=Date.now();(!e.ts||(C=R-e.ts)>=n)&&(e.ts=R,u=d-e.bytes,e.bytes=u<0?-u:0,C=0),u=d-e.bytes}if(f){if(u<=0)return setTimeout(()=>{i(null,r)},n-C);u<l&&(l=u)}l&&o>l&&o-l>h&&(y=r.subarray(l),r=r.subarray(0,l)),x(r,y?()=>{__Process$.nextTick(i,null,y)}:i)};g(t,function r(i,o){if(i)return s(i);o?g(o,r):s(null)})}setLength(t){return this[b].length=+t,this}},P=p;export{P as default};

import "https://deno.land/x/xhr@0.3.0/mod.ts";//# sourceMappingURL=AxiosTransformStream.js.map