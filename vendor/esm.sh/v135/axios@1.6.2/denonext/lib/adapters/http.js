/* esm.sh - esbuild bundle(axios@1.6.2/lib/adapters/http) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import i from"/v135/axios@1.6.2/denonext/unsafe/utils.js";import H from"/v135/axios@1.6.2/denonext/unsafe/core/settle.js";import ae from"/v135/axios@1.6.2/denonext/unsafe/core/buildFullPath.js";import ne from"/v135/axios@1.6.2/denonext/unsafe/helpers/buildURL.js";import{getProxyForUrl as ie}from"/v135/proxy-from-env@1.1.0/denonext/proxy-from-env.mjs";import le from"node:http";import me from"node:https";import ue from"node:util";import de from"/v135/follow-redirects@1.15.3/denonext/follow-redirects.mjs";import B from"node:zlib";import{VERSION as J}from"/v135/axios@1.6.2/denonext/unsafe/env/data.js";import pe from"/v135/axios@1.6.2/denonext/unsafe/defaults/transitional.js";import l from"/v135/axios@1.6.2/denonext/unsafe/core/AxiosError.js";import W from"/v135/axios@1.6.2/denonext/unsafe/cancel/CanceledError.js";import he from"/v135/axios@1.6.2/denonext/unsafe/platform.js";import fe from"/v135/axios@1.6.2/denonext/unsafe/helpers/fromDataURI.js";import _ from"node:stream";import K from"/v135/axios@1.6.2/denonext/unsafe/core/AxiosHeaders.js";import X from"/v135/axios@1.6.2/denonext/unsafe/helpers/AxiosTransformStream.js";import ce from"node:events";import be from"/v135/axios@1.6.2/denonext/unsafe/helpers/formDataToStream.js";import Re from"/v135/axios@1.6.2/denonext/unsafe/helpers/readBlob.js";import ye from"/v135/axios@1.6.2/denonext/unsafe/helpers/ZlibHeaderTransformStream.js";import xe from"/v135/axios@1.6.2/denonext/unsafe/helpers/callbackify.js";var j={flush:B.constants.Z_SYNC_FLUSH,finishFlush:B.constants.Z_SYNC_FLUSH},Ee={flush:B.constants.BROTLI_OPERATION_FLUSH,finishFlush:B.constants.BROTLI_OPERATION_FLUSH},ee=i.isFunction(B.createBrotliDecompress),{http:we,https:Be}=de,Se=/https:?/,te=he.protocols.map(o=>o+":");function Le(o){o.beforeRedirects.proxy&&o.beforeRedirects.proxy(o),o.beforeRedirects.config&&o.beforeRedirects.config(o)}function V(o,e,U){let a=e;if(!a&&a!==!1){let n=ie(U);n&&(a=new URL(n))}if(a){if(a.username&&(a.auth=(a.username||"")+":"+(a.password||"")),a.auth){(a.auth.username||a.auth.password)&&(a.auth=(a.auth.username||"")+":"+(a.auth.password||""));let x=__Buffer$.from(a.auth,"utf8").toString("base64");o.headers["Proxy-Authorization"]="Basic "+x}o.headers.host=o.hostname+(o.port?":"+o.port:"");let n=a.hostname||a.host;o.hostname=n,o.host=n,o.port=a.port,o.path=U,a.protocol&&(o.protocol=a.protocol.includes(":")?a.protocol:`${a.protocol}:`)}o.beforeRedirects.proxy=function(x){V(x,e,x.href)}}var Te=typeof __Process$<"u"&&i.kindOf(__Process$)==="process",Ae=o=>new Promise((e,U)=>{let a,n,x=(c,S)=>{n||(n=!0,a&&a(c,S))},s=c=>{x(c),e(c)},E=c=>{x(c,!0),U(c)};o(s,E,c=>a=c).catch(E)}),_e=({address:o,family:e})=>{if(!i.isString(o))throw TypeError("address must be a string");return{address:o,family:e||(o.indexOf(".")<0?6:4)}},re=(o,e)=>_e(i.isObject(o)?o:{address:o,family:e}),Xe=Te&&function(e){return Ae(async function(a,n,x){let{data:s,lookup:E,family:c}=e,{responseType:S,responseEncoding:T}=e,z=e.method.toUpperCase(),Y,q=!1,m;if(E){let t=xe(E,r=>i.isArray(r)?r:[r]);E=(r,u,A)=>{t(r,u,(d,w,Q)=>{let y=i.isArray(w)?w.map(R=>re(R)):[re(w,Q)];u.all?A(d,y):A(d,y[0].address,y[0].family)})}}let D=new ce,$=()=>{e.cancelToken&&e.cancelToken.unsubscribe(L),e.signal&&e.signal.removeEventListener("abort",L),D.removeAllListeners()};x((t,r)=>{Y=!0,r&&(q=!0,$())});function L(t){D.emit("abort",!t||t.type?new W(null,e,m):t)}D.once("abort",n),(e.cancelToken||e.signal)&&(e.cancelToken&&e.cancelToken.subscribe(L),e.signal&&(e.signal.aborted?L():e.signal.addEventListener("abort",L)));let se=ae(e.baseURL,e.url),b=new URL(se,"http://localhost"),P=b.protocol||te[0];if(P==="data:"){let t;if(z!=="GET")return H(a,n,{status:405,statusText:"method not allowed",headers:{},config:e});try{t=fe(e.url,S==="blob",{Blob:e.env&&e.env.Blob})}catch(r){throw l.from(r,l.ERR_BAD_REQUEST,e)}return S==="text"?(t=t.toString(T),(!T||T==="utf8")&&(t=i.stripBOM(t))):S==="stream"&&(t=_.Readable.from(t)),H(a,n,{data:t,status:200,statusText:"OK",headers:new K,config:e})}if(te.indexOf(P)===-1)return n(new l("Unsupported protocol "+P,l.ERR_BAD_REQUEST,e));let f=K.from(e.headers).normalize();f.set("User-Agent","axios/"+J,!1);let I=e.onDownloadProgress,g=e.onUploadProgress,C=e.maxRate,F,M;if(i.isSpecCompliantForm(s)){let t=f.getContentType(/boundary=([-_\w\d]{10,70})/i);s=be(s,r=>{f.set(r)},{tag:`axios-${J}-boundary`,boundary:t&&t[1]||void 0})}else if(i.isFormData(s)&&i.isFunction(s.getHeaders)){if(f.set(s.getHeaders()),!f.hasContentLength())try{let t=await ue.promisify(s.getLength).call(s);Number.isFinite(t)&&t>=0&&f.setContentLength(t)}catch{}}else if(i.isBlob(s))s.size&&f.setContentType(s.type||"application/octet-stream"),f.setContentLength(s.size||0),s=_.Readable.from(Re(s));else if(s&&!i.isStream(s)){if(!__Buffer$.isBuffer(s))if(i.isArrayBuffer(s))s=__Buffer$.from(new Uint8Array(s));else if(i.isString(s))s=__Buffer$.from(s,"utf-8");else return n(new l("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",l.ERR_BAD_REQUEST,e));if(f.setContentLength(s.length,!1),e.maxBodyLength>-1&&s.length>e.maxBodyLength)return n(new l("Request body larger than maxBodyLength limit",l.ERR_BAD_REQUEST,e))}let oe=i.toFiniteNumber(f.getContentLength());i.isArray(C)?(F=C[0],M=C[1]):F=M=C,s&&(g||F)&&(i.isStream(s)||(s=_.Readable.from(s,{objectMode:!1})),s=_.pipeline([s,new X({length:oe,maxRate:i.toFiniteNumber(F)})],i.noop),g&&s.on("progress",t=>{g(Object.assign(t,{upload:!0}))}));let O;if(e.auth){let t=e.auth.username||"",r=e.auth.password||"";O=t+":"+r}if(!O&&b.username){let t=b.username,r=b.password;O=t+":"+r}O&&f.delete("authorization");let G;try{G=ne(b.pathname+b.search,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(t){let r=new Error(t.message);return r.config=e,r.url=e.url,r.exists=!0,n(r)}f.set("Accept-Encoding","gzip, compress, deflate"+(ee?", br":""),!1);let h={path:G,method:z,headers:f.toJSON(),agents:{http:e.httpAgent,https:e.httpsAgent},auth:O,protocol:P,family:c,beforeRedirect:Le,beforeRedirects:{}};!i.isUndefined(E)&&(h.lookup=E),e.socketPath?h.socketPath=e.socketPath:(h.hostname=b.hostname,h.port=b.port,V(h,e.proxy,P+"//"+b.hostname+(b.port?":"+b.port:"")+h.path));let N,v=Se.test(h.protocol);if(h.agent=v?e.httpsAgent:e.httpAgent,e.transport?N=e.transport:e.maxRedirects===0?N=v?me:le:(e.maxRedirects&&(h.maxRedirects=e.maxRedirects),e.beforeRedirect&&(h.beforeRedirects.config=e.beforeRedirect),N=v?Be:we),e.maxBodyLength>-1?h.maxBodyLength=e.maxBodyLength:h.maxBodyLength=1/0,e.insecureHTTPParser&&(h.insecureHTTPParser=e.insecureHTTPParser),m=N.request(h,function(r){if(m.destroyed)return;let u=[r],A=+r.headers["content-length"];if(I){let R=new X({length:i.toFiniteNumber(A),maxRate:i.toFiniteNumber(M)});I&&R.on("progress",k=>{I(Object.assign(k,{download:!0}))}),u.push(R)}let d=r,w=r.req||m;if(e.decompress!==!1&&r.headers["content-encoding"])switch((z==="HEAD"||r.statusCode===204)&&delete r.headers["content-encoding"],(r.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":u.push(B.createUnzip(j)),delete r.headers["content-encoding"];break;case"deflate":u.push(new ye),u.push(B.createUnzip(j)),delete r.headers["content-encoding"];break;case"br":ee&&(u.push(B.createBrotliDecompress(Ee)),delete r.headers["content-encoding"])}d=u.length>1?_.pipeline(u,i.noop):u[0];let Q=_.finished(d,()=>{Q(),$()}),y={status:r.statusCode,statusText:r.statusMessage,headers:new K(r.headers),config:e,request:w};if(S==="stream")y.data=d,H(a,n,y);else{let R=[],k=0;d.on("data",function(p){R.push(p),k+=p.length,e.maxContentLength>-1&&k>e.maxContentLength&&(q=!0,d.destroy(),n(new l("maxContentLength size of "+e.maxContentLength+" exceeded",l.ERR_BAD_RESPONSE,e,w)))}),d.on("aborted",function(){if(q)return;let p=new l("maxContentLength size of "+e.maxContentLength+" exceeded",l.ERR_BAD_RESPONSE,e,w);d.destroy(p),n(p)}),d.on("error",function(p){m.destroyed||n(l.from(p,null,e,w))}),d.on("end",function(){try{let p=R.length===1?R[0]:__Buffer$.concat(R);S!=="arraybuffer"&&(p=p.toString(T),(!T||T==="utf8")&&(p=i.stripBOM(p))),y.data=p}catch(p){return n(l.from(p,null,e,y.request,y))}H(a,n,y)})}D.once("abort",R=>{d.destroyed||(d.emit("error",R),d.destroy())})}),D.once("abort",t=>{n(t),m.destroy(t)}),m.on("error",function(r){n(l.from(r,null,e,m))}),m.on("socket",function(r){r.setKeepAlive(!0,1e3*60)}),e.timeout){let t=parseInt(e.timeout,10);if(Number.isNaN(t)){n(new l("error trying to parse `config.timeout` to int",l.ERR_BAD_OPTION_VALUE,e,m));return}m.setTimeout(t,function(){if(Y)return;let u=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",A=e.transitional||pe;e.timeoutErrorMessage&&(u=e.timeoutErrorMessage),n(new l(u,A.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,e,m)),L()})}if(i.isStream(s)){let t=!1,r=!1;s.on("end",()=>{t=!0}),s.once("error",u=>{r=!0,m.destroy(u)}),s.on("close",()=>{!t&&!r&&L(new W("Request stream has been aborted",e,m))}),s.pipe(m)}else m.end(s)})},je=V;export{je as __setProxy,Xe as default};

import "https://deno.land/x/xhr@0.3.0/mod.ts";//# sourceMappingURL=http.js.map