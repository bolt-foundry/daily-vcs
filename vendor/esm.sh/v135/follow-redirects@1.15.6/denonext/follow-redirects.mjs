/* esm.sh - esbuild bundle(follow-redirects@1.15.6) denonext production */
import * as __0$ from "node:url";
import * as __1$ from "node:http";
import * as __2$ from "node:https";
import * as __3$ from "node:stream";
import * as __4$ from "node:assert";
import * as __5$ from "/v135/debug@4.3.4/denonext/debug.mjs";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"url":return e(__0$);case"http":return e(__1$);case"https":return e(__2$);case"stream":return e(__3$);case"assert":return e(__4$);case"debug":return e(__5$);default:throw new Error("module \""+n+"\" not found");}};
var Y=Object.create;var L=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var Q=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var m=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var P=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),k=(e,t)=>{for(var r in t)L(e,r,{get:t[r],enumerable:!0})},w=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of J(t))!Z.call(e,s)&&s!==r&&L(e,s,{get:()=>t[s],enumerable:!(o=K(t,s))||o.enumerable});return e},l=(e,t,r)=>(w(e,t,"default"),r&&w(r,t,"default")),S=(e,t,r)=>(r=e!=null?Y(Q(e)):{},w(t||!e||!e.__esModule?L(r,"default",{value:e,enumerable:!0}):r,e));var M=P((pe,F)=>{var v;F.exports=function(){if(!v){try{v=m("debug")("follow-redirects")}catch{}typeof v!="function"&&(v=function(){})}v.apply(null,arguments)}});var C=P((me,D)=>{var q=m("url"),R=q.URL,ee=m("http"),te=m("https"),B=m("stream").Writable,O=m("assert"),W=M(),H=!1;try{O(new R)}catch(e){H=e.code==="ERR_INVALID_URL"}var re=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],j=["abort","aborted","connect","error","socket","timeout"],N=Object.create(null);j.forEach(function(e){N[e]=function(t,r,o){this._redirectable.emit(e,t,r,o)}});var U=g("ERR_INVALID_URL","Invalid URL",TypeError),T=g("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),oe=g("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",T),se=g("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),ie=g("ERR_STREAM_WRITE_AFTER_END","write after end"),ne=B.prototype.destroy||z;function a(e,t){B.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var r=this;this._onNativeResponse=function(o){try{r._processResponse(o)}catch(s){r.emit("error",s instanceof T?s:new T({cause:s}))}},this._performRequest()}a.prototype=Object.create(B.prototype);a.prototype.abort=function(){I(this._currentRequest),this._currentRequest.abort(),this.emit("abort")};a.prototype.destroy=function(e){return I(this._currentRequest,e),ne.call(this,e),this};a.prototype.write=function(e,t,r){if(this._ending)throw new ie;if(!p(e)&&!ae(e))throw new TypeError("data should be a string, Buffer or Uint8Array");if(y(t)&&(r=t,t=null),e.length===0){r&&r();return}this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,r)):(this.emit("error",new se),this.abort())};a.prototype.end=function(e,t,r){if(y(e)?(r=e,e=t=null):y(t)&&(r=t,t=null),!e)this._ended=this._ending=!0,this._currentRequest.end(null,null,r);else{var o=this,s=this._currentRequest;this.write(e,t,function(){o._ended=!0,s.end(null,null,r)}),this._ending=!0}};a.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)};a.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)};a.prototype.setTimeout=function(e,t){var r=this;function o(u){u.setTimeout(e),u.removeListener("timeout",u.destroy),u.addListener("timeout",u.destroy)}function s(u){r._timeout&&clearTimeout(r._timeout),r._timeout=setTimeout(function(){r.emit("timeout"),h()},e),o(u)}function h(){r._timeout&&(clearTimeout(r._timeout),r._timeout=null),r.removeListener("abort",h),r.removeListener("error",h),r.removeListener("response",h),r.removeListener("close",h),t&&r.removeListener("timeout",t),r.socket||r._currentRequest.removeListener("socket",s)}return t&&this.on("timeout",t),this.socket?s(this.socket):this._currentRequest.once("socket",s),this.on("socket",o),this.on("abort",h),this.on("error",h),this.on("response",h),this.on("close",h),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(e){a.prototype[e]=function(t,r){return this._currentRequest[e](t,r)}});["aborted","connection","socket"].forEach(function(e){Object.defineProperty(a.prototype,e,{get:function(){return this._currentRequest[e]}})});a.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}};a.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t)throw new TypeError("Unsupported protocol "+e);if(this._options.agents){var r=e.slice(0,-1);this._options.agent=this._options.agents[r]}var o=this._currentRequest=t.request(this._options,this._onNativeResponse);o._redirectable=this;for(var s of j)o.on(s,N[s]);if(this._currentUrl=/^\//.test(this._options.path)?q.format(this._options):this._options.path,this._isRedirect){var h=0,u=this,f=this._requestBodyBuffers;(function d(n){if(o===u._currentRequest)if(n)u.emit("error",n);else if(h<f.length){var i=f[h++];o.finished||o.write(i.data,i.encoding,d)}else u._ended&&o.end()})()}};a.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var r=e.headers.location;if(!r||this._options.followRedirects===!1||t<300||t>=400){e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),this._requestBodyBuffers=[];return}if(I(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects)throw new oe;var o,s=this._options.beforeRedirect;s&&(o=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var h=this._options.method;((t===301||t===302)&&this._options.method==="POST"||t===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],b(/^content-/i,this._options.headers));var u=b(/^host$/i,this._options.headers),f=A(this._currentUrl),d=u||f.host,n=/^\w+:/.test(r)?this._currentUrl:q.format(Object.assign(f,{host:d})),i=he(r,n);if(W("redirecting to",i.href),this._isRedirect=!0,x(i,this._options),(i.protocol!==f.protocol&&i.protocol!=="https:"||i.host!==d&&!ue(i.host,d))&&b(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers),y(s)){var _={headers:e.headers,statusCode:t},E={url:n,method:h,headers:o};s(this._options,_,E),this._sanitizeOptions(this._options)}this._performRequest()};function $(e){var t={maxRedirects:21,maxBodyLength:10485760},r={};return Object.keys(e).forEach(function(o){var s=o+":",h=r[s]=e[o],u=t[o]=Object.create(h);function f(n,i,_){return fe(n)?n=x(n):p(n)?n=x(A(n)):(_=i,i=G(n),n={protocol:s}),y(i)&&(_=i,i=null),i=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},n,i),i.nativeProtocols=r,!p(i.host)&&!p(i.hostname)&&(i.hostname="::1"),O.equal(i.protocol,s,"protocol mismatch"),W("options",i),new a(i,_)}function d(n,i,_){var E=u.request(n,i,_);return E.end(),E}Object.defineProperties(u,{request:{value:f,configurable:!0,enumerable:!0,writable:!0},get:{value:d,configurable:!0,enumerable:!0,writable:!0}})}),t}function z(){}function A(e){var t;if(H)t=new R(e);else if(t=G(q.parse(e)),!p(t.protocol))throw new U({input:e});return t}function he(e,t){return H?new R(e,t):A(q.resolve(t,e))}function G(e){if(/^\[/.test(e.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(e.hostname))throw new U({input:e.href||e});if(/^\[/.test(e.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(e.host))throw new U({input:e.href||e});return e}function x(e,t){var r=t||{};for(var o of re)r[o]=e[o];return r.hostname.startsWith("[")&&(r.hostname=r.hostname.slice(1,-1)),r.port!==""&&(r.port=Number(r.port)),r.path=r.search?r.pathname+r.search:r.pathname,r}function b(e,t){var r;for(var o in t)e.test(o)&&(r=t[o],delete t[o]);return r===null||typeof r>"u"?void 0:String(r).trim()}function g(e,t,r){function o(s){Error.captureStackTrace(this,this.constructor),Object.assign(this,s||{}),this.code=e,this.message=this.cause?t+": "+this.cause.message:t}return o.prototype=new(r||Error),Object.defineProperties(o.prototype,{constructor:{value:o,enumerable:!1},name:{value:"Error ["+e+"]",enumerable:!1}}),o}function I(e,t){for(var r of j)e.removeListener(r,N[r]);e.on("error",z),e.destroy(t)}function ue(e,t){O(p(e)&&p(t));var r=e.length-t.length-1;return r>0&&e[r]==="."&&e.endsWith(t)}function p(e){return typeof e=="string"||e instanceof String}function y(e){return typeof e=="function"}function ae(e){return typeof e=="object"&&"length"in e}function fe(e){return R&&e instanceof R}D.exports=$({http:ee,https:te});D.exports.wrap=$});var c={};k(c,{default:()=>_e,wrap:()=>ce});var X=S(C());l(c,S(C()));var{wrap:ce}=X,{default:V,...de}=X,_e=V!==void 0?V:de;export{_e as default,ce as wrap};
//# sourceMappingURL=follow-redirects.mjs.map