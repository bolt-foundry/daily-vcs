/* esm.sh - esbuild bundle(@envelop/core@5.0.0) denonext production */
export*from"/v135/@envelop/types@5.0.0/denonext/types.mjs";var v=new WeakMap;function z(e,t){let n=v.get(e);return!n&&t&&(n=t(e),v.set(e,n)),n}var C=Symbol("ENVELOP_IS_INTROSPECTION");function A(e){return(typeof e=="string"?e:e.body).indexOf("__schema")!==-1}function J(e){return e.length===1?e[0]:{schema:e[0],document:e[1],rootValue:e[2],contextValue:e[3],variableValues:e[4],operationName:e[5],fieldResolver:e[6],subscribeFieldResolver:e[7]}}var F=e=>(...t)=>e(J(t));function P(e,t){let n=e[Symbol.asyncIterator]();async function r(f){if(f.done)return f;try{return{value:await t(f.value),done:!1}}catch(E){try{await n.return?.()}catch{}throw E}}let c={[Symbol.asyncIterator](){return c},async next(){return await r(await n.next())},async return(){let f=n.return?.();return f?await r(await f):{value:void 0,done:!0}},async throw(f){let E=n.throw?.();if(E)return await r(await E);throw f}};return c}function W(e){return e.length===1?e[0]:{schema:e[0],document:e[1],rootValue:e[2],contextValue:e[3],variableValues:e[4],operationName:e[5],fieldResolver:e[6],typeResolver:e[7]}}var V=e=>(...t)=>e(W(t));function y(e){return typeof e=="object"&&e!=null&&typeof e[Symbol.asyncIterator]=="function"}function S(e,t){if(y(e.result))return{onNext:t};t({args:e.args,result:e.result,setResult:e.setResult})}function N(e,t){let n=e[Symbol.asyncIterator](),r=!1,c={[Symbol.asyncIterator](){return c},async next(){let f=await n.next();return f.done&&r===!1&&(r=!0,t()),f},async return(){let f=n.return?.();return r===!1&&(r=!0,t()),f?await f:{done:!0,value:void 0}},async throw(f){let E=n.throw?.();if(E)return await E;throw f}};return c}function _(e,t){let n=e[Symbol.asyncIterator](),r={[Symbol.asyncIterator](){return r},async next(){try{return await n.next()}catch(c){return t(c),{done:!0,value:void 0}}},async return(){let c=n.return?.();return c?await c:{done:!0,value:void 0}},async throw(c){let f=n.throw?.();if(f)return await f;throw c}};return r}function O(e){throw Error(`No \`${e}\` function found! Register it using "useEngine" plugin.`)}function H({plugins:e}){let t=null,n=!1,r=()=>O("parse"),c=()=>O("validate"),f=()=>O("execute"),E=()=>O("subscribe"),R=(l,p=-1)=>{if(t=l,n)for(let[a,o]of e.entries())a!==p&&o.onSchemaChange&&o.onSchemaChange({schema:t,replaceSchema:b=>{R(b,a)}})},D=[];for(let l=0;l<e.length;l++){let p=e[l],a=[];p.onPluginInit&&p.onPluginInit({plugins:e,addPlugin:o=>{a.push(o)},setSchema:o=>R(o,l),registerContextErrorHandler:o=>D.push(o)}),a.length&&e.splice(l+1,0,...a)}let m={init:[],parse:[],validate:[],subscribe:[],execute:[],context:[]};for(let{onContextBuilding:l,onExecute:p,onParse:a,onSubscribe:o,onValidate:b,onEnveloped:u}of e)u&&m.init.push(u),l&&m.context.push(l),p&&m.execute.push(p),a&&m.parse.push(a),o&&m.subscribe.push(o),b&&m.validate.push(b);let G=l=>{for(let[p,a]of m.init.entries())a({context:l,extendContext:o=>{l&&Object.assign(l,o)},setSchema:o=>R(o,p)})},B=m.parse.length?l=>(p,a)=>{let o=null,b=r,u=l,d=[];for(let x of m.parse){let i=x({context:u,extendContext:s=>{Object.assign(u,s)},params:{source:p,options:a},parseFn:b,setParseFn:s=>{b=s},setParsedDocument:s=>{o=s}});i&&d.push(i)}if(o===null)try{o=b(p,a)}catch(x){o=x}for(let x of d)x({context:u,extendContext:i=>{Object.assign(u,i)},replaceParseResult:i=>{o=i},result:o});if(o===null)throw new Error("Failed to parse document.");if(o instanceof Error)throw o;return v.set(o,p.toString()),o}:()=>r,Q=m.validate.length?l=>(p,a,o,b,u)=>{let d=o?[...o]:void 0,x=c,i=null,s=l,h=[];for(let k of m.validate){let w=k({context:s,extendContext:g=>{Object.assign(s,g)},params:{schema:p,documentAST:a,rules:d,typeInfo:b,options:u},validateFn:x,addValidationRule:g=>{d||(d=[]),d.push(g)},setValidationFn:g=>{x=g},setResult:g=>{i=g}});w&&h.push(w)}if(i||(i=x(p,a,d,b,u)),!i)return;let I=i.length===0;for(let k of h)k({valid:I,result:i,context:s,extendContext:w=>{Object.assign(s,w)},setResult:w=>{i=w}});return i}:()=>c,T=m.context.length?l=>async p=>{let a=[],o=l;p&&Object.assign(o,p);try{let b=!1;for(let u of m.context){let d=await u({context:o,extendContext:x=>{Object.assign(o,x)},breakContextBuilding:()=>{b=!0}});if(typeof d=="function"&&a.push(d),b===!0)break}for(let u of a)u({context:o,extendContext:d=>{Object.assign(o,d)}});return o}catch(b){let u=b;for(let d of D)d({context:o,error:u,setError:x=>{u=x}});throw u}}:l=>p=>(p&&Object.assign(l,p),l),U=m.subscribe.length?F(async l=>{let p=E,a=[],o=[],b=l.contextValue||{},u;for(let i of m.subscribe){let s=await i({subscribeFn:p,setSubscribeFn:h=>{p=h},extendContext:h=>{Object.assign(b,h)},args:l,setResultAndStopExecution:h=>{u=h}});if(s&&(s.onSubscribeResult&&a.push(s.onSubscribeResult),s.onSubscribeError&&o.push(s.onSubscribeError)),u!==void 0)break}if(u===void 0&&(u=await p({...l,contextValue:b})),!u)return;let d=[],x=[];for(let i of a){let s=i({args:l,result:u,setResult:h=>{u=h}});s&&(s.onNext&&d.push(s.onNext),s.onEnd&&x.push(s.onEnd))}return d.length&&y(u)&&(u=P(u,async i=>{for(let s of d)await s({args:l,result:i,setResult:h=>i=h});return i})),x.length&&y(u)&&(u=N(u,()=>{for(let i of x)i()})),o.length&&y(u)&&(u=_(u,i=>{let s=i;for(let h of o)h({error:s,setError:I=>{s=I}});throw s})),u}):F(E),$=m.execute.length?V(async l=>{let p=f,a,o=[],b=l.contextValue||{};for(let x of m.execute){let i=await x({executeFn:p,setExecuteFn:s=>{p=s},setResultAndStopExecution:s=>{a=s},extendContext:s=>{if(typeof s=="object")Object.assign(b,s);else throw new Error(`Invalid context extension provided! Expected "object", got: "${JSON.stringify(s)}" (${typeof s})`)},args:l});if(i?.onExecuteDone&&o.push(i.onExecuteDone),a!==void 0)break}a===void 0&&(a=await p({...l,contextValue:b}));let u=[],d=[];for(let x of o){let i=await x({args:l,result:a,setResult:s=>{a=s}});i&&(i.onNext&&u.push(i.onNext),i.onEnd&&d.push(i.onEnd))}return u.length&&y(a)&&(a=P(a,async x=>{for(let i of u)await i({args:l,result:x,setResult:s=>{x=s}});return x})),d.length&&y(a)&&(a=N(a,()=>{for(let x of d)x()})),a}):V(f);if(n=!0,t)for(let[l,p]of e.entries())p.onSchemaChange&&p.onSchemaChange({schema:t,replaceSchema:a=>R(a,l)});return{getCurrentSchema(){return t},init:G,parse:B,validate:Q,execute:$,subscribe:U,contextFactory:T}}function q(e){return e!=null}function pe(e){let t=e.plugins.filter(q),n=H({plugins:t}),r=(c={})=>{let f=n;return f.init(c),{parse:f.parse(c),validate:f.validate(c),contextFactory:f.contextFactory(c),execute:f.execute,subscribe:f.subscribe,schema:f.getCurrentSchema()}};return r._plugins=t,r}var de=e=>{let t=!1;return{onPluginInit({addPlugin:n}){if(!t){for(let r of e._plugins)n(r);t=!0}}}};var L={logFn:console.log},he=(e=L)=>{let t={DEFAULT_OPTIONS:L,...e};return{onParse({extendContext:n,params:r}){t.skipIntrospection&&A(r.source)&&n({[C]:!0})},onExecute({args:n}){if(!n.contextValue[C])return t.logFn("execute-start",{args:n}),{onExecuteDone:({result:r})=>{t.logFn("execute-end",{args:n,result:r})}}},onSubscribe({args:n}){if(!n.contextValue[C])return t.logFn("subscribe-start",{args:n}),{onSubscribeResult:({result:r})=>{t.logFn("subscribe-end",{args:n,result:r})}}}}};var Se=e=>({onPluginInit({setSchema:t}){t(e)}}),ge=e=>({onEnveloped({setSchema:t,context:n}){t(e(n))}});var K="Unexpected error.";function j(e){return e instanceof Error&&e.name==="GraphQLError"}function M(e){return j(e)?e.originalError!=null?M(e.originalError):!0:!1}function X(e,t,n){let r=new Error(e);if(r.name="GraphQLError",n){let c=t instanceof Error?{message:t.message,stack:t.stack}:{message:String(t)};Object.defineProperty(r,"extensions",{get(){return c}})}return Object.defineProperty(r,"toJSON",{value(){return{message:r.message,extensions:r.extensions}}}),r}var Y=e=>(t,n)=>M(t)?t:X(n,t,e),Z=globalThis.process?.env?.NODE_ENV==="development",ee=Y(Z),te=(e,t)=>({result:n,setResult:r})=>{n.errors!=null&&r({...n,errors:n.errors.map(c=>e(c,t))})};function Re(e){let t=e?.maskError??ee,n=e?.errorMessage||K,r=te(t,n);return{onPluginInit(c){c.registerContextErrorHandler(({error:f,setError:E})=>{E(t(f,n))})},onExecute(){return{onExecuteDone(c){return S(c,r)}}},onSubscribe(){return{onSubscribeResult(c){return S(c,r)},onSubscribeError({error:c,setError:f}){f(t(c,n))}}}}}var ne=e=>({result:t,args:n})=>{t.errors?.length&&e({errors:t.errors,context:n,phase:"execution"})},Ie=e=>{let t=ne(e);return{onParse(){return function({result:r,context:c}){r instanceof Error&&e({errors:[r],context:c,phase:"parse"})}},onValidate(){return function({valid:r,result:c,context:f}){r===!1&&c.length>0&&e({errors:c,context:f,phase:"validate"})}},onPluginInit(n){n.registerContextErrorHandler(({error:r})=>{j(r)?e({errors:[r],context:n,phase:"context"}):e({errors:[new Error(r)],context:n,phase:"context"})})},onExecute(){return{onExecuteDone(n){return S(n,t)}}},onSubscribe(){return{onSubscribeResult(n){return S(n,t)}}}}};var Fe=e=>({async onContextBuilding({context:t,extendContext:n}){n(await e(t))}});var re=e=>({args:t,result:n,setResult:r})=>{let c=e(n,t);c!==!1&&r(c)},Ne=e=>({onExecute(){let t=re(e);return{onExecuteDone(n){return S(n,t)}}}});var De=e=>({onExecute:({setExecuteFn:t})=>{e.execute&&t(e.execute)},onParse:({setParseFn:t})=>{e.parse&&t(e.parse)},onValidate:({setValidationFn:t,addValidationRule:n})=>{e.validate&&t(e.validate),e.specifiedRules?.map(n)},onSubscribe:({setSubscribeFn:t})=>{e.subscribe&&t(e.subscribe)}});export{K as DEFAULT_ERROR_MESSAGE,Y as createDefaultMaskError,ee as defaultMaskError,pe as envelop,C as envelopIsIntrospectionSymbol,_ as errorAsyncIterator,N as finalAsyncIterator,z as getDocumentString,S as handleStreamOrSingleExecutionResult,y as isAsyncIterable,j as isGraphQLError,A as isIntrospectionOperationString,M as isOriginalGraphQLError,V as makeExecute,F as makeSubscribe,P as mapAsyncIterator,De as useEngine,de as useEnvelop,Ie as useErrorHandler,Fe as useExtendContext,he as useLogger,Re as useMaskedErrors,Ne as usePayloadFormatter,Se as useSchema,ge as useSchemaByContext};
//# sourceMappingURL=core.mjs.map