/* esm.sh - esbuild bundle(js-tiktoken@1.0.12/lite) denonext production */
import f from"/v135/base64-js@1.5.1/denonext/base64-js.mjs";var w=Object.defineProperty,v=(e,a,t)=>a in e?w(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,m=(e,a,t)=>(v(e,typeof a!="symbol"?a+"":a,t),t);function T(e,a){let t=Array.from({length:e.length},(c,s)=>({start:s,end:s+1}));for(;t.length>1;){let c=null;for(let s=0;s<t.length-1;s++){let n=e.slice(t[s].start,t[s+1].end),i=a.get(n.join(","));i!=null&&(c==null||i<c[0])&&(c=[i,s])}if(c!=null){let s=c[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function _(e,a){return e.length===1?[a.get(e.join(","))]:T(e,a).map(t=>a.get(e.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function y(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var d=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,a){this.patStr=e.pat_str;let t=e.bpe_ranks.split(`
`).filter(Boolean).reduce((c,s)=>{let[n,i,...o]=s.split(" "),p=Number.parseInt(i,10);return o.forEach((r,l)=>c[r]=p+l),c},{});for(let[c,s]of Object.entries(t)){let n=f.toByteArray(c);this.rankMap.set(n.join(","),s),this.textMap.set(s,n)}this.specialTokens={...e.special_tokens,...a},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((c,[s,n])=>(c[n]=this.textEncoder.encode(s),c),{})}encode(e,a=[],t="all"){let c=new RegExp(this.patStr,"ug"),s=d.specialTokenRegex(Object.keys(this.specialTokens)),n=[],i=new Set(a==="all"?Object.keys(this.specialTokens):a),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(r=>!i.has(r)):t);if(o.size>0){let r=d.specialTokenRegex([...o]),l=e.match(r);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let p=0;for(;;){let r=null,l=p;for(;s.lastIndex=l,r=s.exec(e),!(r==null||i.has(r[0]));)l=r.index+1;let h=r?.index??e.length;for(let k of e.substring(p,h).matchAll(c)){let u=this.textEncoder.encode(k[0]),g=this.rankMap.get(u.join(","));if(g!=null){n.push(g);continue}n.push(..._(u,this.rankMap))}if(r==null)break;let x=this.specialTokens[r[0]];n.push(x),p=r.index+r[0].length}return n}decode(e){let a=[],t=0;for(let n=0;n<e.length;++n){let i=e[n],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(a.push(o),t+=o.length)}let c=new Uint8Array(t),s=0;for(let n of a)c.set(n,s),s+=n.length;return this.textDecoder.decode(c)}},b=d;m(b,"specialTokenRegex",e=>new RegExp(e.map(a=>y(a)).join("|"),"g"));function M(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":return"o200k_base";default:throw new Error("Unknown model")}}export{b as Tiktoken,M as getEncodingNameForModel};
//# sourceMappingURL=lite.js.map