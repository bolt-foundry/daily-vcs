/* esm.sh - esbuild bundle(@replit/extensions@1.8.0) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
var u=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});import*as y from"/v135/comlink@4.4.1/denonext/comlink.mjs";import{ChangeSet as M,Text as ne}from"/v135/@codemirror/state@6.4.1/denonext/state.mjs";import{proxy as R}from"/v135/comlink@4.4.1/denonext/comlink.mjs";import{ed25519 as p}from"/v135/@noble/curves@1.4.0/denonext/ed25519.js";import{bytesToHex as $e}from"/v135/@noble/curves@1.4.0/denonext/abstract/utils.js";import*as v from"/v135/@root/asn1@1.0.0/denonext/asn1.mjs";import{toBase64Url as x,toBuffer as Qe}from"/v135/b64u-lite@1.1.0/denonext/b64u-lite.mjs";var $=Object.defineProperty,Q=(e=>typeof u<"u"?u:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof u<"u"?u:t)[r]}):e)(function(e){if(typeof u<"u")return u.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),d=(e,t)=>{for(var r in t)$(e,r,{get:t[r],enumerable:!0})},Y=(e=>(e.File="FILE",e.Directory="DIRECTORY",e))(Y||{}),G=(e=>(e.Create="CREATE",e.Move="MOVE",e.Delete="DELETE",e.Modify="MODIFY",e))(G||{}),X=(e=>(e.Light="light",e.Dark="dark",e))(X||{}),Z=(e=>(e.twitter="twitter",e.github="github",e.linkedin="linkedin",e.website="website",e.youtube="youtube",e.twitch="twitch",e.facebook="facebook",e.discord="discord",e))(Z||{}),ee=(e=>(e.Ready="ready",e.Error="error",e.Loading="loading",e))(ee||{}),i=typeof window<"u"?y.wrap(y.windowEndpoint(self.parent,self,"*")):null,g=y.proxy,K="loading",_=e=>{K=e},te=()=>K,re={};d(re,{copyFile:()=>we,createDir:()=>le,deleteDir:()=>fe,deleteFile:()=>ue,move:()=>he,readDir:()=>de,readFile:()=>ae,watchDir:()=>pe,watchFile:()=>ye,watchTextFile:()=>ge,writeFile:()=>ce});function O(e){let t=[];return e.iterChanges((r,n,o,a,s)=>{let c={from:r};n>r&&(c.to=n),s.length&&(c.insert=s.sliceString(0)),t.push(c)}),t}var oe=class{constructor(e,t){if(this.path=e,this.listeners=t,this.state=null,this.isDisposed=!1,this.dispose=()=>{this.isDisposed=!0},!i)throw new Error("Expected extensionPort");i.watchTextFile(this.path,g({onReady:this.handleReady.bind(this),onChange:this.handleChange.bind(this),onMoveOrDelete:r=>{t.onMoveOrDelete(r)},onError:r=>{t.onError(r)}})).then(r=>{if(this.isDisposed){r();return}this.dispose=()=>{this.isDisposed=!0,r()}})}state;isDisposed;dispose;writeChange(e){if(this.isDisposed)throw new Error("Wrote change on a disposed TextFileWatcher");if(!this.state)throw new Error("Tried to write changes before ready");let t=M.of(e,this.state.localText.length);this.state.localText=t.apply(this.state.localText),this.enqueueChangeSet(t)}getLatestContent(){if(this.isDisposed)throw new Error("Cannot get content of a disposed TextFileWatcher");if(!this.state)throw new Error("Called getLatestContent on an unready TextFileWatcher");return this.state.localText.sliceString(0)}getIsReady(){if(this.isDisposed)throw new Error("Cannot get isReady of a disposed TextFileWatcher");return!!this.state}async handleReady({writeChange:e,initialContent:t}){if(this.isDisposed)return;let r=ne.of((await t).split(`
`));this.state={requestWriteChange:e,localText:r,remoteText:r,unconfirmedChanges:new Set},this.listeners.onReady()}handleChange({changes:e}){if(this.isDisposed)return;if(!this.state)throw new Error("unexpected handleOnChange called before handleOnReady");let t=M.fromJSON(e);this.state.remoteText=t.apply(this.state.remoteText);for(let r of this.state.unconfirmedChanges){let n=r.changes.map(t);t=t.map(r.changes,!0),r.changes=n}this.state.localText=t.apply(this.state.localText),this.listeners.onChange({changes:O(t),latestContent:this.getLatestContent()})}async enqueueChangeSet(e){if(this.isDisposed)throw new Error("Wrote change on a disposed TextFileWatcher");if(!this.state)throw new Error("Tried to write changes before ready");let t={changes:e};this.state.unconfirmedChanges.add(t),await this.state.requestWriteChange(O(t.changes)),this.state.unconfirmedChanges.delete(t),this.state.remoteText=t.changes.apply(this.state.remoteText)}},ie=class{files;constructor(){this.files=new Map}watch(e,t){return this.files.has(e)?this.watchExisting(e,t):this.watchNew(e,t),()=>{let r=this.files.get(e);r&&(r.listeners.delete(t),r.listeners.size===0&&this.dispose(e))}}dispose(e){let t=this.files.get(e);t&&(t.watcher.dispose(),this.files.delete(e))}watchNew(e,t){let r=new oe(e,{onReady:()=>{this.handleReady(e)},onChange:n=>{this.handleChange(e,n)},onMoveOrDelete:n=>{this.handleMoveOrDelete(e,n)},onError:n=>{this.handleError(e,n)}});this.files.set(e,{listeners:new Set([t]),watcher:r})}watchExisting(e,t){let r=this.files.get(e);if(!r)throw new Error("file is not watched");r.listeners.add(t)}handleChange(e,t){let r=this.files.get(e);if(!r)throw new Error("Unexpected change on a non-watched file");if(!r.watcher.getIsReady())throw new Error("Unexpected change on a non-ready file");for(let{onChange:n}of r.listeners)n&&n(t)}handleReady(e){let t=this.files.get(e);if(!t)throw new Error("Unexpected change on a non-watched file");if(!t.watcher.getIsReady())throw new Error("Got ready on a non-ready file :/");let r=t.watcher.getLatestContent();for(let{onReady:n,onChange:o}of t.listeners)n({initialContent:r,getLatestContent:()=>t.watcher.getLatestContent(),writeChange:a=>{t.watcher.writeChange(a);for(let{onChange:s}of t.listeners)o!==s&&s&&s({changes:Array.isArray(a)?a:[a],latestContent:t.watcher.getLatestContent()})}})}handleError(e,t){let r=this.files.get(e);if(!r)throw new Error("Unexpected error on a non-watched file");for(let{onError:n}of r.listeners)n&&n(t);this.dispose(e)}handleMoveOrDelete(e,t){let r=this.files.get(e);if(!r)throw new Error("Unexpected move or delete event on a non-watched file");for(let{onMoveOrDelete:n}of r.listeners)n&&n(t);this.dispose(e)}},se=new ie;async function ae(e,t="utf8"){return i.readFile(e,t)}async function ce(e,t){return i.writeFile(e,t)}async function de(e){return i.readDir(e)}async function le(e){return i.createDir(e)}async function ue(e){return i.deleteFile(e)}async function fe(e){return i.deleteDir(e)}async function he(e,t){return i.move(e,t)}async function we(e,t){return i.copyFile(e,t)}async function ye(e,t,r="binary"){return i.watchFile(e,g({onMoveOrDelete:()=>{},onError:()=>{},...t}),r)}async function pe(e,t){return i.watchDir(e,g({onMoveOrDelete:()=>{},...t}))}function ge(e,t){return se.watch(e,t)}var me={};d(me,{del:()=>be,get:()=>Ee,list:()=>xe,set:()=>ve});async function ve(e){return i.setReplDbValue(e.key,e.value)}async function Ee(e){return i.getReplDbValue(e.key)}async function xe(e={}){return i.listReplDbKeys(e?.prefix||"")}async function be(e){return i.deleteReplDbKey(e.key)}var Ce={};d(Ce,{filePath:()=>Te});function Te(){return i.filePath}var De={};d(De,{getCurrentTheme:()=>Ae,getCurrentThemeValues:()=>ke,onThemeChange:()=>Fe,onThemeChangeValues:()=>Ie});async function Ae(){return await i.getCurrentTheme()}async function ke(){return await i.getCurrentThemeValues()}async function Fe(e){return await i.onThemeChange(R(e))}async function Ie(e){return await i.onThemeChangeValues(R(e))}var We={};d(We,{hideAllMessages:()=>Ke,hideMessage:()=>Be,showConfirm:()=>_e,showError:()=>Me,showNotice:()=>Oe,showWarning:()=>Pe});var _e=async(e,t=4e3)=>{if(typeof e!="string")throw new Error("Messages must be strings");return i.showConfirm(e,t)},Me=async(e,t=4e3)=>{if(typeof e!="string")throw new Error("Messages must be strings");return i.showError(e,t)},Oe=async(e,t=4e3)=>{if(typeof e!="string")throw new Error("Messages must be strings");return i.showNotice(e,t)},Pe=async(e,t=4e3)=>{if(typeof e!="string")throw new Error("Messages must be strings");return i.showWarning(e,t)},Be=async e=>i.hideMessage(e),Ke=async()=>i.hideAllMessages(),Re={};d(Re,{currentRepl:()=>Ue,currentUser:()=>Se,replById:()=>Ne,replByUrl:()=>qe,userById:()=>Le,userByUsername:()=>Je});async function Se(e={}){return await i.currentUser(e)}async function Le(e){if(typeof e.id!="number")throw new Error(`Query parameter "id" must be a number.  Found type ${typeof e.id} instead.`);return await i.userById(e)}async function Je(e){if(typeof e.username!="string")throw new Error(`Query parameter "username" must be a string.  Found type ${typeof e.username} instead.`);return await i.userByUsername(e)}async function Ue(e={}){return await i.currentRepl(e)}async function Ne(e){if(typeof e.id!="string")throw new Error(`Query parameter "id" must be a string.  Found type ${typeof e.id} instead.`);return await i.replById(e)}async function qe(e){if(typeof e.url!="string")throw new Error(`Query parameter "url" must be a string.  Found type ${typeof e.url} instead.`);return await i.replByUrl(e)}var Ve={};d(Ve,{getActiveFile:()=>ze,onActiveFileChange:()=>je});function je(e){let t=()=>{console.log("disposing existing watcher")};return i.watchActiveFile(g(e)).then(r=>{t=r}),()=>{t()}}async function ze(){return await i.getActiveFile()}var He={};d(He,{auth:()=>S,editor:()=>N});var S={};d(S,{authenticate:()=>at,getAuthToken:()=>J,verifyAuthToken:()=>U});var l={wicgAlgorithm:"Ed25519",nodeAlgorithm:"NODE-ED25519",nodeNamedCurve:"NODE-ED25519",kty:"OKP",crv:"Ed25519",oid:"2B6570".toLowerCase()};function f(e){return e===l.wicgAlgorithm||e===l.nodeAlgorithm||e.name===l.wicgAlgorithm||e.name===l.nodeAlgorithm&&e.namedCurve===l.nodeNamedCurve}var Ct={name:l.wicgAlgorithm};function m(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function P(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteLength)}var h="8d9df0f7-1363-4d2c-8152-ce4ed78f27d8",Ye=class{constructor(e){this.super_=e,this.orig_={};for(let t of["generateKey","exportKey","importKey","encrypt","decrypt","wrapKey","unwrapKey","deriveBits","deriveKey","sign","verify","digest"])this[t]?this.orig_[t]=e[t]:this[t]=e[t].bind(e)}orig_;async generateKey(e,t,r){if(f(e)){let n=p.utils.randomPrivateKey(),o=await p.getPublicKey(n),a=Array.from(r),s={algorithm:e,extractable:t,type:"private",usages:a,[h]:n},c={algorithm:e,extractable:!0,type:"public",usages:a,[h]:o};return{privateKey:s,publicKey:c}}return this.orig_.generateKey.apply(this.super_,arguments)}async exportKey(e,t){if(f(t.algorithm)&&t.extractable){let r=t[h];switch(e){case"jwk":{let n={kty:l.kty,crv:l.crv};return t.type==="public"?n.x=x(r):(n.d=x(r),n.x=x(await p.getPublicKey(r))),n}case"spki":return P(v.pack(["30",[["30",[["06","2B6570"]]],["03",r]]]))}}return this.orig_.exportKey.apply(this.super_,arguments)}async importKey(e,t,r,n,o){if(f(r)){let a=Array.from(o);switch(e){case"jwk":{let s=t;if(s.kty!==l.kty||s.crv!==l.crv||!s.x)break;return{algorithm:r,extractable:n,type:s.d?"private":"public",usages:a,[h]:Qe(s.d??s.x)}}case"spki":{let s=v.parseVerbose(m(t)),c=s.children?.[0]?.children?.[0]?.value,w=s.children?.[1]?.value;if(!(c instanceof Uint8Array)||$e(c)!==l.oid||!(w instanceof Uint8Array))break;return{algorithm:r,extractable:!0,type:"public",usages:a,[h]:w}}}}return this.orig_.importKey.apply(this.super_,arguments)}async sign(e,t,r){return f(e)&&f(t.algorithm)&&t.type==="private"&&t.usages.includes("sign")?P(await p.sign(m(r),t[h])):this.orig_.sign.apply(this.super_,arguments)}async verify(e,t,r,n){if(f(e)&&f(t.algorithm)&&t.type==="public"&&t.usages.includes("verify")){let o=m(r),a=m(n),s=t[h];return p.verify(o,a,s)}return this.orig_.verify.apply(this.super_,arguments)}};function Ge(e=crypto.subtle){return e?new Ye(e):(console.warn("polyfill ed25519: crypto.subtle is not available"),null)}var L=new TextDecoder,Xe=e=>{let t=n=>{let o=atob(n),a=new Uint8Array(o.length);for(let s=0;s<o.length;s++)a[s]=o.charCodeAt(s);return a},r=e;r instanceof Uint8Array&&(r=L.decode(r)),r=r.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return t(r)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}},Ze=e=>{function t(r){let n=r;return n instanceof Uint8Array&&(n=L.decode(n)),n}return __Buffer$.from(t(e),"base64")};function T(e){return typeof __Process$>"u"?Xe(e):Ze(e)}var B=60;function C(e){try{return JSON.parse(tt.decode(T(e)))}catch{throw new Error("Invalid JWT. Failed to parse component")}}function et(e){let{0:t}=e.split(".");if(typeof t!="string")throw new Error("Invalid JWT. JWT must have 3 parts");return C(t)}var b=new TextEncoder,tt=new TextDecoder;function rt(...e){let t=e.reduce((o,{length:a})=>o+a,0),r=new Uint8Array(t),n=0;return e.forEach(o=>{r.set(o,n),n+=o.length}),r}async function nt(e,t){if(typeof e!="string")throw new TypeError("JWT must be a string");let{0:r,1:n,2:o,length:a}=e.split(".");if(a!==3||typeof r!="string"||typeof n!="string"||typeof o!="string")throw new Error("Invalid Token. Token must have 3 parts");let s=C(r),{alg:c,typ:w}=s;if(!w||typeof w!="string")throw new Error("Invalid Token. Missing typ in protected header");if(w!=="JWT")throw new Error("Invalid JWT. Expected typ to be JWT");if(!c||typeof c!="string")throw new Error("Invalid JWT. Missing alg in protected header");if(c!=="EdDSA")throw new Error("Invalid JWT. Expected alg to be EdDSA");let k=rt(b.encode(r??""),b.encode("."),b.encode(n??"")),H=T(o);if(!await ot(t,H,k))throw new Error("Invalid JWT. Signature verification failed");let E=C(n),F=Math.floor(Date.now()/1e3),I=E.iat;if(typeof I!="number")throw new Error("Invalid JWT. Missing claim iat in payload");if(I>F+B)throw new Error("Invalid JWT. iat claim must be in the past");let W=E.exp;if(typeof W!="number")throw new Error("Invalid JWT. Missing claim exp in payload");if(W<F+B)throw new Error("Expired JWT. exp claim must be in the future");return{protectedHeader:s,payload:E}}var ot=async(e,t,r)=>typeof __Process$>"u"?it(e,t,r):st(e,t,r),it=async(e,t,r)=>{let n=Ge(crypto.subtle);if(!n)throw new Error("Ed25519 is not supported in this browser");let o=T(e.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"")),a=await n.importKey("spki",o,{name:"Ed25519"},!1,["verify"]);return await n.verify({name:"Ed25519"},a,t,r)},st=async(e,t,r)=>{try{let n=Q("crypto"),o=n.createPublicKey(e);if(o.type!=="public")throw new TypeError("The key is not a public key");if(o.asymmetricKeyType!=="ed25519")throw new TypeError("The key is not of type ed25519");return await n.verify(void 0,r,o,t)}catch{return!1}};async function J(){return i.experimental.auth.getAuthToken()}async function U(e){let t=et(e);if(t.typ!=="JWT")throw new Error("Expected typ: JWT");if(t.alg!=="EdDSA")throw new Error("Expected alg: EdDSA");if(!t.kid)throw new Error("Expected `kid` to be defined");let r=await fetch(`https://replit.com/data/extensions/publicKey/${t.kid}`),{ok:n,value:o}=await r.json();if(!n)throw new Error("Extension Auth: Failed to fetch public key");try{return await nt(e,o)}catch{throw new Error("Extension Auth: Failed to verify token")}}async function at(){let e=await J(),t=await U(e);if(typeof t.payload.userId!="number"||typeof t.payload.installationId!="string"||typeof t.payload.extensionId!="string")throw new Error("Failed to authenticate");return{user:{id:t.payload.userId},installation:{id:t.payload.installationId,extensionId:t.payload.extensionId}}}var N={};d(N,{getPreferences:()=>ct});async function ct(){return await i.experimental.editor.getPreferences()}var Tt={},dt={};d(dt,{exec:()=>lt,spawn:()=>q});function q(e){let t=i.exec(g({args:e.args,env:e.env||{},splitStderr:e.splitStderr??!1,onOutput:o=>{e.splitStderr?e.onStdOut?.(o):e.onOutput?.(o)},onStdErr:o=>{e.splitStderr?e.onStdErr?.(o):e.onOutput?.(o)},onError:o=>{throw o}})),r=async()=>{(await t).dispose()};return{resultPromise:new Promise(async o=>{let{exitCode:a,error:s}=await(await t).promise;o({error:s,exitCode:a??0})}),dispose:r}}async function lt(e,t={}){let r="",{resultPromise:n}=q({args:["bash","-c",e],env:t.env??{},splitStderr:!1,onOutput:a=>{r+=a}}),o=await n;if(o.error)throw new Error(o.error);return{output:r,exitCode:o.exitCode}}var ut={};d(ut,{error:()=>j,info:()=>A,log:()=>z,warn:()=>V});function D(e){return!!(["string","number","boolean","undefined"].includes(typeof e)||e===null)}async function A(e,t){if(!D(e)){i.debug.warn("Attempted to log non-serializable message. See your browser devtools to access the logged object.");return}return await i.debug.info(e,t)}async function V(e,t){if(!D(e)){i.debug.warn("Attempted to log non-serializable message. See your browser devtools to access the logged object.");return}return await i.debug.warn(e,t)}async function j(e,t){if(!D(e)){i.debug.warn("Attempted to log non-serializable message. See your browser devtools to access the logged object.");return}return await i.debug.error(e,t)}var z=A,ft="1.8.0";function ht(e,t){return Promise.race([e,new Promise((r,n)=>setTimeout(()=>n(new Error("timeout")),t))])}async function wt(){return new Promise(e=>{if(document.readyState==="complete"){e();return}let t=()=>{e(),window.removeEventListener("load",t)};window.addEventListener("load",t)})}function yt(){let e=console.log,t=console.warn,r=console.error,n=console.info;console.log=(...o)=>{e(...o),z(o[0],{args:o.slice(1)})},console.warn=(...o)=>{t(...o),V(o[0],{args:o.slice(1)})},console.error=(...o)=>{r(...o),j(o[0],{args:o.slice(1)})},console.info=(...o)=>{n(...o),A(o[0],{args:o.slice(1)})}}async function Dt(e){if(i===null)throw new Error("Extension must be initialized in a browser context");let t=()=>{i.activatePane()},r=()=>{window.document.removeEventListener("click",t)};try{window&&await wt(),await ht(i.handshake({clientName:"@replit/extensions",clientVersion:ft}),e?.timeout||2e3),yt(),_("ready"),window&&window.document.addEventListener("click",t)}catch(n){throw _("error"),console.error(n),r(),n}return{dispose:r,status:te()}}export{G as ChangeEventType,X as ColorScheme,Y as FsNodeType,ee as HandshakeStatus,Z as UserSocialType,we as copyFile,le as createDir,Re as data,ut as debug,fe as deleteDir,ue as deleteFile,dt as exec,He as experimental,i as extensionPort,re as fs,Dt as init,Tt as internal,Ce as me,We as messages,he as move,g as proxy,de as readDir,ae as readFile,me as replDb,Ve as session,De as themes,ft as version,pe as watchDir,ye as watchFile,ge as watchTextFile,ce as writeFile};
//# sourceMappingURL=extensions.mjs.map