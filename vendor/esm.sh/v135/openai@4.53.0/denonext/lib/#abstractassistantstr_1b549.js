/* esm.sh - esbuild bundle(openai@4.53.0/lib/AbstractAssistantStreamRunner) denonext production */
import{APIUserAbortError as P,OpenAIError as S}from"/v135/openai@4.53.0/denonext/error.js";var a=function(o,t,e,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?o!==t||!r:!t.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(o,e):r?r.value=e:t.set(o,e),e},n=function(o,t,e,s){if(e==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?o!==t||!s:!t.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?s:e==="a"?s.call(o):s?s.value:t.get(o)},_,w,f,u,b,d,h,m,A,p,c,g,R=class{constructor(){this.controller=new AbortController,_.set(this,void 0),w.set(this,()=>{}),f.set(this,()=>{}),u.set(this,void 0),b.set(this,()=>{}),d.set(this,()=>{}),h.set(this,{}),m.set(this,!1),A.set(this,!1),p.set(this,!1),c.set(this,!1),g.set(this,t=>{if(a(this,A,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new P),t instanceof P)return a(this,p,!0,"f"),this._emit("abort",t);if(t instanceof S)return this._emit("error",t);if(t instanceof Error){let e=new S(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new S(String(t)))}),a(this,_,new Promise((t,e)=>{a(this,w,t,"f"),a(this,f,e,"f")}),"f"),a(this,u,new Promise((t,e)=>{a(this,b,t,"f"),a(this,d,e,"f")}),"f"),n(this,_,"f").catch(()=>{}),n(this,u,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emit("end")},n(this,g,"f"))},0)}_addRun(t){return t}_connected(){this.ended||(n(this,w,"f").call(this),this._emit("connect"))}get ended(){return n(this,m,"f")}get errored(){return n(this,A,"f")}get aborted(){return n(this,p,"f")}abort(){this.controller.abort()}on(t,e){return(n(this,h,"f")[t]||(n(this,h,"f")[t]=[])).push({listener:e}),this}off(t,e){let s=n(this,h,"f")[t];if(!s)return this;let r=s.findIndex(i=>i.listener===e);return r>=0&&s.splice(r,1),this}once(t,e){return(n(this,h,"f")[t]||(n(this,h,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,s)=>{a(this,c,!0,"f"),t!=="error"&&this.once("error",s),this.once(t,e)})}async done(){a(this,c,!0,"f"),await n(this,u,"f")}_emit(t,...e){if(n(this,m,"f"))return;t==="end"&&(a(this,m,!0,"f"),n(this,b,"f").call(this));let s=n(this,h,"f")[t];if(s&&(n(this,h,"f")[t]=s.filter(r=>!r.once),s.forEach(({listener:r})=>r(...e))),t==="abort"){let r=e[0];!n(this,c,"f")&&!s?.length&&Promise.reject(r),n(this,f,"f").call(this,r),n(this,d,"f").call(this,r),this._emit("end");return}if(t==="error"){let r=e[0];!n(this,c,"f")&&!s?.length&&Promise.reject(r),n(this,f,"f").call(this,r),n(this,d,"f").call(this,r),this._emit("end")}}async _threadAssistantStream(t,e,s){return await this._createThreadAssistantStream(e,t,s)}async _runAssistantStream(t,e,s,r){return await this._createAssistantStream(e,t,s,r)}async _runToolAssistantStream(t,e,s,r,i){return await this._createToolAssistantStream(s,t,e,r,i)}async _createThreadAssistantStream(t,e,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i=await t.createAndRun({...e,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(i)}async _createToolAssistantStream(t,e,s,r,i){let l=i?.signal;l&&(l.aborted&&this.controller.abort(),l.addEventListener("abort",()=>this.controller.abort()));let E=await t.submitToolOutputs(e,s,{...r,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(E)}async _createAssistantStream(t,e,s,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let l=await t.create(e,{...s,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(l)}};_=new WeakMap,w=new WeakMap,f=new WeakMap,u=new WeakMap,b=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,A=new WeakMap,p=new WeakMap,c=new WeakMap,g=new WeakMap;export{R as AbstractAssistantStreamRunner};
//# sourceMappingURL=AbstractAssistantStreamRunner.js.map