/* esm.sh - esbuild bundle(openai@4.53.0/core) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import{VERSION as l}from"/v135/openai@4.53.0/denonext/version.js";import{Stream as j}from"/v135/openai@4.53.0/denonext/streaming.js";import{OpenAIError as f,APIError as U,APIConnectionError as H,APIConnectionTimeoutError as B,APIUserAbortError as R}from"/v135/openai@4.53.0/denonext/error.js";import{kind as M,getDefaultAgent as N,fetch as T}from"/v135/openai@4.53.0/denonext/_shims.js";import{isBlobLike as V,isMultipartBody as S}from"/v135/openai@4.53.0/denonext/uploads.js";import{maybeMultipartFormRequestOptions as Se,multipartFormRequestOptions as Pe,createForm as qe}from"/v135/openai@4.53.0/denonext/uploads.js";var $=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},D=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},m;async function I(t){let{response:e}=t;if(t.options.stream)return p("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):j.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let r=e.headers.get("content-type");if(r?.includes("application/json")||r?.includes("application/vnd.api+json")){let o=await e.json();return p("response",e.status,e.url,e.headers,o),o}let s=await e.text();return p("response",e.status,e.url,e.headers,s),s}var g=class t extends Promise{constructor(e,r=I){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=r}_thenUnwrap(e){return new t(this.responsePromise,async r=>e(await this.parseResponse(r)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},P=class{constructor({baseURL:e,maxRetries:r=2,timeout:n=6e5,httpAgent:s,fetch:o}){this.baseURL=e,this.maxRetries=b("maxRetries",r),this.timeout=b("timeout",n),this.httpAgent=s,this.fetch=o??T}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...J(),...this.authHeaders(e)}}validateHeaders(e,r){}defaultIdempotencyKey(){return`stainless-node-retry-${re()}`}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(async s=>{let o=s&&V(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:r,...s,body:o}}))}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof __Buffer$<"u")return __Buffer$.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){let{method:r,path:n,query:s,headers:o={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:S(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(i),u=this.buildURL(n,s);"timeout"in e&&b("timeout",e.timeout);let d=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??N(u),y=d+1e3;typeof c?.options?.timeout=="number"&&y>(c.options.timeout??0)&&(c.options.timeout=y),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let h=this.buildHeaders({options:e,headers:o,contentLength:a});return{req:{method:r,...i&&{body:i},headers:h,...c&&{agent:c},signal:e.signal??null},url:u,timeout:d}}buildHeaders({options:e,headers:r,contentLength:n}){let s={};n&&(s["content-length"]=n);let o=this.defaultHeaders(e);return C(s,o),C(s,r),S(e.body)&&M!=="node"&&delete s["content-type"],this.validateHeaders(s,r),s}async prepareOptions(e){}async prepareRequest(e,{url:r,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(r=>[...r])):{...e}:{}}makeStatusError(e,r,n,s){return U.generate(e,r,n,s)}request(e,r=null){return new g(this.makeRequest(e,r))}async makeRequest(e,r){let n=await e;r==null&&(r=n.maxRetries??this.maxRetries),await this.prepareOptions(n);let{req:s,url:o,timeout:i}=this.buildRequest(n);if(await this.prepareRequest(s,{url:o,options:n}),p("request",o,n,s.headers),n.signal?.aborted)throw new R;let a=new AbortController,u=await this.fetchWithTimeout(o,s,i,a).catch(O);if(u instanceof Error){if(n.signal?.aborted)throw new R;if(r)return this.retryRequest(n,r);throw u.name==="AbortError"?new B:new H({cause:u})}let d=v(u.headers);if(!u.ok){if(r&&this.shouldRetry(u)){let w=`retrying, ${r} attempts remaining`;return p(`response (error; ${w})`,u.status,o,d),this.retryRequest(n,r,d)}let c=await u.text().catch(w=>O(w).message),y=G(c),h=y?void 0:c;throw p(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,u.status,o,d,h),this.makeStatusError(u.status,y,h,d)}return{response:u,options:n,controller:a}}requestAPIList(e,r){let n=this.makeRequest(r,null);return new x(this,n,e)}buildURL(e,r){let n=z(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return X(s)||(r={...s,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(n.search=this.stringifyQuery(r)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new f(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,r,n,s){let{signal:o,...i}=r||{};o&&o.addEventListener("abort",()=>s.abort());let a=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(a)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n){let s,o=n?.["retry-after-ms"];if(o){let a=parseFloat(o);Number.isNaN(a)||(s=a)}let i=n?.["retry-after"];if(i&&!s){let a=parseFloat(i);Number.isNaN(a)?s=Date.parse(i)-Date.now():s=a*1e3}if(!(s&&0<=s&&s<60*1e3)){let a=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,a)}return await Y(s),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,r){let o=r-e,i=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return i*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${l}`}},q=class{constructor(e,r,n,s){m.set(this,void 0),$(this,m,e,"f"),this.options=s,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new f("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let r={...this.options};if("params"in e&&typeof r.query=="object")r.query={...r.query,...e.params};else if("url"in e){let n=[...Object.entries(r.query||{}),...e.url.searchParams.entries()];for(let[s,o]of n)e.url.searchParams.set(s,o);r.query=void 0,r.path=e.url.toString()}return await D(this,m,"f").requestAPIList(this.constructor,r)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(m=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let r of e.getPaginatedItems())yield r}},x=class extends g{constructor(e,r,n){super(r,async s=>new n(e,s.response,await I(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let r of e)yield r}},v=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,r){let n=r.toString();return e[n.toLowerCase()]||e[n]}}),F={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},fe=t=>typeof t=="object"&&t!==null&&!X(t)&&Object.keys(t).every(e=>L(F,e)),W=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":E(Deno.build.os),"X-Stainless-Arch":A(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":__Process$.version};if(Object.prototype.toString.call(typeof __Process$<"u"?__Process$:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":E(__Process$.platform),"X-Stainless-Arch":A(__Process$.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":__Process$.version};let t=K();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function K(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let s=n[1]||0,o=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${o}.${i}`}}}return null}var A=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",E=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),k,J=()=>k??(k=W()),G=t=>{try{return JSON.parse(t)}catch{return}},Q=new RegExp("^(?:[a-z]+:)?//","i"),z=t=>Q.test(t),Y=t=>new Promise(e=>setTimeout(e,t)),b=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new f(`${t} must be an integer`);if(e<0)throw new f(`${t} must be a positive integer`);return e},O=t=>t instanceof Error?t:new Error(t),de=t=>{if(t==null)throw new f(`Expected a value to be given but received ${t} instead.`);return t},le=t=>{if(typeof __Process$<"u")return __Process$.env?.[t]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(t)?.trim()},Z=t=>{if(typeof t=="number")return Math.round(t);if(typeof t=="string")return parseInt(t,10);throw new f(`Could not coerce ${t} (type: ${typeof t}) into a number`)},ee=t=>{if(typeof t=="number")return t;if(typeof t=="string")return parseFloat(t);throw new f(`Could not coerce ${t} (type: ${typeof t}) into a number`)},te=t=>typeof t=="boolean"?t:typeof t=="string"?t==="true":!!t,pe=t=>{if(t!==void 0)return Z(t)},ye=t=>{if(t!==void 0)return ee(t)},he=t=>{if(t!==void 0)return te(t)};function X(t){if(!t)return!0;for(let e in t)return!1;return!0}function L(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function C(t,e){for(let r in e){if(!L(e,r))continue;let n=r.toLowerCase();if(!n)continue;let s=e[r];s===null?delete t[n]:s!==void 0&&(t[n]=s)}}function p(t,...e){typeof __Process$<"u"&&__Process$?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${t}`,...e)}var re=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),me=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ne=t=>typeof t?.get=="function",ge=(t,e)=>{let r=e.toLowerCase();if(ne(t)){let n=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,o,i)=>o+i.toUpperCase());for(let s of[e,r,e.toUpperCase(),n]){let o=t.get(s);if(o)return o}}for(let[n,s]of Object.entries(t))if(n.toLowerCase()===r)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s;throw new Error(`Could not find ${e} header`)},we=t=>{if(!t)return"";if(typeof __Buffer$<"u")return __Buffer$.from(t).toString("base64");if(typeof btoa<"u")return btoa(t);throw new f("Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined")};function be(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}export{P as APIClient,g as APIPromise,q as AbstractPage,x as PagePromise,O as castToError,te as coerceBoolean,ee as coerceFloat,Z as coerceInteger,qe as createForm,v as createResponseHeaders,p as debug,de as ensurePresent,ge as getRequiredHeader,L as hasOwn,X as isEmptyObj,ne as isHeadersProtocol,be as isObj,fe as isRequestOptions,me as isRunningInBrowser,he as maybeCoerceBoolean,ye as maybeCoerceFloat,pe as maybeCoerceInteger,Se as maybeMultipartFormRequestOptions,Pe as multipartFormRequestOptions,le as readEnv,G as safeJSON,Y as sleep,we as toBase64};
//# sourceMappingURL=core.js.map