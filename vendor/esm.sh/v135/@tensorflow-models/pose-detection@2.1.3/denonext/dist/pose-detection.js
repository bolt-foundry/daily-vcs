/* esm.sh - esbuild bundle(@tensorflow-models/pose-detection@2.1.3/dist/pose-detection) denonext production */
import * as __0$ from "/v135/@mediapipe/pose@0.5.1675469404/denonext/pose.mjs";
import * as __1$ from "/v135/@tensorflow/tfjs-core@4.15.0/denonext/tfjs-core.mjs";
import * as __2$ from "/v135/@tensorflow/tfjs-converter@4.15.0/denonext/tfjs-converter.mjs";
import * as __3$ from "/v135/@tensorflow/tfjs-backend-webgpu@4.15.0/denonext/tfjs-backend-webgpu.mjs";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"@mediapipe/pose":return e(__0$);case"@tensorflow/tfjs-core":return e(__1$);case"@tensorflow/tfjs-converter":return e(__2$);case"@tensorflow/tfjs-backend-webgpu":return e(__3$);default:throw new Error("module \""+n+"\" not found");}};
var Zn=Object.create;var be=Object.defineProperty;var $n=Object.getOwnPropertyDescriptor;var Qn=Object.getOwnPropertyNames;var Jn=Object.getPrototypeOf,ei=Object.prototype.hasOwnProperty;var ne=(g=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(g,{get:(E,u)=>(typeof require<"u"?require:E)[u]}):g)(function(g){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+g+'" is not supported')});var ti=(g,E)=>()=>(E||g((E={exports:{}}).exports,E),E.exports),ri=(g,E)=>{for(var u in E)be(g,u,{get:E[u],enumerable:!0})},Me=(g,E,u,N)=>{if(E&&typeof E=="object"||typeof E=="function")for(let I of Qn(E))!ei.call(g,I)&&I!==u&&be(g,I,{get:()=>E[I],enumerable:!(N=$n(E,I))||N.enumerable});return g},q=(g,E,u)=>(Me(g,E,"default"),u&&Me(u,E,"default")),St=(g,E,u)=>(u=g!=null?Zn(Jn(g)):{},Me(E||!g||!g.__esModule?be(u,"default",{value:g,enumerable:!0}):u,g));var Ee=ti((ie,_t)=>{(function(g,E){typeof ie=="object"&&typeof _t<"u"?E(ie,ne("@mediapipe/pose"),ne("@tensorflow/tfjs-core"),ne("@tensorflow/tfjs-converter"),ne("@tensorflow/tfjs-backend-webgpu")):typeof define=="function"&&define.amd?define(["exports","@mediapipe/pose","@tensorflow/tfjs-core","@tensorflow/tfjs-converter","@tensorflow/tfjs-backend-webgpu"],E):(g=g||self,E(g.poseDetection={},g.globalThis,g.tf,g.tf,g.tfwebgpu))})(ie,function(g,E,u,N,I){"use strict";var oe=function(t,e){return oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},oe(t,e)};function Oe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");oe(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var b=function(){return b=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},b.apply(this,arguments)};function w(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function s(c){try{l(n.next(c))}catch(d){a(d)}}function h(c){try{l(n.throw(c))}catch(d){a(d)}}function l(c){c.done?i(c.value):o(c.value).then(s,h)}l((n=n.apply(t,e||[])).next())})}function T(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return h([l,c])}}function h(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(c){l=[6,c],o=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function U(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}var A=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],j=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],At={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},Nt={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},Lt=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],Ft=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function ee(t){return t instanceof SVGAnimatedLength?t.baseVal.value:t}function ke(t){return w(this,void 0,void 0,function(){var e,r;return T(this,function(n){switch(n.label){case 0:return e=document.createElement("canvas"),t instanceof u.Tensor?[4,u.browser.toPixels(t,e)]:[3,2];case 1:return n.sent(),[3,3];case 2:e.width=ee(t.width),e.height=ee(t.height),r=e.getContext("2d"),t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0),n.label=3;case 3:return[2,e]}})})}function Se(t){return w(this,void 0,void 0,function(){var e,r,n,o,i,a;return T(this,function(s){switch(s.label){case 0:return t instanceof u.Tensor?(e=t.shape.slice(0,2),r=e[0],n=e[1],o=ImageData.bind,[4,u.browser.toPixels(t)]):[3,2];case 1:return[2,new(o.apply(ImageData,[void 0,s.sent(),n,r]))];case 2:return i=document.createElement("canvas"),a=i.getContext("2d"),i.width=ee(t.width),i.height=ee(t.height),a.drawImage(t,0,0),[2,a.getImageData(0,0,i.width,i.height)]}})})}function Dt(t){return w(this,void 0,void 0,function(){var e,r;return T(this,function(n){switch(n.label){case 0:return t instanceof SVGImageElement||t instanceof OffscreenCanvas?[4,ke(t)]:[3,2];case 1:return r=n.sent(),[3,3];case 2:r=t,n.label=3;case 3:return e=r,[2,u.browser.fromPixels(e,4)]}})})}function _e(t){if(t<0||t>=256)throw new Error("Mask value must be in range [0, 255] but got ".concat(t));if(!Number.isInteger(t))throw new Error("Mask value must be an integer but got ".concat(t))}var X={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"};function Rt(t){if(t==null)return b({},X);var e=b({},t);return e.runtime="mediapipe",e.enableSegmentation==null&&(e.enableSegmentation=X.enableSegmentation),e.enableSmoothing==null&&(e.enableSmoothing=X.enableSmoothing),e.smoothSegmentation==null&&(e.smoothSegmentation=X.smoothSegmentation),e.modelType==null&&(e.modelType=X.modelType),e}var Ct=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return w(this,void 0,void 0,function(){return T(this,function(e){return[2,this.mask]})})},t.prototype.toImageData=function(){return w(this,void 0,void 0,function(){return T(this,function(e){return[2,Se(this.mask)]})})},t.prototype.toTensor=function(){return w(this,void 0,void 0,function(){return T(this,function(e){return[2,Dt(this.mask)]})})},t.prototype.getUnderlyingType=function(){return"canvasimagesource"},t}();function Vt(t){return _e(t),"person"}var Bt=function(){function t(e){var r=this;this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new E.Pose({locateFile:function(o,i){if(e.solutionPath){var a=e.solutionPath.replace(/\/+$/,"");return"".concat(a,"/").concat(o)}return"".concat(i,"/").concat(o)}});var n;switch(e.modelType){case"lite":n=0;break;case"heavy":n=2;break;case"full":default:n=1;break}this.poseSolution.setOptions({modelComplexity:n,smoothLandmarks:e.enableSmoothing,enableSegmentation:e.enableSegmentation,smoothSegmentation:e.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults(function(o){if(r.height=o.image.height,r.width=o.image.width,o.poseLandmarks==null)r.poses=[];else{var i=r.translateOutput(o.poseLandmarks,o.poseWorldLandmarks);o.segmentationMask&&(i.segmentation={maskValueToLabel:Vt,mask:new Ct(o.segmentationMask)}),r.poses=[i]}})}return t.prototype.translateOutput=function(e,r){var n=this,o={keypoints:e.map(function(i,a){return{x:i.x*n.width,y:i.y*n.height,z:i.z,score:i.visibility,name:j[a]}})};return r!=null&&(o.keypoints3D=r.map(function(i,a){return{x:i.x,y:i.y,z:i.z,score:i.visibility,name:j[a]}})),o},t.prototype.estimatePoses=function(e,r,n){return w(this,void 0,void 0,function(){var o,i;return T(this,function(a){switch(a.label){case 0:return r&&r.flipHorizontal&&r.flipHorizontal!==this.selfieMode&&(this.selfieMode=r.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof u.Tensor?(i=ImageData.bind,[4,u.browser.toPixels(e)]):[3,2];case 1:return o=new(i.apply(ImageData,[void 0,a.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:o=e,a.label=3;case 3:return e=o,[4,this.poseSolution.send({image:e},n)];case 4:return a.sent(),[2,this.poses]}})})},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function Ut(t){return w(this,void 0,void 0,function(){var e,r;return T(this,function(n){switch(n.label){case 0:return e=Rt(t),r=new Bt(e),[4,r.initialize()];case 1:return n.sent(),[2,r]}})})}function H(t){return t instanceof u.Tensor?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function Pe(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function Kt(t,e,r,n){var o=e-t,i=n-r;if(o===0)throw new Error("Original min and max are both ".concat(t,", range cannot be 0."));var a=i/o,s=r-t*a;return{scale:a,offset:s}}function ae(t){return t instanceof u.Tensor?t:u.browser.fromPixels(t)}function Gt(t,e,r){if(r===void 0&&(r=!1),!r)return{top:0,left:0,right:0,bottom:0};var n=e.height,o=e.width;se(e,"targetSize"),se(t,"roi");var i=n/o,a=t.height/t.width,s,h,l=0,c=0;return i>a?(s=t.width,h=t.width*i,c=(1-a/i)/2):(s=t.height/i,h=t.height,l=(1-i/a)/2),t.width=s,t.height=h,{top:c,left:l,right:l,bottom:c}}function qt(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}}function Ie(t,e,r){se(r,"inputResolution");var n=1/r.width*t[0][0]*e.width,o=1/r.height*t[0][1]*e.width,i=t[0][3]*e.width,a=1/r.width*t[1][0]*e.height,s=1/r.height*t[1][1]*e.height,h=t[1][3]*e.height;return[n,o,i,a,s,h,0,0]}function se(t,e){u.util.assert(t.width!==0,function(){return"".concat(e," width cannot be 0.")}),u.util.assert(t.height!==0,function(){return"".concat(e," height cannot be 0.")})}function Ht(t,e,r){var n=t.locationData,o=r.rotationVectorStartKeypointIndex,i=r.rotationVectorEndKeypointIndex,a;r.rotationVectorTargetAngle?a=r.rotationVectorTargetAngle:a=Math.PI*r.rotationVectorTargetAngleDegree/180;var s=n.relativeKeypoints[o].x*e.width,h=n.relativeKeypoints[o].y*e.height,l=n.relativeKeypoints[i].x*e.width,c=n.relativeKeypoints[i].y*e.height,d=Pe(a-Math.atan2(-(c-h),l-s));return d}function le(t,e,r){var n=r.rotationVectorStartKeypointIndex,o=r.rotationVectorEndKeypointIndex,i=t.locationData,a=i.relativeKeypoints[n].x*e.width,s=i.relativeKeypoints[n].y*e.height,h=i.relativeKeypoints[o].x*e.width,l=i.relativeKeypoints[o].y*e.height,c=Math.sqrt((h-a)*(h-a)+(l-s)*(l-s))*2,d=Ht(t,e,r);return{xCenter:a/e.width,yCenter:s/e.height,width:c/e.width,height:c/e.height,rotation:d}}function Ae(t){if(t.length!==16)throw new Error("Array length must be 16 but got ".concat(t.length));return[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]],[t[8],t[9],t[10],t[11]],[t[12],t[13],t[14],t[15]]]}function ue(t,e,r,n,o,i,a){return t[e][o]*(t[r][i]*t[n][a]-t[r][a]*t[n][i])}function _(t,e,r){var n=(e+1)%4,o=(e+2)%4,i=(e+3)%4,a=(r+1)%4,s=(r+2)%4,h=(r+3)%4;return ue(t,n,o,i,a,s,h)+ue(t,o,i,n,a,s,h)+ue(t,i,n,o,a,s,h)}function zt(t){var e=Ae(new Array(16).fill(0));e[0][0]=_(t,0,0),e[1][0]=-_(t,0,1),e[2][0]=_(t,0,2),e[3][0]=-_(t,0,3),e[0][2]=_(t,2,0),e[1][2]=-_(t,2,1),e[2][2]=_(t,2,2),e[3][2]=-_(t,2,3),e[0][1]=-_(t,1,0),e[1][1]=_(t,1,1),e[2][1]=-_(t,1,2),e[3][1]=_(t,1,3),e[0][3]=-_(t,3,0),e[1][3]=_(t,3,1),e[2][3]=-_(t,3,2),e[3][3]=_(t,3,3);for(var r=t[0][0]*e[0][0]+t[1][0]*e[0][1]+t[2][0]*e[0][2]+t[3][0]*e[0][3],n=0;n<e.length;n++)for(var o=0;o<e.length;o++)e[n][o]/=r;return e}function Ne(t,e,r){r===void 0&&(r={ignoreRotation:!1});for(var n=[],o=0,i=t;o<i.length;o++){var a=i[o],s=a.x-.5,h=a.y-.5,l=r.ignoreRotation?0:e.rotation,c=Math.cos(l)*s-Math.sin(l)*h,d=Math.sin(l)*s+Math.cos(l)*h;c=c*e.width+e.xCenter,d=d*e.height+e.yCenter;var p=a.z*e.width,f=b({},a);f.x=c,f.y=d,f.z=p,n.push(f)}return n}function Wt(t,e,r){r===void 0&&(r=!0);for(var n=[],o=0;o<t.length;o++){var i=b({},e[o]);r&&(i.score=t[o].score),n.push(i)}return n}function Yt(t,e){for(var r=[],n=0,o=t;n<o.length;n++){var i=o[n],a=i.x,s=i.y,h=e.rotation,l=Math.cos(h)*a-Math.sin(h)*s,c=Math.sin(h)*a+Math.cos(h)*s,d=b({},i);d.x=l,d.y=c,r.push(d)}return r}var Le=1e-6,he=1e6,Fe=1e3;function jt(t,e,r,n){var o=t.width,i=t.height,a=n?-1:1,s=Math.cos(t.rotation),h=Math.sin(t.rotation),l=t.xCenter,c=t.yCenter,d=1/e,p=1/r,f=new Array(16);return f[0]=o*s*a*d,f[1]=-i*h*d,f[2]=0,f[3]=(-.5*o*s*a+.5*i*h+l)*d,f[4]=o*h*a*p,f[5]=i*s*p,f[6]=0,f[7]=(-.5*i*s-.5*o*h*a+c)*p,f[8]=0,f[9]=0,f[10]=o*d,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,Ae(f)}function De(t,e){var r=Kt(0,255,e[0],e[1]);return u.tidy(function(){return u.add(u.mul(t,r.scale),r.offset)})}function ce(t,e,r){var n=e.outputTensorSize,o=e.keepAspectRatio,i=e.borderMode,a=e.outputTensorFloatRange,s=H(t),h=qt(s,r),l=Gt(h,n,o),c=jt(h,s.width,s.height,!1),d=u.tidy(function(){var p=ae(t),f=u.tensor2d(Ie(c,s,n),[1,8]),v=i==="zero"?"constant":"nearest",m=u.image.transform(u.expandDims(u.cast(p,"float32")),f,"bilinear",v,0,[n.height,n.width]),y=a!=null?De(m,a):m;return y});return{imageTensor:d,padding:l,transformationMatrix:c}}function Xt(t){t.reduceBoxesInLowestLayer==null&&(t.reduceBoxesInLowestLayer=!1),t.interpolatedScaleAspectRatio==null&&(t.interpolatedScaleAspectRatio=1),t.fixedAnchorSize==null&&(t.fixedAnchorSize=!1);for(var e=[],r=0;r<t.numLayers;){for(var n=[],o=[],i=[],a=[],s=r;s<t.strides.length&&t.strides[s]===t.strides[r];){var h=Re(t.minScale,t.maxScale,s,t.strides.length);if(s===0&&t.reduceBoxesInLowestLayer)i.push(1),i.push(2),i.push(.5),a.push(.1),a.push(h),a.push(h);else{for(var l=0;l<t.aspectRatios.length;++l)i.push(t.aspectRatios[l]),a.push(h);if(t.interpolatedScaleAspectRatio>0){var c=s===t.strides.length-1?1:Re(t.minScale,t.maxScale,s+1,t.strides.length);a.push(Math.sqrt(h*c)),i.push(t.interpolatedScaleAspectRatio)}}s++}for(var d=0;d<i.length;++d){var p=Math.sqrt(i[d]);n.push(a[d]/p),o.push(a[d]*p)}var f=0,v=0;if(t.featureMapHeight.length>0)f=t.featureMapHeight[r],v=t.featureMapWidth[r];else{var m=t.strides[r];f=Math.ceil(t.inputSizeHeight/m),v=Math.ceil(t.inputSizeWidth/m)}for(var y=0;y<f;++y)for(var x=0;x<v;++x)for(var M=0;M<n.length;++M){var k=(x+t.anchorOffsetX)/v,O=(y+t.anchorOffsetY)/f,S={xCenter:k,yCenter:O,width:0,height:0};t.fixedAnchorSize?(S.width=1,S.height=1):(S.width=o[M],S.height=n[M]),e.push(S)}r=s}return e}function Re(t,e,r,n){return n===1?(t+e)*.5:t+(e-t)*r/(n-1)}function Zt(t){return u.tidy(function(){var e=u.slice(t,[0,0,0],[1,-1,1]),r=u.slice(t,[0,0,1],[1,-1,-1]);return[e,r]})}function $t(t){return u.tidy(function(){var e=Zt(t),r=e[0],n=e[1],o=u.squeeze(n),i=u.squeeze(r);return{boxes:o,logits:i}})}function Ce(t){return t!=null&&t.currentTime!=null}function Ve(t){for(var e={locationData:{relativeKeypoints:[]}},r=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=0;a<t.length;++a){var s=t[a];r=Math.min(r,s.x),n=Math.max(n,s.x),o=Math.min(o,s.y),i=Math.max(i,s.y),e.locationData.relativeKeypoints.push({x:s.x,y:s.y})}return e.locationData.relativeBoundingBox={xMin:r,yMin:o,xMax:n,yMax:i,width:n-r,height:i-o},e}function Qt(t,e,r,n){return w(this,void 0,void 0,function(){var o,i,a,s,h;return T(this,function(l){switch(l.label){case 0:return t.sort(function(c,d){return Math.max.apply(Math,d.score)-Math.max.apply(Math,c.score)}),o=u.tensor2d(t.map(function(c){return[c.locationData.relativeBoundingBox.yMin,c.locationData.relativeBoundingBox.xMin,c.locationData.relativeBoundingBox.yMax,c.locationData.relativeBoundingBox.xMax]})),i=u.tensor1d(t.map(function(c){return c.score[0]})),[4,u.image.nonMaxSuppressionAsync(o,i,e,r)];case 1:return a=l.sent(),[4,a.array()];case 2:return s=l.sent(),h=t.filter(function(c,d){return s.indexOf(d)>-1}),u.dispose([o,i,a]),[2,h]}})})}function Be(t,e){return t.map(function(r){var n=b(b({},r),{x:r.x*e.width,y:r.y*e.height});return r.z!=null&&(n.z=r.z*e.width),n})}function Jt(t,e,r){return w(this,void 0,void 0,function(){var n,o,i,a,s,h,l,c,d,p,f,v,m,y,x,M,k,O,S,P,F,D,C,V;return T(this,function(G){switch(G.label){case 0:if(n=u.squeeze(e,[0]),o=n.shape,i=o[0],a=o[1],s=o[2],t.length!==s)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+"".concat(t.length,", heatmap length: ").concat(s));return h=[],[4,n.buffer()];case 1:for(l=G.sent(),c=0;c<t.length;c++)if(d=t[c],p=b({},d),h.push(p),f=Math.trunc(p.x*a),v=Math.trunc(p.y*i),!(f<0||f>=a||v<0||f>=i)){for(m=Math.trunc((r.kernelSize-1)/2),y=Math.max(0,f-m),x=Math.min(a,f+m+1),M=Math.max(0,v-m),k=Math.min(i,v+m+1),O=0,S=0,P=0,F=0,D=M;D<k;++D)for(C=y;C<x;++C)V=l.get(D,C,c),O+=V,F=Math.max(F,V),S+=C*V,P+=D*V;F>=r.minConfidenceToRefine&&O>0&&(p.x=S/a/O,p.y=P/i/O)}return n.dispose(),[2,h]}})})}function er(t,e){t===void 0&&(t=[]);for(var r=e.left,n=e.top,o=e.left+e.right,i=e.top+e.bottom,a=0;a<t.length;a++){var s=t[a],h=s.locationData.relativeBoundingBox,l=(h.xMin-r)/(1-o),c=(h.yMin-n)/(1-i),d=h.width/(1-o),p=h.height/(1-i);h.xMin=l,h.yMin=c,h.width=d,h.height=p,h.xMax=l+d,h.yMax=c+p;var f=s.locationData.relativeKeypoints;f&&f.forEach(function(v){var m=(v.x-r)/(1-o),y=(v.y-n)/(1-i);v.x=m,v.y=y})}return t}function Ue(t,e){var r=e.left,n=e.top,o=e.left+e.right,i=e.top+e.bottom,a=t.map(function(s){return b(b({},s),{x:(s.x-r)/(1-o),y:(s.y-n)/(1-i),z:s.z/(1-o)})});return a}function tr(t,e,r){return u.getBackend()==="webgl"?rr(t,e,r):u.tidy(function(){var n=5.68842,o=-.748699,i=-57.8051,a=291.309,s=-624.717,h=u.sub(e,.5),l=u.square(h),c=u.sub(1,u.minimum(1,u.mul(l,u.add(n,u.mul(l,u.add(o,u.mul(l,u.add(i,u.mul(l,u.add(a,u.mul(l,s)))))))))));return u.add(e,u.mul(u.sub(t,e),u.mul(c,r.combineWithPreviousRatio)))})}function rr(t,e,r){var n=r.combineWithPreviousRatio.toFixed(2),o={variableNames:["prevMask","newMask"],outputShape:t.shape,userCode:`
  void main() {
      ivec2 coords = getOutputCoords();
      int height = coords[0];
      int width = coords[1];

      float prevMaskValue = getPrevMask(height, width);
      float newMaskValue = getNewMask(height, width);

      /*
      * Assume p := newMaskValue
      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)
      * uncertainty alpha(p) =
      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the
      * uncertainty]
      *
      * The following polynomial approximates uncertainty alpha as a
      * function of (p + 0.5):
      */
      const float c1 = 5.68842;
      const float c2 = -0.748699;
      const float c3 = -57.8051;
      const float c4 = 291.309;
      const float c5 = -624.717;
      float t = newMaskValue - 0.5;
      float x = t * t;

      float uncertainty =
        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));

      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *
                             (uncertainty * `.concat(n,`);

      setOutput(outputValue);
    }
`)},i=u.backend();return u.tidy(function(){var a=i.compileAndRun(o,[t,e]);return u.engine().makeTensorFromDataId(a.dataId,a.shape,a.dtype)})}function nr(t,e,r){return w(this,void 0,void 0,function(){var n,o,i,a,s;return T(this,function(h){switch(h.label){case 0:return n=t[0],o=t[1],i=ar(o,e,r),a=u.tidy(function(){var l=n;return r.sigmoidScore&&(r.scoreClippingThresh!=null&&(l=u.clipByValue(n,-r.scoreClippingThresh,r.scoreClippingThresh)),l=u.sigmoid(l)),l}),[4,ir(i,a,r)];case 1:return s=h.sent(),u.dispose([i,a]),[2,s]}})})}function ir(t,e,r){return w(this,void 0,void 0,function(){var n,o,i,a,s,h,l,c,d,p,f,v;return T(this,function(m){switch(m.label){case 0:return n=[],[4,t.data()];case 1:return o=m.sent(),[4,e.data()];case 2:for(i=m.sent(),a=0;a<r.numBoxes;++a)if(!(r.minScoreThresh!=null&&i[a]<r.minScoreThresh)&&(s=a*r.numCoords,h=or(o[s+0],o[s+1],o[s+2],o[s+3],i[a],r.flipVertically,a),l=h.locationData.relativeBoundingBox,!(l.width<0||l.height<0))){if(r.numKeypoints>0)for(c=h.locationData,c.relativeKeypoints=[],d=r.numKeypoints*r.numValuesPerKeypoint,p=0;p<d;p+=r.numValuesPerKeypoint)f=s+r.keypointCoordOffset+p,v={x:o[f+0],y:r.flipVertically?1-o[f+1]:o[f+1]},c.relativeKeypoints.push(v);n.push(h)}return[2,n]}})})}function or(t,e,r,n,o,i,a){return{score:[o],ind:a,locationData:{relativeBoundingBox:{xMin:e,yMin:i?1-r:t,xMax:n,yMax:i?1-t:r,width:n-e,height:r-t}}}}function ar(t,e,r){return u.tidy(function(){var n,o,i,a;r.reverseOutputOrder?(o=u.squeeze(u.slice(t,[0,r.boxCoordOffset+0],[-1,1])),n=u.squeeze(u.slice(t,[0,r.boxCoordOffset+1],[-1,1])),a=u.squeeze(u.slice(t,[0,r.boxCoordOffset+2],[-1,1])),i=u.squeeze(u.slice(t,[0,r.boxCoordOffset+3],[-1,1]))):(n=u.squeeze(u.slice(t,[0,r.boxCoordOffset+0],[-1,1])),o=u.squeeze(u.slice(t,[0,r.boxCoordOffset+1],[-1,1])),i=u.squeeze(u.slice(t,[0,r.boxCoordOffset+2],[-1,1])),a=u.squeeze(u.slice(t,[0,r.boxCoordOffset+3],[-1,1]))),o=u.add(u.mul(u.div(o,r.xScale),e.w),e.x),n=u.add(u.mul(u.div(n,r.yScale),e.h),e.y),r.applyExponentialOnBoxSize?(i=u.mul(u.exp(u.div(i,r.hScale)),e.h),a=u.mul(u.exp(u.div(a,r.wScale)),e.w)):(i=u.mul(u.div(i,r.hScale),e.h),a=u.mul(u.div(a,r.wScale),e.h));var s=u.sub(n,u.div(i,2)),h=u.sub(o,u.div(a,2)),l=u.add(n,u.div(i,2)),c=u.add(o,u.div(a,2)),d=u.concat([u.reshape(s,[r.numBoxes,1]),u.reshape(h,[r.numBoxes,1]),u.reshape(l,[r.numBoxes,1]),u.reshape(c,[r.numBoxes,1])],1);if(r.numKeypoints)for(var p=0;p<r.numKeypoints;++p){var f=r.keypointCoordOffset+p*r.numValuesPerKeypoint,v=void 0,m=void 0;r.reverseOutputOrder?(v=u.squeeze(u.slice(t,[0,f],[-1,1])),m=u.squeeze(u.slice(t,[0,f+1],[-1,1]))):(m=u.squeeze(u.slice(t,[0,f],[-1,1])),v=u.squeeze(u.slice(t,[0,f+1],[-1,1])));var y=u.add(u.mul(u.div(v,r.xScale),e.w),e.x),x=u.add(u.mul(u.div(m,r.yScale),e.h),e.y);d=u.concat([d,u.reshape(y,[r.numBoxes,1]),u.reshape(x,[r.numBoxes,1])],1)}return d})}function sr(t){return 1/(1+Math.exp(-t))}function lr(t,e){return t==="none"?e:sr(e)}function Ke(t,e,r,n){return w(this,void 0,void 0,function(){var o,i,a,s,h,l,d,c,d;return T(this,function(p){switch(p.label){case 0:return r=r||e.flipHorizontally||!1,n=n||e.flipVertically||!1,o=t.size,i=o/e.numLandmarks,[4,t.data()];case 1:for(a=p.sent(),s=[],h=0;h<e.numLandmarks;++h)l=h*i,d={x:0,y:0},r?d.x=e.inputImageWidth-a[l]:d.x=a[l],i>1&&(n?d.y=e.inputImageHeight-a[l+1]:d.y=a[l+1]),i>2&&(d.z=a[l+2]),i>3&&(d.score=lr(e.visibilityActivation,a[l+3])),s.push(d);for(c=0;c<s.length;++c)d=s[c],d.x=d.x/e.inputImageWidth,d.y=d.y/e.inputImageHeight,d.z=d.z/e.inputImageWidth/(e.normalizeZ||1);return[2,s]}})})}function ur(t,e,r){return u.tidy(function(){var n=u.squeeze(t,[0]),o=n.shape[2];if(o===1){var i=n;switch(e.activation){case"none":break;case"sigmoid":i=u.sigmoid(i);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported (".concat(e.activation,")"))}var a=r?u.image.resizeBilinear(i,[r.height,r.width]):i;return u.squeeze(a,[2])}else throw new Error("Unsupported number of tensor channels ".concat(o))})}function Ge(t,e,r){var n=t.width,o=t.height,i=t.rotation;if((r.rotation!=null||r.rotationDegree!=null)&&(i=hr(i,r)),i===0)t.xCenter=t.xCenter+n*r.shiftX,t.yCenter=t.yCenter+o*r.shiftY;else{var a=(e.width*n*r.shiftX*Math.cos(i)-e.height*o*r.shiftY*Math.sin(i))/e.width,s=(e.width*n*r.shiftX*Math.sin(i)+e.height*o*r.shiftY*Math.cos(i))/e.height;t.xCenter=t.xCenter+a,t.yCenter=t.yCenter+s}if(r.squareLong){var h=Math.max(n*e.width,o*e.height);n=h/e.width,o=h/e.height}else if(r.squareShort){var l=Math.min(n*e.width,o*e.height);n=l/e.width,o=l/e.height}return t.width=n*r.scaleX,t.height=o*r.scaleY,t}function hr(t,e){return e.rotation!=null?t+=e.rotation:e.rotationDegree!=null&&(t+=Math.PI*e.rotationDegree/180),Pe(t)}function cr(t,e){var r=t.width*e.width,n=t.height*e.height;return(r+n)/2}function qe(t,e){return t.map(function(r){var n=b(b({},r),{x:r.x/e.width,y:r.y/e.height});return r.z!=null&&(r.z=r.z/e.width),n})}var R=function(){function t(e){this.alpha=e,this.initialized=!1}return t.prototype.apply=function(e,r){var n;return this.initialized?r==null?n=this.storedValue+this.alpha*(e-this.storedValue):n=this.storedValue+this.alpha*r*Math.asinh((e-this.storedValue)/r):(n=e,this.initialized=!0),this.rawValue=e,this.storedValue=n,n},t.prototype.applyWithAlpha=function(e,r,n){return this.alpha=r,this.apply(e,n)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}();var de=function(){function t(e){this.frequency=e.frequency,this.minCutOff=e.minCutOff,this.beta=e.beta,this.thresholdCutOff=e.thresholdCutOff,this.thresholdBeta=e.thresholdBeta,this.derivateCutOff=e.derivateCutOff,this.x=new R(this.getAlpha(this.minCutOff)),this.dx=new R(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(e,r,n){if(e==null)return e;var o=Math.trunc(r);if(this.lastTimestamp>=o)return e;this.lastTimestamp!==0&&o!==0&&(this.frequency=1/((o-this.lastTimestamp)*Le)),this.lastTimestamp=o;var i=this.x.hasLastRawValue()?(e-this.x.lastRawValue())*n*this.frequency:0,a=this.dx.applyWithAlpha(i,this.getAlpha(this.derivateCutOff)),s=this.minCutOff+this.beta*Math.abs(a),h=this.thresholdCutOff!=null?this.thresholdCutOff+this.thresholdBeta*Math.abs(a):null;return this.x.applyWithAlpha(e,this.getAlpha(s),h)},t.prototype.getAlpha=function(e){return 1/(1+this.frequency/(2*Math.PI*e))},t}();var pe=function(){function t(e){this.config=e}return t.prototype.apply=function(e,r,n){var o=this;if(e==null)return this.reset(),null;this.initializeFiltersIfEmpty(e);var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return U([],e,!0);i=1/n}return e.map(function(a,s){var h=b(b({},a),{x:o.xFilters[s].apply(a.x,r,i),y:o.yFilters[s].apply(a.y,r,i)});return a.z!=null&&(h.z=o.zFilters[s].apply(a.z,r,i)),h})},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(e){var r=this;(this.xFilters==null||this.xFilters.length!==e.length)&&(this.xFilters=e.map(function(n){return new de(r.config)}),this.yFilters=e.map(function(n){return new de(r.config)}),this.zFilters=e.map(function(n){return new de(r.config)}))},t}();var fe=function(){function t(e){this.config=e,this.window=[],this.lowPassFilter=new R(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(e,r,n){if(e==null)return e;var o=Math.trunc(r);if(this.lastTimestamp>=o)return e;var i;if(this.lastTimestamp===-1)i=1;else{for(var a=e*n-this.lastValue*this.lastValueScale,s=o-this.lastTimestamp,h=a,l=s,c=he/30,d=(1+this.window.length)*c,p=0,f=this.window;p<f.length;p++){var v=f[p];if(l+v.duration>d)break;h+=v.distance,l+=v.duration}var m=h/(l*Le);i=1-1/(1+this.config.velocityScale*Math.abs(m)),this.window.unshift({distance:a,duration:s}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=e,this.lastValueScale=n,this.lastTimestamp=o,this.lowPassFilter.applyWithAlpha(e,i)},t}(),dr=function(){function t(e){this.config=e}return t.prototype.apply=function(e,r,n){var o=this;if(e==null)return this.reset(),null;var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return U([],e,!0);i=1/n}return this.initializeFiltersIfEmpty(e),e.map(function(a,s){var h=b(b({},a),{x:o.xFilters[s].apply(a.x,r,i),y:o.yFilters[s].apply(a.y,r,i)});return a.z!=null&&(h.z=o.zFilters[s].apply(a.z,r,i)),h})},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(e){var r=this;(this.xFilters==null||this.xFilters.length!==e.length)&&(this.xFilters=e.map(function(n){return new fe(r.config)}),this.yFilters=e.map(function(n){return new fe(r.config)}),this.zFilters=e.map(function(n){return new fe(r.config)}))},t}();var ve=function(){function t(e){if(e.velocityFilter!=null)this.keypointsFilter=new dr(e.velocityFilter);else if(e.oneEuroFilter!=null)this.keypointsFilter=new pe(e.oneEuroFilter);else throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+"".concat(e,"."))}return t.prototype.apply=function(e,r,n,o,i){if(o===void 0&&(o=!1),e==null)return this.keypointsFilter.reset(),null;var a=i!=null?cr(i,n):1,s=o?Be(e,n):e,h=this.keypointsFilter.apply(s,r,a);return o?qe(h,n):h},t}();var He=function(){function t(e){this.alpha=e.alpha}return t.prototype.apply=function(e){var r=this;if(e==null)return this.visibilityFilters=null,null;(this.visibilityFilters==null||this.visibilityFilters.length!==e.length)&&(this.visibilityFilters=e.map(function(s){return new R(r.alpha)}));for(var n=[],o=0;o<e.length;++o){var i=e[o],a=b({},i);a.score=this.visibilityFilters[o].apply(i.score),n.push(a)}return n},t}();var pr="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",ze="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2",fr="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2",vr="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2",mr={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},z={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:pr,landmarkModelUrl:ze},yr={maxPoses:1,flipHorizontal:!1},gr={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},xr={minSuppressionThreshold:.3,overlapType:"intersection-over-union"},We={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},wr={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},Tr={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},Mr=.5,br={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},Er={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},Or={kernelSize:7,minConfidenceToRefine:.5},me=33,kr=35,Ye={alpha:.1},Sr={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},_r={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},Pr={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},Ir={activation:"none"},Ar={combineWithPreviousRatio:.7};function Nr(t){var e=t==null?b({},z):b({},t);if(e.enableSmoothing==null&&(e.enableSmoothing=z.enableSmoothing),e.enableSegmentation==null&&(e.enableSegmentation=z.enableSegmentation),e.smoothSegmentation==null&&(e.smoothSegmentation=z.smoothSegmentation),e.modelType==null&&(e.modelType=z.modelType),e.detectorModelUrl==null&&(e.detectorModelUrl=z.detectorModelUrl),e.landmarkModelUrl==null)switch(e.modelType){case"lite":e.landmarkModelUrl=fr;break;case"heavy":e.landmarkModelUrl=vr;break;case"full":default:e.landmarkModelUrl=ze;break}return e}function Lr(t){var e;if(t==null?e=yr:e=b({},t),e.maxPoses==null&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(e.maxPoses,". Should be > 0."));if(e.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return e}var Fr=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return w(this,void 0,void 0,function(){return T(this,function(e){return[2,ke(this.mask)]})})},t.prototype.toImageData=function(){return w(this,void 0,void 0,function(){return T(this,function(e){return[2,Se(this.mask)]})})},t.prototype.toTensor=function(){return w(this,void 0,void 0,function(){return T(this,function(e){return[2,this.mask]})})},t.prototype.getUnderlyingType=function(){return"tensor"},t}();function Dr(t){return _e(t),"person"}var Rr=function(){function t(e,r,n,o,i,a){this.detectorModel=e,this.landmarkModel=r,this.enableSmoothing=n,this.enableSegmentation=o,this.smoothSegmentation=i,this.modelType=a,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=Xt(mr);var s=u.tensor1d(this.anchors.map(function(d){return d.width})),h=u.tensor1d(this.anchors.map(function(d){return d.height})),l=u.tensor1d(this.anchors.map(function(d){return d.xCenter})),c=u.tensor1d(this.anchors.map(function(d){return d.yCenter}));this.anchorTensor={x:l,y:c,w:s,h},this.prevFilteredSegmentationMask=this.enableSegmentation?u.tensor2d([],[0,0]):null}return t.prototype.estimatePoses=function(e,r,n){return w(this,void 0,void 0,function(){var o,i,a,s,h,l,c,d,p,f,v,m,y,x,M,k,O,S,P,F,D,C,V;return T(this,function(G){switch(G.label){case 0:return o=Lr(r),e==null?(this.reset(),[2,[]]):(this.maxPoses=o.maxPoses,n!=null?this.timestamp=n*Fe:this.timestamp=Ce(e)?e.currentTime*he:null,i=H(e),a=u.tidy(function(){return u.cast(ae(e),"float32")}),s=this.regionOfInterest,s!=null?[3,2]:[4,this.detectPose(a)]);case 1:if(h=G.sent(),h.length===0)return this.reset(),a.dispose(),[2,[]];l=h[0],s=this.poseDetectionToRoi(l,i),G.label=2;case 2:return[4,this.poseLandmarksByRoi(s,a)];case 3:return c=G.sent(),a.dispose(),c==null?(this.reset(),[2,[]]):(d=c.landmarks,p=c.auxiliaryLandmarks,f=c.poseScore,v=c.worldLandmarks,m=c.segmentationMask,y=this.poseLandmarkFiltering(d,p,v,i),x=y.actualLandmarksFiltered,M=y.auxiliaryLandmarksFiltered,k=y.actualWorldLandmarksFiltered,O=this.poseLandmarksToRoi(M,i),this.regionOfInterest=O,S=this.smoothSegmentation&&m!=null?this.poseSegmentationFiltering(m):m,P=x!=null?Be(x,i):null,P?.forEach(function(Q,J){Q.name=j[J]}),F=k,F?.forEach(function(Q,J){Q.name=j[J]}),D={score:f,keypoints:P,keypoints3D:F},S!==null&&(C=u.tidy(function(){var Q=u.expandDims(S,2),J=u.pad(Q,[[0,0],[0,0],[0,1]]);return u.mirrorPad(J,[[0,0],[0,0],[0,2]],"symmetric")}),this.smoothSegmentation||u.dispose(S),V={maskValueToLabel:Dr,mask:new Fr(C)},D.segmentation=V),[2,[D]])}})})},t.prototype.poseSegmentationFiltering=function(e){var r=this.prevFilteredSegmentationMask;return r.size===0?this.prevFilteredSegmentationMask=e:(this.prevFilteredSegmentationMask=tr(r,e,Ar),u.dispose(e)),u.dispose(r),this.prevFilteredSegmentationMask},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),u.dispose([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},t.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(u.dispose(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=u.tensor2d([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(e){return w(this,void 0,void 0,function(){var r,n,o,i,a,s,h,l,c,d;return T(this,function(p){switch(p.label){case 0:return r=ce(e,wr),n=r.imageTensor,o=r.padding,i=this.detectorModel.predict(n),a=$t(i),s=a.boxes,h=a.logits,[4,nr([h,s],this.anchorTensor,gr)];case 1:return l=p.sent(),l.length===0?(u.dispose([n,i,h,s]),[2,l]):[4,Qt(l,this.maxPoses,xr.minSuppressionThreshold)];case 2:return c=p.sent(),d=er(c,o),u.dispose([n,i,h,s]),[2,d]}})})},t.prototype.poseDetectionToRoi=function(e,r){var n,o;n=0,o=1;var i=le(e,r,{rotationVectorEndKeypointIndex:o,rotationVectorStartKeypointIndex:n,rotationVectorTargetAngleDegree:90}),a=Ge(i,r,We);return a},t.prototype.poseLandmarksByRoi=function(e,r){return w(this,void 0,void 0,function(){var n,o,i,a,s,h,l,c,d,p,f,v,m,y;return T(this,function(x){switch(x.label){case 0:if(n=H(r),o=ce(r,Tr,e),i=o.imageTensor,a=o.padding,s=o.transformationMatrix,this.modelType!=="lite"&&this.modelType!=="full"&&this.modelType!=="heavy")throw new Error("Model type must be one of lite, full or heavy,"+"but got ".concat(this.modelType));return h=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&h.push("activation_segmentation"),l=this.landmarkModel.execute(i,h),[4,this.tensorsToPoseLandmarksAndSegmentation(l)];case 1:return c=x.sent(),c==null?(u.dispose(l),u.dispose(i),[2,null]):(d=c.landmarks,p=c.auxiliaryLandmarks,f=c.poseScore,v=c.worldLandmarks,m=c.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,e,a,s,d,p,v,m)]);case 2:return y=x.sent(),u.dispose(l),u.dispose(i),[2,b({poseScore:f},y)]}})})},t.prototype.poseLandmarksAndSegmentationInverseProjection=function(e,r,n,o,i,a,s,h){return w(this,void 0,void 0,function(){var l,c,d,p,f,v;return T(this,function(m){return l=Ue(i,n),c=Ue(a,n),d=Ne(l,r),p=Ne(c,r),f=Yt(s,r),v=null,this.enableSegmentation&&(v=u.tidy(function(){var y=h.shape,x=y[0],M=y[1],k=zt(o),O=u.tensor2d(Ie(k,{width:M,height:x},e),[1,8]),S=[1,x,M,1];return u.squeeze(u.image.transform(u.reshape(h,S),O,"bilinear","constant",0,[e.height,e.width]),[0,3])}),u.dispose(h)),[2,{landmarks:d,auxiliaryLandmarks:p,worldLandmarks:f,segmentationMask:v}]})})},t.prototype.tensorsToPoseLandmarksAndSegmentation=function(e){return w(this,void 0,void 0,function(){var r,n,o,i,a,s,h,l,c,d,p,f,v,m;return T(this,function(y){switch(y.label){case 0:return r=e[0],n=e[1],o=e[2],i=e[3],a=this.enableSegmentation?e[4]:null,[4,n.data()];case 1:return s=y.sent()[0],s<Mr?[2,null]:[4,Ke(r,br)];case 2:return h=y.sent(),[4,Jt(h,o,Or)];case 3:return l=y.sent(),c=l.slice(0,me),d=l.slice(me,kr),[4,Ke(i,Er)];case 4:return p=y.sent(),f=p.slice(0,me),v=Wt(c,f,!0),m=this.enableSegmentation?ur(a,Ir):null,[2,{landmarks:c,auxiliaryLandmarks:d,poseScore:s,worldLandmarks:v,segmentationMask:m}]}})})},t.prototype.poseLandmarksToRoi=function(e,r){var n=Ve(e),o=le(n,r,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),i=Ge(o,r,We);return i},t.prototype.poseLandmarkFiltering=function(e,r,n,o){var i,a,s;if(this.timestamp==null||!this.enableSmoothing)i=e,a=r,s=n;else{var h=Ve(r),l=le(h,o,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});this.visibilitySmoothingFilterActual==null&&(this.visibilitySmoothingFilterActual=new He(Ye)),i=this.visibilitySmoothingFilterActual.apply(e),this.visibilitySmoothingFilterAuxiliary==null&&(this.visibilitySmoothingFilterAuxiliary=new He(Ye)),a=this.visibilitySmoothingFilterAuxiliary.apply(r),s=this.visibilitySmoothingFilterActual.apply(n),this.landmarksSmoothingFilterActual==null&&(this.landmarksSmoothingFilterActual=new ve(Sr)),i=this.landmarksSmoothingFilterActual.apply(i,this.timestamp,o,!0,l),this.landmarksSmoothingFilterAuxiliary==null&&(this.landmarksSmoothingFilterAuxiliary=new ve(_r)),a=this.landmarksSmoothingFilterAuxiliary.apply(a,this.timestamp,o,!0,l),this.worldLandmarksSmoothingFilterActual==null&&(this.worldLandmarksSmoothingFilterActual=new ve(Pr)),s=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}return{actualLandmarksFiltered:i,auxiliaryLandmarksFiltered:a,actualWorldLandmarksFiltered:s}},t}();function Cr(t){return w(this,void 0,void 0,function(){var e,r,n,o,i,a;return T(this,function(s){switch(s.label){case 0:return e=Nr(t),r=typeof e.detectorModelUrl=="string"&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,n=typeof e.landmarkModelUrl=="string"&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([N.loadGraphModel(e.detectorModelUrl,{fromTFHub:r}),N.loadGraphModel(e.landmarkModelUrl,{fromTFHub:n})])];case 1:return o=s.sent(),i=o[0],a=o[1],[2,new Rr(i,a,e.enableSmoothing,e.enableSegmentation,e.smoothSegmentation,e.modelType)]}})})}function Vr(t){if(t.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but "+"encountered ".concat(t.maxTracks));if(t.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but "+"encountered ".concat(t.maxAge));if(t.keypointTrackerParams!==void 0){if(t.keypointTrackerParams.keypointConfidenceThreshold<0||t.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+"".concat(t.keypointTrackerParams.keypointConfidenceThreshold));if(t.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but "+"encountered ".concat(t.keypointTrackerParams.minNumberOfKeypoints));for(var e=0,r=t.keypointTrackerParams.keypointFalloff;e<r.length;e++){var n=r[e];if(n<=0)throw new Error("Must specify each keypoint falloff parameterto be positive "+"but encountered ".concat(n))}}}var je=function(){function t(e){Vr(e),this.tracks=[],this.maxTracks=e.maxTracks,this.maxAge=e.maxAge*1e3,this.minSimilarity=e.minSimilarity,this.nextID=1}return t.prototype.apply=function(e,r){this.filterOldTracks(r);var n=this.computeSimilarity(e);return this.assignTracks(e,n,r),this.updateTracks(r),e},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map(function(e){return e.id}))},t.prototype.filterOldTracks=function(e){var r=this;this.tracks=this.tracks.filter(function(n){return e-n.lastTimestamp<=r.maxAge})},t.prototype.assignTracks=function(e,r,n){for(var o=Array.from(Array(r[0].length).keys()),i=Array.from(Array(e.length).keys()),a=[],s=0,h=i;s<h.length;s++){var l=h[s];if(o.length===0){a.push(l);continue}for(var c=-1,d=-1,p=0,f=o;p<f.length;p++){var v=f[p],m=r[l][v];m>=this.minSimilarity&&m>d&&(c=v,d=m)}if(c>=0){var y=this.tracks[c];y=Object.assign(y,this.createTrack(e[l],n,y.id)),e[l].id=y.id;var x=o.indexOf(c);o.splice(x,1)}else a.push(l)}for(var M=0,k=a;M<k.length;M++){var l=k[M],O=this.createTrack(e[l],n);this.tracks.push(O),e[l].id=O.id}},t.prototype.updateTracks=function(e){this.tracks.sort(function(r,n){return n.lastTimestamp-r.lastTimestamp}),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(e,r,n){var o={id:n||this.nextTrackID(),lastTimestamp:r,keypoints:U([],e.keypoints,!0).map(function(i){return b({},i)})};return e.box!==void 0&&(o.box=b({},e.box)),o},t.prototype.nextTrackID=function(){var e=this.nextID;return this.nextID+=1,e},t.prototype.remove=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.tracks=this.tracks.filter(function(n){return!e.includes(n.id)})},t.prototype.reset=function(){this.tracks=[]},t}();var Br=function(t){Oe(e,t);function e(r){return t.call(this,r)||this}return e.prototype.computeSimilarity=function(r){var n=this;if(r.length===0||this.tracks.length===0)return[[]];var o=r.map(function(i){return n.tracks.map(function(a){return n.iou(i,a)})});return o},e.prototype.iou=function(r,n){var o=Math.max(r.box.xMin,n.box.xMin),i=Math.max(r.box.yMin,n.box.yMin),a=Math.min(r.box.xMax,n.box.xMax),s=Math.min(r.box.yMax,n.box.yMax);if(o>=a||i>=s)return 0;var h=(a-o)*(s-i),l=r.box.width*r.box.height,c=n.box.width*n.box.height;return h/(l+c-h)},e}(je);var Ur=function(t){Oe(e,t);function e(r){var n=t.call(this,r)||this;return n.keypointThreshold=r.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=r.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=r.keypointTrackerParams.minNumberOfKeypoints,n}return e.prototype.computeSimilarity=function(r){if(r.length===0||this.tracks.length===0)return[[]];for(var n=[],o=0,i=r;o<i.length;o++){for(var a=i[o],s=[],h=0,l=this.tracks;h<l.length;h++){var c=l[h];s.push(this.oks(a,c))}n.push(s)}return n},e.prototype.oks=function(r,n){for(var o=this.area(n.keypoints)+1e-6,i=0,a=0,s=0;s<r.keypoints.length;++s){var h=r.keypoints[s],l=n.keypoints[s];if(!(h.score<this.keypointThreshold||l.score<this.keypointThreshold)){a+=1;var c=Math.pow(h.x-l.x,2)+Math.pow(h.y-l.y,2),d=2*this.keypointFalloff[s];i+=Math.exp(-1*c/(2*o*Math.pow(d,2)))}}return a<this.minNumKeyoints?0:i/a},e.prototype.area=function(r){var n=this,o=r.filter(function(l){return l.score>n.keypointThreshold}),i=Math.min.apply(Math,U([1],o.map(function(l){return l.x}),!1)),a=Math.max.apply(Math,U([0],o.map(function(l){return l.x}),!1)),s=Math.min.apply(Math,U([1],o.map(function(l){return l.y}),!1)),h=Math.max.apply(Math,U([0],o.map(function(l){return l.y}),!1));return(a-i)*(h-s)},e}(je);(function(t){t.Keypoint="keypoint",t.BoundingBox="boundingBox"})(g.TrackerType||(g.TrackerType={})),function(t){t.MoveNet="MoveNet",t.BlazePose="BlazePose",t.PoseNet="PoseNet"}(g.SupportedModels||(g.SupportedModels={}));function Kr(t){switch(t){case g.SupportedModels.BlazePose:return At;case g.SupportedModels.PoseNet:case g.SupportedModels.MoveNet:return Nt;default:throw new Error("Model ".concat(t," is not supported."))}}function Gr(t){switch(t){case g.SupportedModels.BlazePose:return Ft;case g.SupportedModels.PoseNet:case g.SupportedModels.MoveNet:return Lt;default:throw new Error("Model ".concat(t," is not supported."))}}function Xe(t){switch(t){case g.SupportedModels.BlazePose:return j.reduce(function(e,r,n){return e[r]=n,e},{});case g.SupportedModels.PoseNet:case g.SupportedModels.MoveNet:return A.reduce(function(e,r,n){return e[r]=n,e},{});default:throw new Error("Model ".concat(t," is not supported."))}}var qr=Object.freeze({__proto__:null,getKeypointIndexBySide:Kr,getAdjacentPairs:Gr,getKeypointIndexByName:Xe});var Z="SinglePose.Lightning",te="SinglePose.Thunder",W="MultiPose.Lightning",Ze=[Z,te,W],Hr="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4",zr="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4",Wr="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1",$e=192,Qe=256,Yr=256,Je={modelType:Z,enableSmoothing:!0},et={},tt={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},re=.9,Y=.2,jr=.25,$=17,L=3,Xr=5,rt=$*L,Zr=rt+4,K=$*L+Xr,ye={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},nt={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function $r(t,e){return(t[e.left_hip].score>Y||t[e.right_hip].score>Y)&&(t[e.left_shoulder].score>Y||t[e.right_shoulder].score>Y)}function Qr(t,e,r,n,o){for(var i=["left_shoulder","right_shoulder","left_hip","right_hip"],a=0,s=0,h=0;h<i.length;h++){var l=Math.abs(n-r[i[h]][0]),c=Math.abs(o-r[i[h]][1]);l>a&&(a=l),c>s&&(s=c)}for(var d=0,p=0,f=0,v=Object.keys(r);f<v.length;f++){var m=v[f];if(!(t[e[m]].score<Y)){var l=Math.abs(n-r[m][0]),c=Math.abs(o-r[m][1]);l>d&&(d=l),c>p&&(p=c)}}return[a,s,d,p]}function Jr(t,e,r,n){for(var o={},i=0,a=A;i<a.length;i++){var s=a[i];o[s]=[e[r[s]].y*n.height,e[r[s]].x*n.width]}if($r(e,r)){var h=(o.left_hip[0]+o.right_hip[0])/2,l=(o.left_hip[1]+o.right_hip[1])/2,c=Qr(e,r,o,h,l),d=c[0],p=c[1],f=c[2],v=c[3],m=Math.max(p*1.9,d*1.9,f*1.2,v*1.2);m=Math.min(m,Math.max(l,n.width-l,h,n.height-h));var y=[h-m,l-m];if(m>Math.max(n.width,n.height)/2)return ge(t==null,n);var x=m*2;return{yMin:y[0]/n.height,xMin:y[1]/n.width,yMax:(y[0]+x)/n.height,xMax:(y[1]+x)/n.width,height:(y[0]+x)/n.height-y[0]/n.height,width:(y[1]+x)/n.width-y[1]/n.width}}else return ge(t==null,n)}function ge(t,e){var r,n,o,i;return t?e.width>e.height?(r=1,n=e.height/e.width,o=0,i=(e.width/2-e.height/2)/e.width):(r=e.width/e.height,n=1,o=(e.height/2-e.width/2)/e.height,i=0):e.width>e.height?(r=e.width/e.height,n=1,o=(e.height/2-e.width/2)/e.height,i=0):(r=1,n=e.height/e.width,o=0,i=(e.width/2-e.height/2)/e.width),{yMin:o,xMin:i,yMax:o+r,xMax:i+n,height:r,width:n}}function en(t){var e=t==null?Je:b({},t);if(e.modelType==null)e.modelType="SinglePose.Lightning";else if(Ze.indexOf(e.modelType)<0)throw new Error("Invalid architecture ".concat(e.modelType,". ")+"Should be one of ".concat(Ze));if(e.enableSmoothing==null&&(e.enableSmoothing=!0),e.minPoseScore!=null&&(e.minPoseScore<0||e.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(e.multiPoseMaxDimension!=null&&(e.multiPoseMaxDimension%32!==0||e.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if(e.modelType===W&&e.enableTracking==null&&(e.enableTracking=!0),e.modelType===W&&e.enableTracking===!0)if(e.trackerType==null&&(e.trackerType=g.TrackerType.BoundingBox),e.trackerType===g.TrackerType.Keypoint)e.trackerConfig!=null?e.trackerConfig=rn(e.trackerConfig):e.trackerConfig=ye;else if(e.trackerType===g.TrackerType.BoundingBox)e.trackerConfig!=null?e.trackerConfig=nn(e.trackerConfig):e.trackerConfig=nt;else throw new Error("Tracker type not supported by MoveNet");return e}function tn(t){var e=t==null?et:b({},t);return e}function it(t,e){var r={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return e.maxTracks!=null&&(r.maxTracks=e.maxTracks),e.maxAge!=null&&(r.maxAge=e.maxAge),e.minSimilarity!=null&&(r.minSimilarity=e.minSimilarity),r}function rn(t){var e=it(ye,t);return e.keypointTrackerParams=b({},ye.keypointTrackerParams),t.keypointTrackerParams!=null&&(t.keypointTrackerParams.keypointConfidenceThreshold!=null&&(e.keypointTrackerParams.keypointConfidenceThreshold=t.keypointTrackerParams.keypointConfidenceThreshold),t.keypointTrackerParams.keypointFalloff!=null&&(e.keypointTrackerParams.keypointFalloff=t.keypointTrackerParams.keypointFalloff),t.keypointTrackerParams.minNumberOfKeypoints!=null&&(e.keypointTrackerParams.minNumberOfKeypoints=t.keypointTrackerParams.minNumberOfKeypoints)),e}function nn(t){var e=it(nt,t);return e}var on=function(){function t(e,r){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=Xe(g.SupportedModels.MoveNet),r.modelType===Z?(this.modelInputResolution.width=$e,this.modelInputResolution.height=$e):r.modelType===te&&(this.modelInputResolution.width=Qe,this.modelInputResolution.height=Qe),this.multiPoseModel=r.modelType===W,this.multiPoseModel||(this.keypointFilter=new pe(tt),this.cropRegionFilterYMin=new R(re),this.cropRegionFilterXMin=new R(re),this.cropRegionFilterYMax=new R(re),this.cropRegionFilterXMax=new R(re)),this.enableSmoothing=r.enableSmoothing,r.minPoseScore?this.minPoseScore=r.minPoseScore:this.minPoseScore=jr,r.multiPoseMaxDimension?this.multiPoseMaxDimension=r.multiPoseMaxDimension:this.multiPoseMaxDimension=Yr,this.enableTracking=r.enableTracking,this.multiPoseModel&&this.enableTracking&&(r.trackerType===g.TrackerType.Keypoint?this.tracker=new Ur(r.trackerConfig):r.trackerType===g.TrackerType.BoundingBox&&(this.tracker=new Br(r.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return t.prototype.runSinglePersonPoseModel=function(e){return w(this,void 0,void 0,function(){var r,n,o,i,a;return T(this,function(s){switch(s.label){case 0:if(r=this.moveNetModel.execute(e),r.shape.length!==4||r.shape[0]!==1||r.shape[1]!==1||r.shape[2]!==$||r.shape[3]!==L)throw r.dispose(),new Error("Unexpected output shape from model: [".concat(r.shape,"]"));return u.getBackend()==="webgpu"?[3,1]:(n=r.dataSync(),[3,3]);case 1:return[4,r.data()];case 2:n=s.sent(),s.label=3;case 3:for(r.dispose(),o={keypoints:[],score:0},i=0,a=0;a<$;++a)o.keypoints[a]={y:n[a*L],x:n[a*L+1],score:n[a*L+2]},o.keypoints[a].score>Y&&(++i,o.score+=o.keypoints[a].score);return i>0&&(o.score/=i),[2,o]}})})},t.prototype.runMultiPersonPoseModel=function(e){return w(this,void 0,void 0,function(){var r,n,o,i,a,s,h,l;return T(this,function(c){switch(c.label){case 0:if(r=this.moveNetModel.execute(e),r.shape.length!==3||r.shape[0]!==1||r.shape[2]!==K)throw r.dispose(),new Error("Unexpected output shape from model: [".concat(r.shape,"]"));return u.getBackend()==="webgpu"?[3,1]:(n=r.dataSync(),[3,3]);case 1:return[4,r.data()];case 2:n=c.sent(),c.label=3;case 3:for(r.dispose(),o=[],i=n.length/K,a=0;a<i;++a)for(o[a]={keypoints:[]},s=a*K+rt,o[a].box={yMin:n[s],xMin:n[s+1],yMax:n[s+2],xMax:n[s+3],width:n[s+3]-n[s+1],height:n[s+2]-n[s]},h=a*K+Zr,o[a].score=n[h],o[a].keypoints=[],l=0;l<$;++l)o[a].keypoints[l]={y:n[a*K+l*L],x:n[a*K+l*L+1],score:n[a*K+l*L+2]};return[2,o]}})})},t.prototype.estimatePoses=function(e,r,n){return r===void 0&&(r=et),w(this,void 0,void 0,function(){var o,i,a,s,h,l;return T(this,function(c){switch(c.label){case 0:return r=tn(r),e==null?(this.reset(),[2,[]]):(n==null?Ce(e)&&(n=e.currentTime*he):n=n*Fe,o=ae(e),i=H(o),a=u.expandDims(o,0),e instanceof u.Tensor||o.dispose(),s=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(a,i,n)]);case 1:return s=c.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(a,i,n)];case 3:s=c.sent(),c.label=4;case 4:for(h=0;h<s.length;++h)for(l=0;l<s[h].keypoints.length;++l)s[h].keypoints[l].name=A[l],s[h].keypoints[l].y*=i.height,s[h].keypoints[l].x*=i.width;return[2,s]}})})},t.prototype.estimateSinglePose=function(e,r,n){return w(this,void 0,void 0,function(){var o,i,a,s,h=this;return T(this,function(l){switch(l.label){case 0:return this.cropRegion||(this.cropRegion=ge(this.cropRegion==null,r)),o=u.tidy(function(){var c=u.tensor2d([[h.cropRegion.yMin,h.cropRegion.xMin,h.cropRegion.yMax,h.cropRegion.xMax]]),d=u.zeros([1],"int32"),p=[h.modelInputResolution.height,h.modelInputResolution.width];return u.cast(u.image.cropAndResize(e,c,d,p,"bilinear",0),"int32")}),e.dispose(),[4,this.runSinglePersonPoseModel(o)];case 1:if(i=l.sent(),o.dispose(),i.score<this.minPoseScore)return this.reset(),[2,[]];for(a=0;a<i.keypoints.length;++a)i.keypoints[a].y=this.cropRegion.yMin+i.keypoints[a].y*this.cropRegion.height,i.keypoints[a].x=this.cropRegion.xMin+i.keypoints[a].x*this.cropRegion.width;return n!=null&&this.enableSmoothing&&(i.keypoints=this.keypointFilter.apply(i.keypoints,n,1)),s=Jr(this.cropRegion,i.keypoints,this.keypointIndexByName,r),this.cropRegion=this.filterCropRegion(s),[2,[i]]}})})},t.prototype.estimateMultiplePoses=function(e,r,n){return w(this,void 0,void 0,function(){var o,i,a,s,h,l,c,d,p,v,f,v,m,y=this;return T(this,function(x){switch(x.label){case 0:return c=32,r.width>r.height?(i=this.multiPoseMaxDimension,a=Math.round(this.multiPoseMaxDimension*r.height/r.width),o=u.image.resizeBilinear(e,[a,i]),h=i,l=Math.ceil(a/c)*c,s=u.pad(o,[[0,0],[0,l-a],[0,0],[0,0]])):(i=Math.round(this.multiPoseMaxDimension*r.width/r.height),a=this.multiPoseMaxDimension,o=u.image.resizeBilinear(e,[a,i]),h=Math.ceil(i/c)*c,l=a,s=u.pad(o,[[0,0],[0,0],[0,h-i],[0,0]])),o.dispose(),e.dispose(),d=u.cast(s,"int32"),s.dispose(),[4,this.runMultiPersonPoseModel(d)];case 1:for(p=x.sent(),d.dispose(),p=p.filter(function(M){return M.score>=y.minPoseScore}),v=0;v<p.length;++v)for(f=0;f<p[v].keypoints.length;++f)p[v].keypoints[f].y*=l/a,p[v].keypoints[f].x*=h/i;if(this.enableTracking&&(this.tracker.apply(p,n),this.enableSmoothing)){for(v=0;v<p.length;++v)this.keypointFilterMap.has(p[v].id)||this.keypointFilterMap.set(p[v].id,new pe(tt)),p[v].keypoints=this.keypointFilterMap.get(p[v].id).apply(p[v].keypoints,n,1);m=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach(function(M,k){m.has(k)||y.keypointFilterMap.delete(k)})}return[2,p]}})})},t.prototype.filterCropRegion=function(e){if(e){var r=this.cropRegionFilterYMin.apply(e.yMin),n=this.cropRegionFilterXMin.apply(e.xMin),o=this.cropRegionFilterYMax.apply(e.yMax),i=this.cropRegionFilterXMax.apply(e.xMax);return{yMin:r,xMin:n,yMax:o,xMax:i,height:o-r,width:i-n}}else return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},t.prototype.dispose=function(){this.moveNetModel.dispose()},t.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},t.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},t}();function an(t){return t===void 0&&(t=Je),w(this,void 0,void 0,function(){var e,r,n,o;return T(this,function(i){switch(i.label){case 0:return e=en(t),n=!0,e.modelUrl?(n=typeof e.modelUrl=="string"&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,N.loadGraphModel(e.modelUrl,{fromTFHub:n})]):[3,2];case 1:return r=i.sent(),[3,4];case 2:return o=void 0,e.modelType===Z?o=Hr:e.modelType===te?o=zr:e.modelType===W&&(o=Wr),[4,N.loadGraphModel(o,{fromTFHub:n})];case 3:r=i.sent(),i.label=4;case 4:return u.getBackend()==="webgl"&&u.env().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new on(r,e)]}})})}var ot={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},at=["MobileNetV1","ResNet50"],st={MobileNetV1:[8,16],ResNet50:[16]},sn=[8,16,32],lt={MobileNetV1:[.5,.75,1],ResNet50:[1]},ut=[1,2,4],ht={maxPoses:1,flipHorizontal:!1},ln={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},un=[-123.15,-115.9,-103.06],hn=1,cn=17,dn=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]];function xe(t){return Math.floor(t/2)}var pn=function(){function t(e,r){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=r}return t.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},t.prototype.empty=function(){return this.numberOfElements===-1},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(e){for(;e>0&&this.less(xe(e),e);)this.exchange(e,xe(e)),e=xe(e)},t.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var r=2*e;if(r<this.numberOfElements&&this.less(r,r+1)&&r++,!this.less(e,r))break;this.exchange(e,r),e=r}},t.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},t.prototype.less=function(e,r){return this.getValueAt(e)<this.getValueAt(r)},t.prototype.exchange=function(e,r){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[r],this.priorityQueue[r]=n},t}();function fn(t,e,r,n,o,i){for(var a=i.shape,s=a[0],h=a[1],l=!0,c=Math.max(r-o,0),d=Math.min(r+o+1,s),p=c;p<d;++p){for(var f=Math.max(n-o,0),v=Math.min(n+o+1,h),m=f;m<v;++m)if(i.get(p,m,t)>e){l=!1;break}if(!l)break}return l}function vn(t,e,r){for(var n=r.shape,o=n[0],i=n[1],a=n[2],s=new pn(o*i*a,function(p){var f=p.score;return f}),h=0;h<o;++h)for(var l=0;l<i;++l)for(var c=0;c<a;++c){var d=r.get(h,l,c);d<t||fn(c,d,h,l,e,r)&&s.enqueue({score:d,part:{heatmapY:h,heatmapX:l,id:c}})}return s}function mn(t){return w(this,void 0,void 0,function(){return T(this,function(e){return[2,Promise.all(t.map(function(r){return r.buffer()}))]})})}function ct(t,e,r,n){return{y:n.get(t,e,r),x:n.get(t,e,r+cn)}}function dt(t,e,r){var n=t.heatmapY,o=t.heatmapX,i=t.id,a=ct(n,o,i,r),s=a.y,h=a.x;return{x:t.heatmapX*e+h,y:t.heatmapY*e+s}}function yn(t,e,r,n){var o=r-t,i=n-e;return o*o+i*i}function pt(t,e,r,n){var o=r.x,i=r.y;return t.some(function(a){var s=a.keypoints;return yn(i,o,s[n].y,s[n].x)<=e})}var ft=A.reduce(function(t,e,r){return t[e]=r,t},{}),vt=dn.map(function(t){var e=t[0],r=t[1];return[ft[e],ft[r]]}),we=vt.map(function(t){var e=t[1];return e}),mt=vt.map(function(t){var e=t[0];return e});function yt(t,e,r){return t<e?e:t>r?r:t}function Te(t,e,r,n){return{y:yt(Math.round(t.y/e),0,r-1),x:yt(Math.round(t.x/e),0,n-1)}}function gn(t,e,r){var n=r.shape[2]/2;return{y:r.get(e.y,e.x,t),x:r.get(e.y,e.x,n+t)}}function gt(t,e){return{x:t.x+e.x,y:t.y+e.y}}function xt(t,e,r,n,o,i,a,s){s===void 0&&(s=2);for(var h=n.shape,l=h[0],c=h[1],d={y:e.y,x:e.x},p=Te(d,i,l,c),f=gn(t,p,a),v=gt(d,f),m=v,y=0;y<s;y++){var x=Te(m,i,l,c),M=ct(x.y,x.x,r,o);m=gt({x:x.x*i,y:x.y*i},{x:M.x,y:M.y})}var k=Te(m,i,l,c),O=n.get(k.y,k.x,r);return{y:m.y,x:m.x,name:A[r],score:O}}function xn(t,e,r,n,o,i){var a=e.shape[2],s=we.length,h=new Array(a),l=t.part,c=t.score,d=dt(l,n,r);h[l.id]={score:c,name:A[l.id],y:d.y,x:d.x};for(var p=s-1;p>=0;--p){var f=we[p],v=mt[p];h[f]&&!h[v]&&(h[v]=xt(p,h[f],v,e,r,n,i))}for(var p=0;p<s;++p){var f=mt[p],v=we[p];h[f]&&!h[v]&&(h[v]=xt(p,h[f],v,e,r,n,o))}return h}function wn(t,e,r){var n=r.reduce(function(o,i,a){var s=i.y,h=i.x,l=i.score;return pt(t,e,{y:s,x:h},a)||(o+=l),o},0);return n/=r.length}function Tn(t,e,r,n,o,i,a,s){return a===void 0&&(a=.5),s===void 0&&(s=20),w(this,void 0,void 0,function(){var h,l,c,d,p,f,v,m,y,x,M,k;return T(this,function(O){switch(O.label){case 0:return[4,mn([t,e,r,n])];case 1:for(h=O.sent(),l=h[0],c=h[1],d=h[2],p=h[3],f=[],v=vn(a,hn,l),m=s*s;f.length<i&&!v.empty();)y=v.dequeue(),x=dt(y.part,o,c),!pt(f,m,x,y.part.id)&&(M=xn(y,l,c,o,d,p),k=wn(f,m,M),f.push({keypoints:M,score:k}));return[2,f]}})})}function wt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r;switch(t.length){case 0:r="fn main() ";break;case 1:r="fn main(".concat(t[0]," : i32)");break;default:throw Error("Unreachable")}return r}var Mn=function(){function t(e){this.variableNames=["A","B"],this.size=!0;var r=32;this.workgroupSize=[r,1,1],this.outputShape=[e[0],1],this.dispatchLayout=I.webgpu_util.flatDispatchLayout(this.outputShape),this.dispatch=I.webgpu_util.computeDispatch(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="getpointsConfidenceOp"}return t.prototype.getUserCode=function(){return`
        `.concat(wt("index"),` {
          if (index < uniforms.size) {
            let y = B[index * 2];
            let x = B[index * 2 + 1];
            let outIndex = y * uniforms.aShape.x * uniforms.aShape.z + x * uniforms.aShape.z + index;
            result[index] = A[outIndex];
          }
        }
        `)},t}();function bn(t,e){var r=u.backend(),n=new Mn(e.shape),o=r.runWebGPUProgram(n,[t,e],"float32"),i=u.engine().makeTensorFromTensorInfo(o);return i}function En(t,e){if(u.backend()instanceof I.WebGPUBackend)return bn(t,e);throw new Error("getPointsConfidenceWebGPU is not supported in this backend!")}var On=function(){function t(e){if(this.variableNames=["A","B"],this.size=!0,this.supportedLastDimension=2,e.length!==2||e[1]!==this.supportedLastDimension)throw new Error("GetOffsetVectorsProgram only supports shape of [x, ".concat(this.supportedLastDimension,"], but current shape is ").concat(e));var r=32;this.workgroupSize=[r,1,1],this.outputShape=e;var n=[e[0],1];this.dispatchLayout=I.webgpu_util.flatDispatchLayout(n),this.dispatch=I.webgpu_util.computeDispatch(this.dispatchLayout,n,this.workgroupSize),this.shaderKey="GetOffsetVectors"}return t.prototype.getUserCode=function(){return`
    fn getOffsetPoint(y: i32, x: i32, index: i32) -> vec2<i32> {
      let outIndexY = y * uniforms.bShape.x * uniforms.bShape.y + x * uniforms.bShape.y + index;
      let outIndexX = outIndexY + uniforms.bShape.z;
      let outY = i32(B[outIndexY]);
      let outX = i32(B[outIndexX]);
      return vec2<i32>(outY, outX);
    }

    `.concat(wt("index"),` {
      if (index < uniforms.size) {
        let indexY = index * `).concat(this.supportedLastDimension,`;
        let indexX = indexY + 1;
        let heatmapY = A[indexY];
        let heatmapX = A[indexX];
        let out = getOffsetPoint(i32(heatmapY), i32(heatmapX), index);
        result[indexY] = f32(out[0]);
        result[indexX] = f32(out[1]);
      }
    }
    `)},t}();function kn(t,e){var r=u.backend(),n=new On(t.shape),o=r.runWebGPUProgram(n,[t,e],"float32"),i=u.engine().makeTensorFromTensorInfo(o);return i}function Sn(t,e){if(u.backend()instanceof I.WebGPUBackend)return kn(t,e);throw new Error("getOffsetVectorsGPU is not supported in this backend!")}function _n(t,e){return u.tidy(function(){var r=u.div(t,u.scalar(e,"int32"));return u.sub(t,u.mul(r,u.scalar(e,"int32")))})}function Tt(t){var e=t.shape,r=e[0],n=e[1],o=e[2];return u.tidy(function(){var i=u.reshape(t,[r*n,o]),a=u.argMax(i,0),s=u.expandDims(u.div(a,u.scalar(n,"int32")),1),h=u.expandDims(_n(a,n),1);return u.concat([s,h],1)})}function Pn(t,e){for(var r=e.shape[0],n=new Float32Array(r),o=0;o<r;o++){var i=e.get(o,0),a=e.get(o,1);n[o]=t.get(i,a,o)}return n}function In(t,e,r){return u.tidy(function(){var n=An(t,r);return u.add(u.cast(u.mul(t.toTensor(),u.scalar(e,"int32")),"float32"),n)})}function An(t,e){for(var r=[],n=0;n<A.length;n++){var o=t.get(n,0).valueOf(),i=t.get(n,1).valueOf(),a=Nn(o,i,n,e),s=a.x,h=a.y;r.push(h),r.push(s)}return u.tensor2d(r,[A.length,2])}function Nn(t,e,r,n){return{y:n.get(t,e,r),x:n.get(t,e,r+A.length)}}function Ln(t,e,r){return u.tidy(function(){var n=Sn(t,r);return u.add(u.cast(u.mul(t,u.scalar(e,"int32")),"float32"),n)})}function Fn(t,e,r){return w(this,void 0,void 0,function(){var n,o,i,a,s,h,l,c,d,p;return T(this,function(f){switch(f.label){case 0:return n=0,o=Tt(t),[4,Promise.all([t.buffer(),e.buffer(),o.buffer()])];case 1:return i=f.sent(),a=i[0],s=i[1],h=i[2],l=In(h,r,s),[4,l.buffer()];case 2:return c=f.sent(),d=Array.from(Pn(a,h)),p=d.map(function(v,m){return n+=v,{y:c.get(m,0),x:c.get(m,1),score:v,name:A[m]}}),o.dispose(),l.dispose(),[2,{keypoints:p,score:n/p.length}]}})})}function Dn(t,e,r){return w(this,void 0,void 0,function(){var n,o,i;return T(this,function(a){return n=Tt(t),o=Ln(n,r,e),i=En(t,n),[2,[o,i]]})})}function Rn(t,e){for(var r=0,n=t;r<n.length;r++)for(var o=n[r],i=0,a=o.keypoints;i<a.length;i++){var s=a[i];s.x=e.width-1-s.x}return t}function Cn(t,e,r,n){var o=e.height,i=e.width,a=o/(r.height*(1-n.top-n.bottom)),s=i/(r.width*(1-n.left-n.right)),h=-n.top*r.height,l=-n.left*r.width;if(s===1&&a===1&&h===0&&l===0)return t;for(var c=0,d=t;c<d.length;c++)for(var p=d[c],f=0,v=p.keypoints;f<v.length;f++){var m=v[f];m.x=(m.x+l)*s,m.y=(m.y+h)*a}return t}function Vn(t){var e=t||ot;if(e.architecture==null&&(e.architecture="MobileNetV1"),at.indexOf(e.architecture)<0)throw new Error("Invalid architecture ".concat(e.architecture,". ")+"Should be one of ".concat(at));if(e.inputResolution==null&&(e.inputResolution={height:257,width:257}),e.outputStride==null&&(e.outputStride=16),st[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride ".concat(e.outputStride,". ")+"Should be one of ".concat(st[e.architecture]," ")+"for architecture ".concat(e.architecture,"."));if(e.multiplier==null&&(e.multiplier=1),lt[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier ".concat(e.multiplier,". ")+"Should be one of ".concat(lt[e.architecture]," ")+"for architecture ".concat(e.architecture,"."));if(e.quantBytes==null&&(e.quantBytes=4),ut.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes ".concat(e.quantBytes,". ")+"Should be one of ".concat(ut," ")+"for architecture ".concat(e.architecture,"."));if(e.architecture==="MobileNetV1"&&e.outputStride===32&&e.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}function Bn(t){u.util.assert(sn.indexOf(t)>=0,function(){return"outputStride of ".concat(t," is invalid. ")+"It must be either 8 or 16."})}function Mt(t,e){return(t-1)%e===0}function Un(t,e){u.util.assert(Mt(t.height,e),function(){return"height of ".concat(t.height," is invalid for output stride ")+"".concat(e,".")}),u.util.assert(Mt(t.width,e),function(){return"width of ".concat(t.width," is invalid for output stride ")+"".concat(e,".")})}function Kn(t){var e=t;if(e.maxPoses==null&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(e.maxPoses,". Should be > 0."));if(e.maxPoses>1){if(e=b(b({},ln),e),e.scoreThreshold<0||e.scoreThreshold>1)throw new Error("Invalid scoreThreshold ".concat(e.scoreThreshold,". ")+"Should be in range [0.0, 1.0]");if(e.nmsRadius<=0)throw new Error("Invalid nmsRadius ".concat(e.nmsRadius,"."))}return e}var bt="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Et="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function Gn(t,e){var r="model-stride".concat(t,".json");return e===4?Et+"float/"+r:Et+"quant".concat(e,"/")+r}function qn(t,e,r){var n={1:"100",.75:"075",.5:"050"},o="model-stride".concat(t,".json");return r===4?bt+"float/".concat(n[e],"/")+o:bt+"quant".concat(r,"/").concat(n[e],"/")+o}function Hn(t,e){return{height:Ot(t.height,e),width:Ot(t.width,e)}}function Ot(t,e){return zn(t,e)?t:Math.floor(t/e)*e+1}function zn(t,e){return(t-1)%e===0}var kt=function(){function t(e,r){this.posenetModel=e;var n=this.posenetModel.inputs[0].shape;u.util.assert(n[1]===-1&&n[2]===-1,function(){return"Input shape [".concat(n[1],", ").concat(n[2],"] ")+"must both be equal to or -1"});var o=Hn(r.inputResolution,r.outputStride);Bn(r.outputStride),Un(o,r.outputStride),this.inputResolution=o,this.outputStride=r.outputStride,this.architecture=r.architecture}return t.prototype.estimatePoses=function(e,r){return r===void 0&&(r=ht),w(this,void 0,void 0,function(){return T(this,function(n){return[2,this.estimatePosesGPU(e,r,!1)]})})},t.prototype.estimatePosesGPU=function(e,r,n){return r===void 0&&(r=ht),n===void 0&&(n=!1),w(this,void 0,void 0,function(){var o,i,a,s,h,l,c,d,p,f,v,m,y,M,x,M,k,O,S;return T(this,function(P){switch(P.label){case 0:return o=Kn(r),e==null?[2,n?[[],[]]:[]]:(this.maxPoses=o.maxPoses,i=ce(e,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),a=i.imageTensor,s=i.padding,h=this.architecture==="ResNet50"?u.add(a,un):De(a,[-1,1]),l=this.posenetModel.predict(h),this.architecture==="ResNet50"?(c=u.squeeze(l[2],[0]),d=u.squeeze(l[3],[0]),p=u.squeeze(l[0],[0]),f=u.squeeze(l[1],[0])):(c=u.squeeze(l[0],[0]),d=u.squeeze(l[1],[0]),p=u.squeeze(l[2],[0]),f=u.squeeze(l[3],[0])),v=u.sigmoid(d),this.maxPoses!==1?[3,5]:n?[4,Dn(v,c,this.outputStride)]:[3,2]);case 1:return y=P.sent(),M=y[0],x=y[1],m=[M,x],[3,4];case 2:return[4,Fn(v,c,this.outputStride)];case 3:M=P.sent(),m=[M],P.label=4;case 4:return[3,7];case 5:if(n)throw new Error("GPU renderer only supports single pose!");return[4,Tn(v,c,p,f,this.outputStride,this.maxPoses,o.scoreThreshold,o.nmsRadius)];case 6:m=P.sent(),P.label=7;case 7:if(n){if(o.flipHorizontal===!0)throw new Error("flipHorizontal is not supported!");k=this.getCanvasInfo(H(e),this.inputResolution,s)}else S=H(e),O=Cn(m,S,this.inputResolution,s),o.flipHorizontal&&(O=Rn(O,S));return a.dispose(),h.dispose(),u.dispose(l),c.dispose(),d.dispose(),p.dispose(),f.dispose(),v.dispose(),[2,n?[m,k]:O]}})})},t.prototype.getCanvasInfo=function(e,r,n){var o=e.height,i=e.width,a=o/(r.height*(1-n.top-n.bottom)),s=i/(r.width*(1-n.left-n.right)),h=-n.top*r.height,l=-n.left*r.width;return[l,h,s,a,e.width,e.height]},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function Wn(t){return t===void 0&&(t=ot),w(this,void 0,void 0,function(){var e,r,n,o,i;return T(this,function(a){switch(a.label){case 0:return e=Vn(t),e.architecture!=="ResNet50"?[3,2]:(r=Gn(e.outputStride,e.quantBytes),[4,N.loadGraphModel(e.modelUrl||r)]);case 1:return n=a.sent(),[2,new kt(n,e)];case 2:return o=qn(e.outputStride,e.multiplier,e.quantBytes),[4,N.loadGraphModel(e.modelUrl||o)];case 3:return i=a.sent(),[2,new kt(i,e)]}})})}function Yn(t,e){return w(this,void 0,void 0,function(){var r,n;return T(this,function(o){switch(t){case g.SupportedModels.PoseNet:return[2,Wn(e)];case g.SupportedModels.BlazePose:if(r=e,n=void 0,r!=null){if(r.runtime==="tfjs")return[2,Cr(e)];if(r.runtime==="mediapipe")return[2,Ut(e)];n=r.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(n));case g.SupportedModels.MoveNet:return[2,an(e)];default:throw new Error("".concat(t," is not a supported model name."))}})})}var jn={keypointsToNormalizedKeypoints:qe},Xn={modelType:{SINGLEPOSE_LIGHTNING:Z,SINGLEPOSE_THUNDER:te,MULTIPOSE_LIGHTNING:W}};g.calculators=jn,g.createDetector=Yn,g.movenet=Xn,g.util=qr,Object.defineProperty(g,"__esModule",{value:!0})})});var B={};ri(B,{SupportedModels:()=>ii,TrackerType:()=>ni,__esModule:()=>ui,calculators:()=>oi,createDetector:()=>ai,default:()=>ci,movenet:()=>si,util:()=>li});var It=St(Ee());q(B,St(Ee()));var{TrackerType:ni,SupportedModels:ii,calculators:oi,createDetector:ai,movenet:si,util:li,__esModule:ui}=It,{default:Pt,...hi}=It,ci=Pt!==void 0?Pt:hi;export{ii as SupportedModels,ni as TrackerType,ui as __esModule,oi as calculators,ai as createDetector,ci as default,si as movenet,li as util};
/*! Bundled license information:

@tensorflow-models/pose-detection/dist/pose-detection.js:
  (**
      * @license
      * Copyright 2023 Google LLC. All Rights Reserved.
      * Licensed under the Apache License, Version 2.0 (the "License");
      * you may not use this file except in compliance with the License.
      * You may obtain a copy of the License at
      *
      * http://www.apache.org/licenses/LICENSE-2.0
      *
      * Unless required by applicable law or agreed to in writing, software
      * distributed under the License is distributed on an "AS IS" BASIS,
      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      * See the License for the specific language governing permissions and
      * limitations under the License.
      * =============================================================================
      *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * https://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
*/
//# sourceMappingURL=pose-detection.js.map