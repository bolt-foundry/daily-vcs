/* esm.sh - esbuild bundle(js-tiktoken@1.0.8/lite) denonext production */
import k from"/v135/base64-js@1.5.1/denonext/base64-js.mjs";var m=Object.defineProperty,w=(e,s,t)=>s in e?m(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,v=(e,s,t)=>(w(e,typeof s!="symbol"?s+"":s,t),t);function T(e,s){let t=Array.from({length:e.length},(n,a)=>({start:a,end:a+1}));for(;t.length>1;){let n=null;for(let a=0;a<t.length-1;a++){let c=e.slice(t[a].start,t[a+1].end),i=s.get(c.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,a])}if(n!=null){let a=n[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function _(e,s){return e.length===1?[s.get(e.join(","))]:T(e,s).map(t=>s.get(e.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function y(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var p=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,s){this.patStr=e.pat_str;let t=e.bpe_ranks.split(`
`).filter(Boolean).reduce((n,a)=>{let[c,i,...o]=a.split(" "),d=Number.parseInt(i,10);return o.forEach((r,l)=>n[r]=d+l),n},{});for(let[n,a]of Object.entries(t)){let c=k.toByteArray(n);this.rankMap.set(c.join(","),a),this.textMap.set(a,c)}this.specialTokens={...e.special_tokens,...s},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[a,c])=>(n[c]=this.textEncoder.encode(a),n),{})}encode(e,s=[],t="all"){let n=new RegExp(this.patStr,"ug"),a=p.specialTokenRegex(Object.keys(this.specialTokens)),c=[],i=new Set(s==="all"?Object.keys(this.specialTokens):s),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(r=>!i.has(r)):t);if(o.size>0){let r=p.specialTokenRegex([...o]),l=e.match(r);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let d=0;for(;;){let r=null,l=d;for(;a.lastIndex=l,r=a.exec(e),!(r==null||i.has(r[0]));)l=r.index+1;let b=r?.index??e.length;for(let f of e.substring(d,b).matchAll(n)){let u=this.textEncoder.encode(f[0]),g=this.rankMap.get(u.join(","));if(g!=null){c.push(g);continue}c.push(..._(u,this.rankMap))}if(r==null)break;let x=this.specialTokens[r[0]];c.push(x),d=r.index+r[0].length}return c}decode(e){let s=[],t=0;for(let c=0;c<e.length;++c){let i=e[c],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(s.push(o),t+=o.length)}let n=new Uint8Array(t),a=0;for(let c of s)n.set(c,a),a+=c.length;return this.textDecoder.decode(n)}},h=p;v(h,"specialTokenRegex",e=>new RegExp(e.map(s=>y(s)).join("|"),"g"));function M(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}export{h as Tiktoken,M as getEncodingNameForModel};
//# sourceMappingURL=lite.js.map