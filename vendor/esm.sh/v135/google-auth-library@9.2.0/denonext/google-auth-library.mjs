/* esm.sh - esbuild bundle(google-auth-library@9.2.0) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import * as __0$ from "/v135/gcp-metadata@6.0.0/denonext/gcp-metadata.mjs";
import * as __1$ from "/v135/gaxios@6.1.1/denonext/gaxios.mjs";
import * as __2$ from "/v135/gaxios@6.1.1/denonext/gaxios.mjs";
import * as __3$ from "/v135/gcp-metadata@6.0.0/denonext/gcp-metadata.mjs";
import * as __4$ from "node:stream";
import * as __5$ from "/v135/gcp-metadata@6.0.0/denonext/gcp-metadata.mjs";
import * as __6$ from "node:child_process";
import * as __7$ from "node:fs";
import * as __8$ from "node:fs";
import * as __9$ from "node:util";
import * as __a$ from "/v135/jws@4.0.0/denonext/jws.mjs";
import * as __b$ from "/v135/gaxios@6.1.1/denonext/gaxios.mjs";
import * as __c$ from "node:querystring";
import * as __d$ from "node:querystring";
import * as __e$ from "node:stream";
import * as __f$ from "node:events";
import * as __10$ from "/v135/gtoken@7.0.1/denonext/gtoken.mjs";
import * as __11$ from "/v135/gaxios@6.1.1/denonext/gaxios.mjs";
import * as __12$ from "node:child_process";
import * as __13$ from "node:fs";
import * as __14$ from "/v135/gcp-metadata@6.0.0/denonext/gcp-metadata.mjs";
import * as __15$ from "node:os";
import * as __16$ from "node:path";
import * as __17$ from "/v135/base64-js@1.5.1/denonext/base64-js.mjs";
import * as __18$ from "node:crypto";
import * as __19$ from "/v135/gaxios@6.1.1/denonext/gaxios.mjs";
import * as __1a$ from "node:querystring";
import * as __1b$ from "node:stream";
import * as __1c$ from "/v135/ecdsa-sig-formatter@1.0.11/denonext/ecdsa-sig-formatter.mjs";
import * as __1d$ from "/v135/gaxios@6.1.1/denonext/gaxios.mjs";
import * as __1e$ from "node:stream";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"gcp-metadata":return c(__0$);case"gaxios":return c(__1$);case"stream":return e(__4$);case"child_process":return e(__6$);case"fs":return e(__7$);case"util":return e(__9$);case"jws":return e(__a$);case"querystring":return e(__c$);case"events":return e(__f$);case"gtoken":return c(__10$);case"os":return e(__15$);case"path":return e(__16$);case"base64-js":return e(__17$);case"crypto":return e(__18$);case"ecdsa-sig-formatter":return e(__1c$);default:throw new Error("module \""+n+"\" not found");}};
var Tr=Object.create;var De=Object.defineProperty;var Cr=Object.getOwnPropertyDescriptor;var kr=Object.getOwnPropertyNames;var vr=Object.getPrototypeOf,Sr=Object.prototype.hasOwnProperty;var p=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var f=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Or=(i,e)=>{for(var t in e)De(i,t,{get:e[t],enumerable:!0})},Le=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of kr(e))!Sr.call(i,s)&&s!==t&&De(i,s,{get:()=>e[s],enumerable:!(r=Cr(e,s))||r.enumerable});return i},j=(i,e,t)=>(Le(i,e,"default"),t&&Le(t,e,"default")),Ht=(i,e,t)=>(t=i!=null?Tr(vr(i)):{},Le(e||!i||!i.__esModule?De(t,"default",{value:i,enumerable:!0}):t,i));var $t=f(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.BrowserCrypto=void 0;var D=p("base64-js"),br=F(),Fe=class i{constructor(){if(typeof window>"u"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return D.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),D.fromByteArray(t)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,t,r){let s={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},n=new TextEncoder().encode(t),o=D.toByteArray(i.padBase64(r)),a=await window.crypto.subtle.importKey("jwk",e,s,!0,["verify"]);return await window.crypto.subtle.verify(s,a,o,n)}async sign(e,t){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),n=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),o=await window.crypto.subtle.sign(r,n,s);return D.fromByteArray(new Uint8Array(o))}decodeBase64StringUtf8(e){let t=D.toByteArray(i.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return D.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return(0,br.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,t){let r=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),s=new TextEncoder,n=await window.crypto.subtle.importKey("raw",s.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",n,s.encode(t))}};ce.BrowserCrypto=Fe});var Bt=f(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.NodeCrypto=void 0;var G=p("crypto"),Ge=class{async sha256DigestBase64(e){return G.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return G.randomBytes(e).toString("base64")}async verify(e,t,r){let s=G.createVerify("sha256");return s.update(t),s.end(),s.verify(e,r,"base64")}async sign(e,t){let r=G.createSign("RSA-SHA256");return r.update(t),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return __Buffer$.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return __Buffer$.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return G.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){let r=typeof e=="string"?e:Rr(e);return xr(G.createHmac("sha256",r).update(t).digest())}};ue.NodeCrypto=Ge;function xr(i){return i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}function Rr(i){return __Buffer$.from(i)}});var F=f(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.fromArrayBufferToHex=x.hasBrowserCrypto=x.createCrypto=void 0;var Ir=$t(),Pr=Bt();function Nr(){return Jt()?new Ir.BrowserCrypto:new Pr.NodeCrypto}x.createCrypto=Nr;function Jt(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}x.hasBrowserCrypto=Jt;function Ur(i){return Array.from(new Uint8Array(i)).map(t=>t.toString(16).padStart(2,"0")).join("")}x.fromArrayBufferToHex=Ur});var Kt=f(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.validate=void 0;function jr(i){let e=[{invalid:"uri",expected:"url"},{invalid:"json",expected:"data"},{invalid:"qs",expected:"params"}];for(let t of e)if(i[t.invalid]){let r=`'${t.invalid}' is not a valid configuration option. Please use '${t.expected}' instead. This library is using Axios for requests. Please see https://github.com/axios/axios to learn more about the valid request options.`;throw new Error(r)}}le.validate=jr});var He=f((ai,qr)=>{qr.exports={name:"google-auth-library",version:"9.2.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=14"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^6.0.0","gcp-metadata":"^6.0.0",gtoken:"^7.0.0",jws:"^4.0.0"},devDependencies:{"@compodoc/compodoc":"^1.1.7","@types/base64-js":"^1.2.5","@types/chai":"^4.1.7","@types/jws":"^3.1.0","@types/mocha":"^9.0.0","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^20.4.2","@types/sinon":"^10.0.0","assert-rejects":"^1.0.0",c8:"^8.0.0",chai:"^4.2.0",codecov:"^3.0.2",execa:"^5.0.0",gts:"^5.0.0","is-docker":"^2.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.0",keypair:"^1.0.4",linkinator:"^4.0.0",mocha:"^9.2.2",mv:"^2.1.1",ncp:"^2.0.0",nock:"^13.0.0","null-loader":"^4.0.0",puppeteer:"^21.0.0",sinon:"^15.0.0","ts-loader":"^8.0.0",typescript:"^5.1.6",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"compodoc src/","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"linkinator docs","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install",precompile:"gts clean"},license:"Apache-2.0"}});var Q=f(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.DefaultTransporter=void 0;var Mr=p("gaxios"),Lr=Kt(),Dr=He(),Wt="google-api-nodejs-client",he=class i{constructor(){this.instance=new Mr.Gaxios}configure(e={}){if(e.headers=e.headers||{},typeof window>"u"){let t=e.headers["User-Agent"];if(t?t.includes(`${Wt}/`)||(e.headers["User-Agent"]=`${t} ${i.USER_AGENT}`):e.headers["User-Agent"]=i.USER_AGENT,!e.headers["x-goog-api-client"]){let r=__Process$.version.replace(/^v/,"");e.headers["x-goog-api-client"]=`gl-node/${r}`}}return e}request(e){return e=this.configure(e),(0,Lr.validate)(e),this.instance.request(e).catch(t=>{throw this.processError(t)})}get defaults(){return this.instance.defaults}set defaults(e){this.instance.defaults=e}processError(e){let t=e.response,r=e,s=t?t.data:null;return t&&s&&s.error&&t.status!==200?typeof s.error=="string"?(r.message=s.error,r.status=t.status):Array.isArray(s.error.errors)?(r.message=s.error.errors.map(n=>n.message).join(`
`),r.code=s.error.code,r.errors=s.error.errors):(r.message=s.error.message,r.code=s.error.code):t&&t.status>=400&&(r.message=s,r.status=t.status),r}};de.DefaultTransporter=he;he.USER_AGENT=`${Wt}/${Dr.version}`});var Z=f(w=>{"use strict";var E=w&&w.__classPrivateFieldGet||function(i,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(i):r?r.value:e.get(i)},H,v,$e,Be;Object.defineProperty(w,"__esModule",{value:!0});w.LRUCache=w.originalOrCamelOptions=w.snakeToCamel=void 0;function zt(i){return i.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}w.snakeToCamel=zt;function Fr(i){function e(t){var r;let s=i||{};return(r=s[t])!==null&&r!==void 0?r:s[zt(t)]}return{get:e}}w.originalOrCamelOptions=Fr;var Je=class{constructor(e){H.add(this),v.set(this,new Map),this.capacity=e.capacity,this.maxAge=e.maxAge}set(e,t){E(this,H,"m",$e).call(this,e,t),E(this,H,"m",Be).call(this)}get(e){let t=E(this,v,"f").get(e);if(t)return E(this,H,"m",$e).call(this,e,t.value),E(this,H,"m",Be).call(this),t.value}};w.LRUCache=Je;v=new WeakMap,H=new WeakSet,$e=function(e,t){E(this,v,"f").delete(e),E(this,v,"f").set(e,{value:t,lastAccessed:Date.now()})},Be=function(){let e=this.maxAge?Date.now()-this.maxAge:0,t=E(this,v,"f").entries().next();for(;!t.done&&(E(this,v,"f").size>this.capacity||t.value[1].lastAccessed<e);)E(this,v,"f").delete(t.value[0]),t=E(this,v,"f").entries().next()}});var q=f(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.AuthClient=A.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=A.DEFAULT_UNIVERSE=void 0;var Gr=p("events"),Hr=Q(),$r=Z();A.DEFAULT_UNIVERSE="googleapis.com";A.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=5*60*1e3;var Ke=class extends Gr.EventEmitter{constructor(e={}){var t,r,s,n,o;super(),this.credentials={},this.eagerRefreshThresholdMillis=A.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS,this.forceRefreshOnFailure=!1,this.universeDomain=A.DEFAULT_UNIVERSE;let a=(0,$r.originalOrCamelOptions)(e);this.projectId=(t=a.get("project_id"))!==null&&t!==void 0?t:null,this.quotaProjectId=a.get("quota_project_id"),this.credentials=(r=a.get("credentials"))!==null&&r!==void 0?r:{},this.universeDomain=(s=a.get("universe_domain"))!==null&&s!==void 0?s:A.DEFAULT_UNIVERSE,this.transporter=(n=e.transporter)!==null&&n!==void 0?n:new Hr.DefaultTransporter,e.transporterOptions&&(this.transporter.defaults=e.transporterOptions),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=(o=e.forceRefreshOnFailure)!==null&&o!==void 0?o:!1}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e["x-goog-user-project"]&&this.quotaProjectId&&(e["x-goog-user-project"]=this.quotaProjectId),e}};A.AuthClient=Ke});var ze=f(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.LoginTicket=void 0;var We=class{constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};fe.LoginTicket=We});var M=f(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.OAuth2Client=R.CertificateFormat=R.CodeChallengeMethod=void 0;var Br=p("gaxios"),pe=p("querystring"),Jr=p("stream"),Kr=p("ecdsa-sig-formatter"),Ve=F(),Wr=q(),zr=ze(),Vt;(function(i){i.Plain="plain",i.S256="S256"})(Vt||(R.CodeChallengeMethod=Vt={}));var S;(function(i){i.PEM="PEM",i.JWK="JWK"})(S||(R.CertificateFormat=S={}));var m=class i extends Wr.AuthClient{constructor(e,t,r){let s=e&&typeof e=="object"?e:{clientId:e,clientSecret:t,redirectUri:r};super(s),this.certificateCache={},this.certificateExpiry=null,this.certificateCacheFormat=S.PEM,this.refreshTokenPromises=new Map,this._clientId=s.clientId,this._clientSecret=s.clientSecret,this.redirectUri=s.redirectUri}generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),i.GOOGLE_OAUTH2_AUTH_BASE_URL_+"?"+pe.stringify(e)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,Ve.createCrypto)(),r=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),n=(await e.sha256DigestBase64(r)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:r,codeChallenge:n}}getToken(e,t){let r=typeof e=="string"?{code:e}:e;if(t)this.getTokenAsync(r).then(s=>t(null,s.tokens,s.res),s=>t(s,null,s.response));else return this.getTokenAsync(r)}async getTokenAsync(e){let t=i.GOOGLE_OAUTH2_TOKEN_URL_,r={code:e.code,client_id:e.client_id||this._clientId,client_secret:this._clientSecret,redirect_uri:e.redirect_uri||this.redirectUri,grant_type:"authorization_code",code_verifier:e.codeVerifier},s=await this.transporter.request({method:"POST",url:t,data:pe.stringify(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}),n=s.data;return s.data&&s.data.expires_in&&(n.expiry_date=new Date().getTime()+s.data.expires_in*1e3,delete n.expires_in),this.emit("tokens",n),{tokens:n,res:s}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(r=>(this.refreshTokenPromises.delete(e),r),r=>{throw this.refreshTokenPromises.delete(e),r});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){var t;if(!e)throw new Error("No refresh token is set.");let r=i.GOOGLE_OAUTH2_TOKEN_URL_,s={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},n;try{n=await this.transporter.request({method:"POST",url:r,data:pe.stringify(s),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}catch(a){throw a instanceof Br.GaxiosError&&a.message==="invalid_grant"&&(!((t=a.response)===null||t===void 0)&&t.data)&&/ReAuth/i.test(a.response.data.error_description)&&(a.message=JSON.stringify(a.response.data)),a}let o=n.data;return n.data&&n.data.expires_in&&(o.expiry_date=new Date().getTime()+n.data.expires_in*1e3,delete o.expires_in),this.emit("tokens",o),{tokens:o,res:n}}refreshAccessToken(e){if(e)this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(e)this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let r=await this.processAndValidateRefreshHandler();if(r?.access_token)return this.setCredentials(r),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let t=await this.refreshAccessTokenAsync();if(!t.credentials||t.credentials&&!t.credentials.access_token)throw new Error("Could not refresh access token.");return{token:t.credentials.access_token,res:t.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let a={Authorization:t.token_type+" "+t.access_token};return{headers:this.addSharedMetadataHeaders(a)}}if(this.refreshHandler){let a=await this.processAndValidateRefreshHandler();if(a?.access_token){this.setCredentials(a);let c={Authorization:"Bearer "+this.credentials.access_token};return{headers:this.addSharedMetadataHeaders(c)}}}if(this.apiKey)return{headers:{"X-Goog-Api-Key":this.apiKey}};let r=null,s=null;try{r=await this.refreshToken(t.refresh_token),s=r.tokens}catch(a){let c=a;throw c.response&&(c.response.status===403||c.response.status===404)&&(c.message=`Could not refresh access token: ${c.message}`),c}let n=this.credentials;n.token_type=n.token_type||"Bearer",s.refresh_token=n.refresh_token,this.credentials=s;let o={Authorization:n.token_type+" "+s.access_token};return{headers:this.addSharedMetadataHeaders(o),res:r.res}}static getRevokeTokenUrl(e){let t=pe.stringify({token:e});return`${i.GOOGLE_OAUTH2_REVOKE_URL_}?${t}`}revokeToken(e,t){let r={url:i.getRevokeTokenUrl(e),method:"POST"};if(t)this.transporter.request(r).then(s=>t(null,s),t);else return this.transporter.request(r)}revokeCredentials(e){if(e)this.revokeCredentialsAsync().then(t=>e(null,t),e);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw new Error("No access token to revoke.")}request(e,t){if(t)this.requestAsync(e).then(r=>t(null,r),r=>t(r,r.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let r;try{let s=await this.getRequestMetadataAsync(e.url);e.headers=e.headers||{},s.headers&&s.headers["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=s.headers["x-goog-user-project"]),s.headers&&s.headers.Authorization&&(e.headers.Authorization=s.headers.Authorization),this.apiKey&&(e.headers["X-Goog-Api-Key"]=this.apiKey),r=await this.transporter.request(e)}catch(s){let n=s.response;if(n){let o=n.status,a=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),c=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,l=n.config.data instanceof Jr.Readable,h=o===401||o===403;if(!t&&h&&!l&&a)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&h&&!l&&c){let d=await this.processAndValidateRefreshHandler();return d?.access_token&&this.setCredentials(d),this.requestAsync(e,!0)}}throw s}return r}verifyIdToken(e,t){if(t&&typeof t!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(t)this.verifyIdTokenAsync(e).then(r=>t(null,r),t);else return this.verifyIdTokenAsync(e)}async verifyIdTokenAsync(e){if(!e.idToken)throw new Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,i.ISSUERS_,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${e}`},url:i.GOOGLE_TOKEN_INFO_URL}),r=Object.assign({expiry_date:new Date().getTime()+t.expires_in*1e3,scopes:t.scope.split(" ")},t);return delete r.expires_in,delete r.scope,r}getFederatedSignonCerts(e){if(e)this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){let e=new Date().getTime(),t=(0,Ve.hasBrowserCrypto)()?S.JWK:S.PEM;if(this.certificateExpiry&&e<this.certificateExpiry.getTime()&&this.certificateCacheFormat===t)return{certs:this.certificateCache,format:t};let r,s;switch(t){case S.PEM:s=i.GOOGLE_OAUTH2_FEDERATED_SIGNON_PEM_CERTS_URL_;break;case S.JWK:s=i.GOOGLE_OAUTH2_FEDERATED_SIGNON_JWK_CERTS_URL_;break;default:throw new Error(`Unsupported certificate format ${t}`)}try{r=await this.transporter.request({url:s})}catch(l){throw l instanceof Error&&(l.message=`Failed to retrieve verification certificates: ${l.message}`),l}let n=r?r.headers["cache-control"]:void 0,o=-1;if(n){let h=new RegExp("max-age=([0-9]*)").exec(n);h&&h.length===2&&(o=Number(h[1])*1e3)}let a={};switch(t){case S.PEM:a=r.data;break;case S.JWK:for(let l of r.data.keys)a[l.kid]=l;break;default:throw new Error(`Unsupported certificate format ${t}`)}let c=new Date;return this.certificateExpiry=o===-1?null:new Date(c.getTime()+o),this.certificateCache=a,this.certificateCacheFormat=t,{certs:a,format:t,res:r}}getIapPublicKeys(e){if(e)this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let e,t=i.GOOGLE_OAUTH2_IAP_PUBLIC_KEY_URL_;try{e=await this.transporter.request({url:t})}catch(r){throw r instanceof Error&&(r.message=`Failed to retrieve verification certificates: ${r.message}`),r}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,r,s,n){let o=(0,Ve.createCrypto)();n||(n=i.MAX_TOKEN_LIFETIME_SECS_);let a=e.split(".");if(a.length!==3)throw new Error("Wrong number of segments in token: "+e);let c=a[0]+"."+a[1],l=a[2],h,d;try{h=JSON.parse(o.decodeBase64StringUtf8(a[0]))}catch(g){throw g instanceof Error&&(g.message=`Can't parse token envelope: ${a[0]}': ${g.message}`),g}if(!h)throw new Error("Can't parse token envelope: "+a[0]);try{d=JSON.parse(o.decodeBase64StringUtf8(a[1]))}catch(g){throw g instanceof Error&&(g.message=`Can't parse token payload '${a[0]}`),g}if(!d)throw new Error("Can't parse token payload: "+a[1]);if(!Object.prototype.hasOwnProperty.call(t,h.kid))throw new Error("No pem found for envelope: "+JSON.stringify(h));let k=t[h.kid];if(h.alg==="ES256"&&(l=Kr.joseToDer(l,"ES256").toString("base64")),!await o.verify(k,c,l))throw new Error("Invalid token signature: "+e);if(!d.iat)throw new Error("No issue time in token: "+JSON.stringify(d));if(!d.exp)throw new Error("No expiration time in token: "+JSON.stringify(d));let b=Number(d.iat);if(isNaN(b))throw new Error("iat field using invalid format");let Y=Number(d.exp);if(isNaN(Y))throw new Error("exp field using invalid format");let U=new Date().getTime()/1e3;if(Y>=U+n)throw new Error("Expiration time too far in future: "+JSON.stringify(d));let oe=b-i.CLOCK_SKEW_SECS_,ae=Y+i.CLOCK_SKEW_SECS_;if(U<oe)throw new Error("Token used too early, "+U+" < "+oe+": "+JSON.stringify(d));if(U>ae)throw new Error("Token used too late, "+U+" > "+ae+": "+JSON.stringify(d));if(s&&s.indexOf(d.iss)<0)throw new Error("Invalid issuer, expected one of ["+s+"], but got "+d.iss);if(typeof r<"u"&&r!==null){let g=d.aud,Me=!1;if(r.constructor===Array?Me=r.indexOf(g)>-1:Me=g===r,!Me)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new zr.LoginTicket(h,d)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return e?e<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};R.OAuth2Client=m;m.GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";m.GOOGLE_OAUTH2_AUTH_BASE_URL_="https://accounts.google.com/o/oauth2/v2/auth";m.GOOGLE_OAUTH2_TOKEN_URL_="https://oauth2.googleapis.com/token";m.GOOGLE_OAUTH2_REVOKE_URL_="https://oauth2.googleapis.com/revoke";m.GOOGLE_OAUTH2_FEDERATED_SIGNON_PEM_CERTS_URL_="https://www.googleapis.com/oauth2/v1/certs";m.GOOGLE_OAUTH2_FEDERATED_SIGNON_JWK_CERTS_URL_="https://www.googleapis.com/oauth2/v3/certs";m.GOOGLE_OAUTH2_IAP_PUBLIC_KEY_URL_="https://www.gstatic.com/iap/verify/public_key";m.CLOCK_SKEW_SECS_=300;m.MAX_TOKEN_LIFETIME_SECS_=86400;m.ISSUERS_=["accounts.google.com","https://accounts.google.com"]});var Ye=f(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.Compute=void 0;var Vr=p("gaxios"),Xt=p("gcp-metadata"),Xr=M(),Xe=class extends Xr.OAuth2Client{constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(e){let t=`service-accounts/${this.serviceAccountEmail}/token`,r;try{let n={property:t};this.scopes.length>0&&(n.params={scopes:this.scopes.join(",")}),r=await Xt.instance(n)}catch(n){throw n instanceof Vr.GaxiosError&&(n.message=`Could not refresh access token: ${n.message}`,this.wrapError(n)),n}let s=r;return r&&r.expires_in&&(s.expiry_date=new Date().getTime()+r.expires_in*1e3,delete s.expires_in),this.emit("tokens",s),{tokens:s,res:null}}async fetchIdToken(e){let t=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`,r;try{let s={property:t};r=await Xt.instance(s)}catch(s){throw s instanceof Error&&(s.message=`Could not fetch ID token: ${s.message}`),s}return r}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,t.status===403?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:t.status===404&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}};_e.Compute=Xe});var Ze=f(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.IdTokenClient=void 0;var Yr=M(),Qe=class extends Yr.OAuth2Client{constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(e){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let r=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:r,expiry_date:this.getIdTokenExpiryDate(r)}}return{headers:{Authorization:"Bearer "+this.credentials.id_token}}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return JSON.parse(__Buffer$.from(t,"base64").toString("ascii")).exp*1e3}};ge.IdTokenClient=Qe});var et=f(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.getEnv=I.clear=I.GCPEnv=void 0;var Yt=p("gcp-metadata"),O;(function(i){i.APP_ENGINE="APP_ENGINE",i.KUBERNETES_ENGINE="KUBERNETES_ENGINE",i.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",i.COMPUTE_ENGINE="COMPUTE_ENGINE",i.CLOUD_RUN="CLOUD_RUN",i.NONE="NONE"})(O||(I.GCPEnv=O={}));var ee;function Qr(){ee=void 0}I.clear=Qr;async function Zr(){return ee||(ee=es(),ee)}I.getEnv=Zr;async function es(){let i=O.NONE;return ts()?i=O.APP_ENGINE:rs()?i=O.CLOUD_FUNCTIONS:await is()?await ns()?i=O.KUBERNETES_ENGINE:ss()?i=O.CLOUD_RUN:i=O.COMPUTE_ENGINE:i=O.NONE,i}function ts(){return!!(__Process$.env.GAE_SERVICE||__Process$.env.GAE_MODULE_NAME)}function rs(){return!!(__Process$.env.FUNCTION_NAME||__Process$.env.FUNCTION_TARGET)}function ss(){return!!__Process$.env.K_CONFIGURATION}async function ns(){try{return await Yt.instance("attributes/cluster-name"),!0}catch{return!1}}async function is(){return Yt.isAvailable()}});var rt=f(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.JWTAccess=void 0;var os=p("jws"),as=Z(),Qt={alg:"RS256",typ:"JWT"},tt=class i{constructor(e,t,r,s){this.cache=new as.LRUCache({capacity:500,maxAge:60*60*1e3}),this.email=e,this.key=t,this.keyId=r,this.eagerRefreshThresholdMillis=s??5*60*1e3}getCachedKey(e,t){let r=e;if(t&&Array.isArray(t)&&t.length?r=e?`${e}_${t.join("_")}`:`${t.join("_")}`:typeof t=="string"&&(r=e?`${e}_${t}`:t),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,t,r){let s=this.getCachedKey(e,r),n=this.cache.get(s),o=Date.now();if(n&&n.expiration-o>this.eagerRefreshThresholdMillis)return n.headers;let a=Math.floor(Date.now()/1e3),c=i.getExpirationTime(a),l;if(Array.isArray(r)&&(r=r.join(" ")),r?l={iss:this.email,sub:this.email,scope:r,exp:c,iat:a}:l={iss:this.email,sub:this.email,aud:e,exp:c,iat:a},t){for(let b in l)if(t[b])throw new Error(`The '${b}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...Qt,kid:this.keyId}:Qt,d=Object.assign(l,t),X={Authorization:`Bearer ${os.sign({header:h,payload:d,secret:this.key})}`};return this.cache.set(s,{expiration:c*1e3,headers:X}),X}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,r)=>{e||r(new Error("Must pass in a stream containing the service account auth settings."));let s="";e.setEncoding("utf8").on("data",n=>s+=n).on("error",r).on("end",()=>{try{let n=JSON.parse(s);this.fromJSON(n),t()}catch(n){r(n)}})})}};ye.JWTAccess=tt});var nt=f(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.JWT=void 0;var Zt=p("gtoken"),cs=rt(),us=M(),st=class i extends us.OAuth2Client{constructor(e,t,r,s,n,o){let a=e&&typeof e=="object"?e:{email:e,keyFile:t,key:r,keyId:o,scopes:s,subject:n};super(a),this.email=a.email,this.keyFile=a.keyFile,this.key=a.key,this.keyId=a.keyId,this.scopes=a.scopes,this.subject=a.subject,this.additionalClaims=a.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new i(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes();if(!this.apiKey&&t)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:r}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders({Authorization:`Bearer ${r.id_token}`})}}else{this.access||(this.access=new cs.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let r;this.hasUserScopes()?r=this.scopes:e||(r=this.defaultScopes);let s=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,this.useJWTAccessWithScope?r:void 0);return{headers:this.addSharedMetadataHeaders(s)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:{}}}async fetchIdToken(e){let t=new Zt.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw new Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(e){if(e)this.authorizeAsync().then(t=>e(null,t),e);else return this.authorizeAsync()}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw new Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(e){let t=this.createGToken(),s={access_token:(await t.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:t.expiresAt,id_token:t.idToken};return this.emit("tokens",s),{res:null,tokens:s}}createGToken(){return this.gtoken||(this.gtoken=new Zt.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,r)=>{if(!e)throw new Error("Must pass in a stream containing the service account auth settings.");let s="";e.setEncoding("utf8").on("error",r).on("data",n=>s+=n).on("end",()=>{try{let n=JSON.parse(s);this.fromJSON(n),t()}catch(n){r(n)}})})}fromAPIKey(e){if(typeof e!="string")throw new Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let t=await this.createGToken().getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};me.JWT=st});var ot=f($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.UserRefreshClient=$.USER_REFRESH_ACCOUNT_TYPE=void 0;var ls=M();$.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var it=class extends ls.OAuth2Client{constructor(e,t,r,s,n){let o=e&&typeof e=="object"?e:{clientId:e,clientSecret:t,refreshToken:r,eagerRefreshThresholdMillis:s,forceRefreshOnFailure:n};super(o),this._refreshToken=o.refreshToken,this.credentials.refresh_token=o.refreshToken}async refreshTokenNoCache(e){return super.refreshTokenNoCache(this._refreshToken)}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the user refresh token");if(e.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}async fromStreamAsync(e){return new Promise((t,r)=>{if(!e)return r(new Error("Must pass in a stream containing the user refresh token."));let s="";e.setEncoding("utf8").on("error",r).on("data",n=>s+=n).on("end",()=>{try{let n=JSON.parse(s);return this.fromJSON(n),t()}catch(n){return r(n)}})})}};$.UserRefreshClient=it});var ct=f(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.Impersonated=B.IMPERSONATED_ACCOUNT_TYPE=void 0;var er=M(),hs=p("gaxios");B.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var at=class extends er.OAuth2Client{constructor(e={}){var t,r,s,n,o,a;super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=(t=e.sourceClient)!==null&&t!==void 0?t:new er.OAuth2Client,this.targetPrincipal=(r=e.targetPrincipal)!==null&&r!==void 0?r:"",this.delegates=(s=e.delegates)!==null&&s!==void 0?s:[],this.targetScopes=(n=e.targetScopes)!==null&&n!==void 0?n:[],this.lifetime=(o=e.lifetime)!==null&&o!==void 0?o:3600,this.endpoint=(a=e.endpoint)!==null&&a!==void 0?a:"https://iamcredentials.googleapis.com"}async refreshToken(e){var t,r,s,n,o,a;try{await this.sourceClient.getAccessToken();let c="projects/-/serviceAccounts/"+this.targetPrincipal,l=`${this.endpoint}/v1/${c}:generateAccessToken`,h={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},d=await this.sourceClient.request({url:l,data:h,method:"POST"}),k=d.data;return this.credentials.access_token=k.accessToken,this.credentials.expiry_date=Date.parse(k.expireTime),{tokens:this.credentials,res:d}}catch(c){if(!(c instanceof Error))throw c;let l=0,h="";throw c instanceof hs.GaxiosError&&(l=(s=(r=(t=c?.response)===null||t===void 0?void 0:t.data)===null||r===void 0?void 0:r.error)===null||s===void 0?void 0:s.status,h=(a=(o=(n=c?.response)===null||n===void 0?void 0:n.data)===null||o===void 0?void 0:o.error)===null||a===void 0?void 0:a.message),l&&h?(c.message=`${l}: unable to impersonate: ${h}`,c):(c.message=`unable to impersonate: ${c}`,c)}}async fetchIdToken(e,t){var r;await this.sourceClient.getAccessToken();let s=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${s}:generateIdToken`,o={delegates:this.delegates,audience:e,includeEmail:(r=t?.includeEmail)!==null&&r!==void 0?r:!0};return(await this.sourceClient.request({url:n,data:o,method:"POST"})).data.token}};B.Impersonated=at});var lt=f(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.getErrorFromOAuthErrorResponse=J.OAuthClientAuthHandler=void 0;var tr=p("querystring"),ds=F(),fs=["PUT","POST","PATCH"],ut=class{constructor(e){this.clientAuthentication=e,this.crypto=(0,ds.createCrypto)()}applyClientAuthenticationOptions(e,t){this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){var r;if(t)e.headers=e.headers||{},Object.assign(e.headers,{Authorization:`Bearer ${t}}`});else if(((r=this.clientAuthentication)===null||r===void 0?void 0:r.confidentialClientType)==="basic"){e.headers=e.headers||{};let s=this.clientAuthentication.clientId,n=this.clientAuthentication.clientSecret||"",o=this.crypto.encodeBase64StringUtf8(`${s}:${n}`);Object.assign(e.headers,{Authorization:`Basic ${o}`})}}injectAuthenticatedRequestBody(e){var t;if(((t=this.clientAuthentication)===null||t===void 0?void 0:t.confidentialClientType)==="request-body"){let r=(e.method||"GET").toUpperCase();if(fs.indexOf(r)!==-1){let s,n=e.headers||{};for(let o in n)if(o.toLowerCase()==="content-type"&&n[o]){s=n[o].toLowerCase();break}if(s==="application/x-www-form-urlencoded"){e.data=e.data||"";let o=tr.parse(e.data);Object.assign(o,{client_id:this.clientAuthentication.clientId,client_secret:this.clientAuthentication.clientSecret||""}),e.data=tr.stringify(o)}else if(s==="application/json")e.data=e.data||{},Object.assign(e.data,{client_id:this.clientAuthentication.clientId,client_secret:this.clientAuthentication.clientSecret||""});else throw new Error(`${s} content-types are not supported with ${this.clientAuthentication.confidentialClientType} client authentication`)}else throw new Error(`${r} HTTP method does not support ${this.clientAuthentication.confidentialClientType} client authentication`)}}};J.OAuthClientAuthHandler=ut;function ps(i,e){let t=i.error,r=i.error_description,s=i.error_uri,n=`Error code ${t}`;typeof r<"u"&&(n+=`: ${r}`),typeof s<"u"&&(n+=` - ${s}`);let o=new Error(n);if(e){let a=Object.keys(e);e.stack&&a.push("stack"),a.forEach(c=>{c!=="message"&&Object.defineProperty(o,c,{value:e[c],writable:!1,enumerable:!0})})}return o}J.getErrorFromOAuthErrorResponse=ps});var dt=f(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.StsCredentials=void 0;var _s=p("gaxios"),gs=p("querystring"),ys=Q(),rr=lt(),ht=class extends rr.OAuthClientAuthHandler{constructor(e,t){super(t),this.tokenExchangeEndpoint=e,this.transporter=new ys.DefaultTransporter}async exchangeToken(e,t,r){var s,n,o;let a={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:(s=e.scope)===null||s===void 0?void 0:s.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:(n=e.actingParty)===null||n===void 0?void 0:n.actorToken,actor_token_type:(o=e.actingParty)===null||o===void 0?void 0:o.actorTokenType,options:r&&JSON.stringify(r)};Object.keys(a).forEach(h=>{typeof a[h]>"u"&&delete a[h]});let c={"Content-Type":"application/x-www-form-urlencoded"};Object.assign(c,t||{});let l={url:this.tokenExchangeEndpoint,method:"POST",headers:c,data:gs.stringify(a),responseType:"json"};this.applyClientAuthenticationOptions(l);try{let h=await this.transporter.request(l),d=h.data;return d.res=h,d}catch(h){throw h instanceof _s.GaxiosError&&h.response?(0,rr.getErrorFromOAuthErrorResponse)(h.response.data,h):h}}};Ee.StsCredentials=ht});var P=f(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.BaseExternalAccountClient=y.DEFAULT_UNIVERSE=y.CLOUD_RESOURCE_MANAGER=y.EXTERNAL_ACCOUNT_TYPE=y.EXPIRATION_TIME_OFFSET=void 0;var ms=p("stream"),Es=q(),As=dt(),sr=Z(),ws="urn:ietf:params:oauth:grant-type:token-exchange",Ts="urn:ietf:params:oauth:token-type:access_token",ft="https://www.googleapis.com/auth/cloud-platform",Cs=3600;y.EXPIRATION_TIME_OFFSET=5*60*1e3;y.EXTERNAL_ACCOUNT_TYPE="external_account";y.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var ks="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",vs=He(),Ss=q();Object.defineProperty(y,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return Ss.DEFAULT_UNIVERSE}});var pt=class extends Es.AuthClient{constructor(e,t){super({...e,...t});let r=(0,sr.originalOrCamelOptions)(e);if(r.get("type")!==y.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${y.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let s=r.get("client_id"),n=r.get("client_secret"),o=r.get("token_url"),a=r.get("subject_token_type"),c=r.get("workforce_pool_user_project"),l=r.get("service_account_impersonation_url"),h=r.get("service_account_impersonation"),d=(0,sr.originalOrCamelOptions)(h).get("token_lifetime_seconds");s&&(this.clientAuth={confidentialClientType:"basic",clientId:s,clientSecret:n}),this.stsCredential=new As.StsCredentials(o,this.clientAuth),this.scopes=[ft],this.cachedAccessToken=null,this.audience=r.get("audience"),this.subjectTokenType=a,this.workforcePoolUserProject=c;let k=new RegExp(ks);if(this.workforcePoolUserProject&&!this.audience.match(k))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=l,this.serviceAccountImpersonationLifetime=d,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=Cs),this.projectNumber=this.getProjectNumber(this.audience)}getServiceAccountEmail(){var e;if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let r=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return((e=r?.groups)===null||e===void 0?void 0:e.email)||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let t={Authorization:`Bearer ${(await this.getAccessToken()).token}`};return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(r=>t(null,r),r=>t(r,r.response));else return this.requestAsync(e)}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),r=await this.transporter.request({headers:t,url:`${y.CLOUD_RESOURCE_MANAGER}${e}`,responseType:"json"});return this.projectId=r.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let r;try{let s=await this.getRequestHeaders();e.headers=e.headers||{},s&&s["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=s["x-goog-user-project"]),s&&s.Authorization&&(e.headers.Authorization=s.Authorization),r=await this.transporter.request(e)}catch(s){let n=s.response;if(n){let o=n.status,a=n.config.data instanceof ms.Readable;if(!t&&(o===401||o===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return r}async refreshAccessTokenAsync(){let e=await this.retrieveSubjectToken(),t={grantType:ws,audience:this.audience,requestedTokenType:Ts,subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[ft]:this.getScopesArray()},r=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,s={"x-goog-api-client":this.getMetricsHeaderValue()},n=await this.stsCredential.exchangeToken(t,s,r);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(n.access_token):n.expires_in?this.cachedAccessToken={access_token:n.access_token,expiry_date:new Date().getTime()+n.expires_in*1e3,res:n.res}:this.cachedAccessToken={access_token:n.access_token,res:n.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"},responseType:"json"},r=await this.transporter.request(t),s=r.data;return{access_token:s.accessToken,expiry_date:new Date(s.expireTime).getTime(),res:r}}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:typeof this.scopes>"u"?[ft]:this.scopes}getMetricsHeaderValue(){let e=__Process$.version.replace(/^v/,""),t=this.serviceAccountImpersonationUrl!==void 0,r=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${vs.version} google-byoid-sdk source/${r} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}};y.BaseExternalAccountClient=pt});var Tt=f(Ae=>{"use strict";var _t,gt,yt;Object.defineProperty(Ae,"__esModule",{value:!0});Ae.IdentityPoolClient=void 0;var At=p("fs"),wt=p("util"),Os=P(),mt=Z(),bs=(0,wt.promisify)((_t=At.readFile)!==null&&_t!==void 0?_t:()=>{}),xs=(0,wt.promisify)((gt=At.realpath)!==null&&gt!==void 0?gt:()=>{}),Rs=(0,wt.promisify)((yt=At.lstat)!==null&&yt!==void 0?yt:()=>{}),Et=class extends Os.BaseExternalAccountClient{constructor(e,t){super(e,t);let s=(0,mt.originalOrCamelOptions)(e).get("credential_source"),n=(0,mt.originalOrCamelOptions)(s);if(this.file=n.get("file"),this.url=n.get("url"),this.headers=n.get("headers"),this.file&&this.url)throw new Error('No valid Identity Pool "credential_source" provided, must be either file or url.');if(this.file&&!this.url)this.credentialSourceType="file";else if(!this.file&&this.url)this.credentialSourceType="url";else throw new Error('No valid Identity Pool "credential_source" provided, must be either file or url.');let o=(0,mt.originalOrCamelOptions)(n.get("format"));if(this.formatType=o.get("type")||"text",this.formatSubjectTokenFieldName=o.get("subject_token_field_name"),this.formatType!=="json"&&this.formatType!=="text")throw new Error(`Invalid credential_source format "${this.formatType}"`);if(this.formatType==="json"&&!this.formatSubjectTokenFieldName)throw new Error("Missing subject_token_field_name for JSON credential_source format")}async retrieveSubjectToken(){return this.file?await this.getTokenFromFile(this.file,this.formatType,this.formatSubjectTokenFieldName):await this.getTokenFromUrl(this.url,this.formatType,this.formatSubjectTokenFieldName,this.headers)}async getTokenFromFile(e,t,r){try{if(e=await xs(e),!(await Rs(e)).isFile())throw new Error}catch(o){throw o instanceof Error&&(o.message=`The file at ${e} does not exist, or it is not a file. ${o.message}`),o}let s,n=await bs(e,{encoding:"utf8"});if(t==="text"?s=n:t==="json"&&r&&(s=JSON.parse(n)[r]),!s)throw new Error("Unable to parse the subject_token from the credential_source file");return s}async getTokenFromUrl(e,t,r,s){let n={url:e,method:"GET",headers:s,responseType:t},o;if(t==="text"?o=(await this.transporter.request(n)).data:t==="json"&&r&&(o=(await this.transporter.request(n)).data[r]),!o)throw new Error("Unable to parse the subject_token from the credential_source URL");return o}};Ae.IdentityPoolClient=Et});var or=f(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.AwsRequestSigner=void 0;var ir=F(),nr="AWS4-HMAC-SHA256",Is="aws4_request",Ct=class{constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,ir.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new Error('"url" is required in "amzOptions"');let t=typeof e.data=="object"?JSON.stringify(e.data):e.data,r=e.url,s=e.method||"GET",n=e.body||t,o=e.headers,a=await this.getCredentials(),c=new URL(r),l=await Ns({crypto:this.crypto,host:c.host,canonicalUri:c.pathname,canonicalQuerystring:c.search.substr(1),method:s,region:this.region,securityCredentials:a,requestPayload:n,additionalAmzHeaders:o}),h=Object.assign(l.amzDate?{"x-amz-date":l.amzDate}:{},{Authorization:l.authorizationHeader,host:c.host},o||{});a.token&&Object.assign(h,{"x-amz-security-token":a.token});let d={url:r,method:s,headers:h};return typeof n<"u"&&(d.body=n),d}};we.AwsRequestSigner=Ct;async function te(i,e,t){return await i.signWithHmacSha256(e,t)}async function Ps(i,e,t,r,s){let n=await te(i,`AWS4${e}`,t),o=await te(i,n,r),a=await te(i,o,s);return await te(i,a,"aws4_request")}async function Ns(i){let e=i.additionalAmzHeaders||{},t=i.requestPayload||"",r=i.host.split(".")[0],s=new Date,n=s.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),o=s.toISOString().replace(/[-]/g,"").replace(/T.*/,""),a={};Object.keys(e).forEach(g=>{a[g.toLowerCase()]=e[g]}),i.securityCredentials.token&&(a["x-amz-security-token"]=i.securityCredentials.token);let c=Object.assign({host:i.host},a.date?{}:{"x-amz-date":n},a),l="",h=Object.keys(c).sort();h.forEach(g=>{l+=`${g}:${c[g]}
`});let d=h.join(";"),k=await i.crypto.sha256DigestHex(t),X=`${i.method}
${i.canonicalUri}
${i.canonicalQuerystring}
${l}
${d}
${k}`,b=`${o}/${i.region}/${r}/${Is}`,Y=`${nr}
${n}
${b}
`+await i.crypto.sha256DigestHex(X),U=await Ps(i.crypto,i.securityCredentials.secretAccessKey,o,i.region,r),oe=await te(i.crypto,U,Y),ae=`${nr} Credential=${i.securityCredentials.accessKeyId}/${b}, SignedHeaders=${d}, Signature=${(0,ir.fromArrayBufferToHex)(oe)}`;return{amzDate:a.date?void 0:n,authorizationHeader:ae,canonicalQuerystring:i.canonicalQuerystring}}});var kt=f(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.AwsClient=void 0;var Us=or(),js=P(),re=class extends js.BaseExternalAccountClient{constructor(e,t){super(e,t),this.environmentId=e.credential_source.environment_id,this.regionUrl=e.credential_source.region_url,this.securityCredentialsUrl=e.credential_source.url,this.regionalCredVerificationUrl=e.credential_source.regional_cred_verification_url,this.imdsV2SessionTokenUrl=e.credential_source.imdsv2_session_token_url,this.awsRequestSigner=null,this.region="",this.credentialSourceType="aws",this.validateEnvironmentId()}validateEnvironmentId(){var e;let t=(e=this.environmentId)===null||e===void 0?void 0:e.match(/^(aws)(\d+)$/);if(!t||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(t[2],10)!==1)throw new Error(`aws version "${t[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){if(!this.awsRequestSigner){let s={};this.shouldUseMetadataServer()&&this.imdsV2SessionTokenUrl&&(s["x-aws-ec2-metadata-token"]=await this.getImdsV2SessionToken()),this.region=await this.getAwsRegion(s),this.awsRequestSigner=new Us.AwsRequestSigner(async()=>{if(this.securityCredentialsFromEnv)return this.securityCredentialsFromEnv;let n=await this.getAwsRoleName(s),o=await this.getAwsSecurityCredentials(n,s);return{accessKeyId:o.AccessKeyId,secretAccessKey:o.SecretAccessKey,token:o.Token}},this.region)}let e=await this.awsRequestSigner.getRequestOptions({url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[],r=Object.assign({"x-goog-cloud-target-resource":this.audience},e.headers);for(let s in r)t.push({key:s,value:r[s]});return encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}async getImdsV2SessionToken(){let e={url:this.imdsV2SessionTokenUrl,method:"PUT",responseType:"text",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return(await this.transporter.request(e)).data}async getAwsRegion(e){if(this.regionFromEnv)return this.regionFromEnv;if(!this.regionUrl)throw new Error('Unable to determine AWS region due to missing "options.credential_source.region_url"');let t={url:this.regionUrl,method:"GET",responseType:"text",headers:e},r=await this.transporter.request(t);return r.data.substr(0,r.data.length-1)}async getAwsRoleName(e){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let t={url:this.securityCredentialsUrl,method:"GET",responseType:"text",headers:e};return(await this.transporter.request(t)).data}async getAwsSecurityCredentials(e,t){return(await this.transporter.request({url:`${this.securityCredentialsUrl}/${e}`,responseType:"json",headers:t})).data}shouldUseMetadataServer(){return!this.regionFromEnv||!this.securityCredentialsFromEnv}get regionFromEnv(){return __Process$.env.AWS_REGION||__Process$.env.AWS_DEFAULT_REGION||null}get securityCredentialsFromEnv(){return __Process$.env.AWS_ACCESS_KEY_ID&&__Process$.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:__Process$.env.AWS_ACCESS_KEY_ID,secretAccessKey:__Process$.env.AWS_SECRET_ACCESS_KEY,token:__Process$.env.AWS_SESSION_TOKEN}:null}};Te.AwsClient=re;re.AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";re.AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254"});var xt=f(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.InvalidSubjectTokenError=_.InvalidMessageFieldError=_.InvalidCodeFieldError=_.InvalidTokenTypeFieldError=_.InvalidExpirationTimeFieldError=_.InvalidSuccessFieldError=_.InvalidVersionFieldError=_.ExecutableResponseError=_.ExecutableResponse=void 0;var Ce="urn:ietf:params:oauth:token-type:saml2",vt="urn:ietf:params:oauth:token-type:id_token",St="urn:ietf:params:oauth:token-type:jwt",Ot=class{constructor(e){if(!e.version)throw new ke("Executable response must contain a 'version' field.");if(e.success===void 0)throw new ve("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==Ce&&this.tokenType!==vt&&this.tokenType!==St)throw new Se(`Executable response must contain a 'token_type' field when successful and it must be one of ${vt}, ${St}, or ${Ce}.`);if(this.tokenType===Ce){if(!e.saml_response)throw new se(`Executable response must contain a 'saml_response' field when token_type=${Ce}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new se(`Executable response must contain a 'id_token' field when token_type=${vt} or ${St}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new Oe("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new be("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};_.ExecutableResponse=Ot;var T=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};_.ExecutableResponseError=T;var ke=class extends T{};_.InvalidVersionFieldError=ke;var ve=class extends T{};_.InvalidSuccessFieldError=ve;var bt=class extends T{};_.InvalidExpirationTimeFieldError=bt;var Se=class extends T{};_.InvalidTokenTypeFieldError=Se;var Oe=class extends T{};_.InvalidCodeFieldError=Oe;var be=class extends T{};_.InvalidMessageFieldError=be;var se=class extends T{};_.InvalidSubjectTokenError=se});var ar=f(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.PluggableAuthHandler=void 0;var qs=Re(),L=xt(),Ms=p("child_process"),Rt=p("fs"),It=class i{constructor(e){if(!e.command)throw new Error("No command provided.");if(this.commandComponents=i.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,r)=>{let s=Ms.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...__Process$.env,...Object.fromEntries(e)}}),n="";s.stdout.on("data",a=>{n+=a}),s.stderr.on("data",a=>{n+=a});let o=setTimeout(()=>(s.removeAllListeners(),s.kill(),r(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);s.on("close",a=>{if(clearTimeout(o),a===0)try{let c=JSON.parse(n),l=new L.ExecutableResponse(c);return t(l)}catch(c){return c instanceof L.ExecutableResponseError?r(c):r(new L.ExecutableResponseError(`The executable returned an invalid response: ${n}`))}else return r(new qs.ExecutableError(n,a.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await Rt.promises.realpath(this.outputFile)}catch{return}if(!(await Rt.promises.lstat(e)).isFile())return;let t=await Rt.promises.readFile(e,{encoding:"utf8"});if(t!=="")try{let r=JSON.parse(t);return new L.ExecutableResponse(r).isValid()?new L.ExecutableResponse(r):void 0}catch(r){throw r instanceof L.ExecutableResponseError?r:new L.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let r=0;r<t.length;r++)t[r][0]==='"'&&t[r].slice(-1)==='"'&&(t[r]=t[r].slice(1,-1));return t}};xe.PluggableAuthHandler=It});var Re=f(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.PluggableAuthClient=K.ExecutableError=void 0;var Ls=P(),Ds=xt(),Fs=ar(),Ie=class extends Error{constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}};K.ExecutableError=Ie;var Gs=30*1e3,cr=5*1e3,ur=120*1e3,Hs="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",lr=1,Pt=class extends Ls.BaseExternalAccountClient{constructor(e,t){if(super(e,t),!e.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=e.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(e.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=Gs;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<cr||this.timeoutMillis>ur)throw new Error(`Timeout must be between ${cr} and ${ur} milliseconds.`);this.outputFile=e.credential_source.executable.output_file,this.handler=new Fs.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(__Process$.env[Hs]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let e;if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let r=this.getServiceAccountEmail();r&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",r),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>lr)throw new Error(`Version of executable is not currently supported, maximum supported version is ${lr}.`);if(!e.success)throw new Ie(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new Ds.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw new Error("Executable response is expired.");return e.subjectToken}};K.PluggableAuthClient=Pt});var Ut=f(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.ExternalAccountClient=void 0;var $s=P(),Bs=Tt(),Js=kt(),Ks=Re(),Nt=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e,t){var r,s;return e&&e.type===$s.EXTERNAL_ACCOUNT_TYPE?!((r=e.credential_source)===null||r===void 0)&&r.environment_id?new Js.AwsClient(e,t):!((s=e.credential_source)===null||s===void 0)&&s.executable?new Ks.PluggableAuthClient(e,t):new Bs.IdentityPoolClient(e,t):null}};Pe.ExternalAccountClient=Nt});var dr=f(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.ExternalAccountAuthorizedUserClient=W.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var Ws=q(),hr=lt(),zs=p("gaxios"),Vs=p("stream"),Xs=P();W.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var jt=class extends hr.OAuthClientAuthHandler{constructor(e,t,r){super(r),this.url=e,this.transporter=t}async refreshToken(e,t){let r=new URLSearchParams({grant_type:"refresh_token",refresh_token:e}),s={"Content-Type":"application/x-www-form-urlencoded",...t},n={url:this.url,method:"POST",headers:s,data:r.toString(),responseType:"json"};this.applyClientAuthenticationOptions(n);try{let o=await this.transporter.request(n),a=o.data;return a.res=o,a}catch(o){throw o instanceof zs.GaxiosError&&o.response?(0,hr.getErrorFromOAuthErrorResponse)(o.response.data,o):o}}},qt=class extends Ws.AuthClient{constructor(e,t){super({...e,...t}),this.refreshToken=e.refresh_token;let r={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new jt(e.token_url,this.transporter,r),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,typeof t?.eagerRefreshThresholdMillis!="number"?this.eagerRefreshThresholdMillis=Xs.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!t?.forceRefreshOnFailure,e.universe_domain&&(this.universeDomain=e.universe_domain)}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let t={Authorization:`Bearer ${(await this.getAccessToken()).token}`};return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(r=>t(null,r),r=>t(r,r.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let r;try{let s=await this.getRequestHeaders();e.headers=e.headers||{},s&&s["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=s["x-goog-user-project"]),s&&s.Authorization&&(e.headers.Authorization=s.Authorization),r=await this.transporter.request(e)}catch(s){let n=s.response;if(n){let o=n.status,a=n.config.data instanceof Vs.Readable;if(!t&&(o===401||o===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return r}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+e.expires_in*1e3,res:e.res},e.refresh_token!==void 0&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};W.ExternalAccountAuthorizedUserClient=qt});var _r=f(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.GoogleAuth=V.CLOUD_SDK_CLIENT_ID=void 0;var Ys=p("child_process"),ne=p("fs"),Ne=p("gcp-metadata"),Qs=p("os"),Mt=p("path"),Zs=F(),en=Q(),tn=Ye(),rn=Ze(),sn=et(),z=nt(),Lt=ot(),Ue=ct(),nn=Ut(),ie=P(),fr=dr();V.CLOUD_SDK_CLIENT_ID="764086051850-6qr4p6gpi6hn506pt8ejuq83di341hur.apps.googleusercontent.com";var pr={NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`},je=class{get isGCE(){return this.checkIsGCE}constructor(e){this.checkIsGCE=void 0,this.jsonContent=null,this.cachedCredential=null,e=e||{},this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.jsonContent=e.credentials||null,this.clientOptions=e.clientOptions}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(t=>e(null,t),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===pr.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||(e=await this.getProductionProjectId()),e||(e=await this.getFileProjectId()),e||(e=await this.getDefaultServiceProjectId()),e||(e=await this.getGCEProjectId()),e||(e=await this.getExternalAccountClientProjectId()),e)return this._cachedProjectId=e,e;throw new Error(pr.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let r;if(typeof e=="function"?t=e:r=e,t)this.getApplicationDefaultAsync(r).then(s=>t(null,s.credential,s.projectId),t);else return this.getApplicationDefaultAsync(r)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await this.prepareAndCacheADC(this.cachedCredential);let t=__Process$.env.GOOGLE_CLOUD_QUOTA_PROJECT,r;if(r=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),r)return r instanceof z.JWT?r.scopes=this.scopes:r instanceof ie.BaseExternalAccountClient&&(r.scopes=this.getAnyScopes()),await this.prepareAndCacheADC(r,t);if(r=await this._tryGetApplicationCredentialsFromWellKnownFile(e),r)return r instanceof z.JWT?r.scopes=this.scopes:r instanceof ie.BaseExternalAccountClient&&(r.scopes=this.getAnyScopes()),await this.prepareAndCacheADC(r,t);let s;try{s=await this._checkIsGCE()}catch(n){throw n instanceof Error&&(n.message=`Unexpected error determining execution environment: ${n.message}`),n}if(!s)throw new Error("Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.");return e.scopes=this.getAnyScopes(),await this.prepareAndCacheADC(new tn.Compute(e),t)}async prepareAndCacheADC(e,t){let r=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:r}}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=Ne.getGCPResidency()||await Ne.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=__Process$.env.GOOGLE_APPLICATION_CREDENTIALS||__Process$.env.google_application_credentials;if(!t||t.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(r){throw r instanceof Error&&(r.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${r.message}`),r}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=__Process$.env.APPDATA;else{let s=__Process$.env.HOME;s&&(t=Mt.join(s,".config"))}return t&&(t=Mt.join(t,"gcloud","application_default_credentials.json"),ne.existsSync(t)||(t=null)),t?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=ne.realpathSync(e),!ne.lstatSync(e).isFile())throw new Error}catch(s){throw s instanceof Error&&(s.message=`The file at ${e} does not exist, or it is not a file. ${s.message}`),s}let r=ne.createReadStream(e);return this.fromStream(r,t)}fromImpersonatedJSON(e){var t,r,s,n,o;if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==Ue.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${Ue.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let a=new Lt.UserRefreshClient(e.source_credentials.client_id,e.source_credentials.client_secret,e.source_credentials.refresh_token);if(((t=e.service_account_impersonation_url)===null||t===void 0?void 0:t.length)>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let c=(s=(r=/(?<target>[^/]+):generateAccessToken$/.exec(e.service_account_impersonation_url))===null||r===void 0?void 0:r.groups)===null||s===void 0?void 0:s.target;if(!c)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let l=(n=this.getAnyScopes())!==null&&n!==void 0?n:[];return new Ue.Impersonated({delegates:(o=e.delegates)!==null&&o!==void 0?o:[],sourceClient:a,targetPrincipal:c,targetScopes:Array.isArray(l)?l:[l]})}fromJSON(e,t={}){let r;return e.type===Lt.USER_REFRESH_ACCOUNT_TYPE?(r=new Lt.UserRefreshClient(t),r.fromJSON(e)):e.type===Ue.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===ie.EXTERNAL_ACCOUNT_TYPE?(r=nn.ExternalAccountClient.fromJSON(e,t),r.scopes=this.getAnyScopes()):e.type===fr.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new fr.ExternalAccountAuthorizedUserClient(e,t):(t.scopes=this.scopes,r=new z.JWT(t),this.setGapicJWTValues(r),r.fromJSON(e)),r}_cacheClientFromJSON(e,t){let r=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,t={},r){let s={};if(typeof t=="function"?r=t:s=t,r)this.fromStreamAsync(e,s).then(n=>r(null,n),r);else return this.fromStreamAsync(e,s)}fromStreamAsync(e,t){return new Promise((r,s)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let n="";e.setEncoding("utf8").on("error",s).on("data",o=>n+=o).on("end",()=>{try{try{let o=JSON.parse(n),a=this._cacheClientFromJSON(o,t);return r(a)}catch(o){if(!this.keyFilename)throw o;let a=new z.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=a,this.setGapicJWTValues(a),r(a)}}catch(o){return s(o)}})})}fromAPIKey(e,t){t=t||{};let r=new z.JWT(t);return r.fromAPIKey(e),r}_isWindows(){let e=Qs.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,Ys.exec)("gcloud config config-helper --format json",(t,r)=>{if(!t&&r)try{let s=JSON.parse(r).configuration.properties.core.project;e(s);return}catch{}e(null)})})}getProductionProjectId(){return __Process$.env.GCLOUD_PROJECT||__Process$.env.GOOGLE_CLOUD_PROJECT||__Process$.env.gcloud_project||__Process$.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let t=await this.getClient();if(t&&t.projectId)return t.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==ie.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await Ne.project("project-id")}catch{return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(t=>e(null,t),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof ie.BaseExternalAccountClient){let s=e.getServiceAccountEmail();if(s)return{client_email:s}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key};if(!await this._checkIsGCE())throw new Error("Unknown error.");let r=await Ne.instance({property:"service-accounts/",params:{recursive:"true"}});if(!r||!r.default||!r.default.email)throw new Error("Failure from metadata server.");return{client_email:r.default.email}}async getClient(){if(!this.cachedCredential)if(this.jsonContent)this._cacheClientFromJSON(this.jsonContent,this.clientOptions);else if(this.keyFilename){let e=Mt.resolve(this.keyFilename),t=ne.createReadStream(e);await this.fromStreamAsync(t,this.clientOptions)}else await this.getApplicationDefaultAsync(this.clientOptions);return this.cachedCredential}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new rn.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e){e=e||{};let t=e.url||e.uri,s=await(await this.getClient()).getRequestHeaders(t);return e.headers=Object.assign(e.headers||{},s),e}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,sn.getEnv)()}async sign(e){let t=await this.getClient(),r=(0,Zs.createCrypto)();if(t instanceof z.JWT&&t.key)return await r.sign(t.key,e);let s=await this.getCredentials();if(!s.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(r,s.client_email,e)}async signBlob(e,t,r){let s=`https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/${t}:signBlob`;return(await this.request({method:"POST",url:s,data:{payload:e.encodeBase64StringUtf8(r)}})).data.signedBlob}};V.GoogleAuth=je;je.DefaultTransporter=en.DefaultTransporter});var gr=f(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.IAMAuth=void 0;var Dt=class{constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};qe.IAMAuth=Dt});var yr=f(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.DownscopedClient=C.EXPIRATION_TIME_OFFSET=C.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var on=p("stream"),an=q(),cn=dt(),un="urn:ietf:params:oauth:grant-type:token-exchange",ln="urn:ietf:params:oauth:token-type:access_token",hn="urn:ietf:params:oauth:token-type:access_token",dn="https://sts.googleapis.com/v1/token";C.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;C.EXPIRATION_TIME_OFFSET=5*60*1e3;var Ft=class extends an.AuthClient{constructor(e,t,r,s){if(super({...r,quotaProjectId:s}),this.authClient=e,this.credentialAccessBoundary=t,t.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(t.accessBoundary.accessBoundaryRules.length>C.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${C.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let n of t.accessBoundary.accessBoundaryRules)if(n.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new cn.StsCredentials(dn),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let t={Authorization:`Bearer ${(await this.getAccessToken()).token}`};return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(r=>t(null,r),r=>t(r,r.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let r;try{let s=await this.getRequestHeaders();e.headers=e.headers||{},s&&s["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=s["x-goog-user-project"]),s&&s.Authorization&&(e.headers.Authorization=s.Authorization),r=await this.transporter.request(e)}catch(s){let n=s.response;if(n){let o=n.status,a=n.config.data instanceof on.Readable;if(!t&&(o===401||o===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return r}async refreshAccessTokenAsync(){var e;let t=(await this.authClient.getAccessToken()).token,r={grantType:un,requestedTokenType:ln,subjectToken:t,subjectTokenType:hn},s=await this.stsCredential.exchangeToken(r,void 0,this.credentialAccessBoundary),n=((e=this.authClient.credentials)===null||e===void 0?void 0:e.expiry_date)||null,o=s.expires_in?new Date().getTime()+s.expires_in*1e3:n;return this.cachedDownscopedAccessToken={access_token:s.access_token,expiry_date:o,res:s.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};C.DownscopedClient=Ft});var Gt=f(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.GoogleAuth=u.auth=u.DefaultTransporter=u.PluggableAuthClient=u.DownscopedClient=u.BaseExternalAccountClient=u.ExternalAccountClient=u.IdentityPoolClient=u.AwsClient=u.UserRefreshClient=u.LoginTicket=u.OAuth2Client=u.CodeChallengeMethod=u.Impersonated=u.JWT=u.JWTAccess=u.IdTokenClient=u.IAMAuth=u.GCPEnv=u.Compute=u.AuthClient=u.gcpMetadata=void 0;var mr=_r();Object.defineProperty(u,"GoogleAuth",{enumerable:!0,get:function(){return mr.GoogleAuth}});u.gcpMetadata=p("gcp-metadata");var fn=q();Object.defineProperty(u,"AuthClient",{enumerable:!0,get:function(){return fn.AuthClient}});var pn=Ye();Object.defineProperty(u,"Compute",{enumerable:!0,get:function(){return pn.Compute}});var _n=et();Object.defineProperty(u,"GCPEnv",{enumerable:!0,get:function(){return _n.GCPEnv}});var gn=gr();Object.defineProperty(u,"IAMAuth",{enumerable:!0,get:function(){return gn.IAMAuth}});var yn=Ze();Object.defineProperty(u,"IdTokenClient",{enumerable:!0,get:function(){return yn.IdTokenClient}});var mn=rt();Object.defineProperty(u,"JWTAccess",{enumerable:!0,get:function(){return mn.JWTAccess}});var En=nt();Object.defineProperty(u,"JWT",{enumerable:!0,get:function(){return En.JWT}});var An=ct();Object.defineProperty(u,"Impersonated",{enumerable:!0,get:function(){return An.Impersonated}});var Er=M();Object.defineProperty(u,"CodeChallengeMethod",{enumerable:!0,get:function(){return Er.CodeChallengeMethod}});Object.defineProperty(u,"OAuth2Client",{enumerable:!0,get:function(){return Er.OAuth2Client}});var wn=ze();Object.defineProperty(u,"LoginTicket",{enumerable:!0,get:function(){return wn.LoginTicket}});var Tn=ot();Object.defineProperty(u,"UserRefreshClient",{enumerable:!0,get:function(){return Tn.UserRefreshClient}});var Cn=kt();Object.defineProperty(u,"AwsClient",{enumerable:!0,get:function(){return Cn.AwsClient}});var kn=Tt();Object.defineProperty(u,"IdentityPoolClient",{enumerable:!0,get:function(){return kn.IdentityPoolClient}});var vn=Ut();Object.defineProperty(u,"ExternalAccountClient",{enumerable:!0,get:function(){return vn.ExternalAccountClient}});var Sn=P();Object.defineProperty(u,"BaseExternalAccountClient",{enumerable:!0,get:function(){return Sn.BaseExternalAccountClient}});var On=yr();Object.defineProperty(u,"DownscopedClient",{enumerable:!0,get:function(){return On.DownscopedClient}});var bn=Re();Object.defineProperty(u,"PluggableAuthClient",{enumerable:!0,get:function(){return bn.PluggableAuthClient}});var xn=Q();Object.defineProperty(u,"DefaultTransporter",{enumerable:!0,get:function(){return xn.DefaultTransporter}});var Rn=new mr.GoogleAuth;u.auth=Rn});var N={};Or(N,{AuthClient:()=>Qn,AwsClient:()=>Fn,BaseExternalAccountClient:()=>Mn,CodeChallengeMethod:()=>Bn,Compute:()=>Yn,DefaultTransporter:()=>Un,DownscopedClient:()=>qn,ExternalAccountClient:()=>Ln,GCPEnv:()=>Xn,GoogleAuth:()=>Pn,IAMAuth:()=>Vn,IdTokenClient:()=>zn,IdentityPoolClient:()=>Dn,Impersonated:()=>Jn,JWT:()=>Kn,JWTAccess:()=>Wn,LoginTicket:()=>Hn,OAuth2Client:()=>$n,PluggableAuthClient:()=>jn,UserRefreshClient:()=>Gn,__esModule:()=>In,auth:()=>Nn,default:()=>ti,gcpMetadata:()=>Zn});var wr=Ht(Gt());j(N,Ht(Gt()));var{__esModule:In,GoogleAuth:Pn,auth:Nn,DefaultTransporter:Un,PluggableAuthClient:jn,DownscopedClient:qn,BaseExternalAccountClient:Mn,ExternalAccountClient:Ln,IdentityPoolClient:Dn,AwsClient:Fn,UserRefreshClient:Gn,LoginTicket:Hn,OAuth2Client:$n,CodeChallengeMethod:Bn,Impersonated:Jn,JWT:Kn,JWTAccess:Wn,IdTokenClient:zn,IAMAuth:Vn,GCPEnv:Xn,Compute:Yn,AuthClient:Qn,gcpMetadata:Zn}=wr,{default:Ar,...ei}=wr,ti=Ar!==void 0?Ar:ei;export{Qn as AuthClient,Fn as AwsClient,Mn as BaseExternalAccountClient,Bn as CodeChallengeMethod,Yn as Compute,Un as DefaultTransporter,qn as DownscopedClient,Ln as ExternalAccountClient,Xn as GCPEnv,Pn as GoogleAuth,Vn as IAMAuth,zn as IdTokenClient,Dn as IdentityPoolClient,Jn as Impersonated,Kn as JWT,Wn as JWTAccess,Hn as LoginTicket,$n as OAuth2Client,jn as PluggableAuthClient,Gn as UserRefreshClient,In as __esModule,Nn as auth,ti as default,Zn as gcpMetadata};
//# sourceMappingURL=google-auth-library.mjs.map