/* esm.sh - esbuild bundle(jws@4.0.0) denonext production */
import __Process$ from "node:process";
import * as __0$ from "/v135/safe-buffer@5.2.1/denonext/safe-buffer.mjs";
import * as __1$ from "/v135/safe-buffer@5.2.1/denonext/safe-buffer.mjs";
import * as __2$ from "/v135/jwa@2.0.0/denonext/jwa.mjs";
import * as __3$ from "node:stream";
import * as __4$ from "node:util";
import * as __5$ from "/v135/jwa@2.0.0/denonext/jwa.mjs";
import * as __6$ from "node:stream";
import * as __7$ from "node:util";
import * as __8$ from "node:buffer";
import * as __9$ from "/v135/safe-buffer@5.2.1/denonext/safe-buffer.mjs";
import * as __a$ from "node:stream";
import * as __b$ from "node:util";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"safe-buffer":return e(__0$);case"jwa":return e(__2$);case"stream":return e(__3$);case"util":return e(__4$);case"buffer":return e(__8$);default:throw new Error("module \""+n+"\" not found");}};
var Z=Object.create;var p=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var a=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var c=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),C=(e,r)=>{for(var t in r)p(e,t,{get:r[t],enumerable:!0})},b=(e,r,t,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of U(r))!$.call(e,n)&&n!==t&&p(e,n,{get:()=>r[n],enumerable:!(i=j(r,n))||i.enumerable});return e},u=(e,r,t)=>(b(e,r,"default"),t&&b(t,r,"default")),O=(e,r,t)=>(t=e!=null?Z(X(e)):{},b(r||!e||!e.__esModule?p(t,"default",{value:e,enumerable:!0}):t,e));var S=c((_e,_)=>{var l=a("safe-buffer").Buffer,Q=a("stream"),Y=a("util");function d(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=l.alloc(0),this;if(typeof e.pipe=="function")return this.buffer=l.alloc(0),e.pipe(this),this;if(e.length||typeof e=="object")return this.buffer=e,this.writable=!1,__Process$.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}Y.inherits(d,Q);d.prototype.write=function(r){this.buffer=l.concat([this.buffer,l.from(r)]),this.emit("data",r)};d.prototype.end=function(r){r&&this.write(r),this.emit("end",r),this.emit("close"),this.writable=!1,this.readable=!1};_.exports=d});var g=c((Je,J)=>{var ee=a("buffer").Buffer;J.exports=function(r){return typeof r=="string"?r:typeof r=="number"||ee.isBuffer(r)?r.toString():JSON.stringify(r)}});var R=c((Ve,H)=>{var re=a("safe-buffer").Buffer,V=S(),te=a("jwa"),ie=a("stream"),I=g(),w=a("util");function x(e,r){return re.from(e,r).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ae(e,r,t){t=t||"utf8";var i=x(I(e),"binary"),n=x(I(r),t);return w.format("%s.%s",i,n)}function B(e){var r=e.header,t=e.payload,i=e.secret||e.privateKey,n=e.encoding,m=te(r.alg),h=ae(r,t,n),z=m.sign(h,i);return w.format("%s.%s",h,z)}function y(e){var r=e.secret||e.privateKey||e.key,t=new V(r);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new V(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}w.inherits(y,ie);y.prototype.sign=function(){try{var r=B({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",r),this.emit("data",r),this.emit("end"),this.readable=!1,r}catch(t){this.readable=!1,this.emit("error",t),this.emit("close")}};y.sign=B;H.exports=y});var D=c((Ie,P)=>{var E=a("safe-buffer").Buffer,A=S(),ne=a("jwa"),se=a("stream"),K=g(),fe=a("util"),ue=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function oe(e){return Object.prototype.toString.call(e)==="[object Object]"}function ce(e){if(oe(e))return e;try{return JSON.parse(e)}catch{return}}function T(e){var r=e.split(".",1)[0];return ce(E.from(r,"base64").toString("binary"))}function he(e){return e.split(".",2).join(".")}function k(e){return e.split(".")[2]}function le(e,r){r=r||"utf8";var t=e.split(".")[1];return E.from(t,"base64").toString(r)}function G(e){return ue.test(e)&&!!T(e)}function M(e,r,t){if(!r){var i=new Error("Missing algorithm parameter for jws.verify");throw i.code="MISSING_ALGORITHM",i}e=K(e);var n=k(e),m=he(e),h=ne(r);return h.verify(m,n,t)}function W(e,r){if(r=r||{},e=K(e),!G(e))return null;var t=T(e);if(!t)return null;var i=le(e);return(t.typ==="JWT"||r.json)&&(i=JSON.parse(i,r.encoding)),{header:t,payload:i,signature:k(e)}}function o(e){e=e||{};var r=e.secret||e.publicKey||e.key,t=new A(r);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new A(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}fe.inherits(o,se);o.prototype.verify=function(){try{var r=M(this.signature.buffer,this.algorithm,this.key.buffer),t=W(this.signature.buffer,this.encoding);return this.emit("done",r,t),this.emit("data",r),this.emit("end"),this.readable=!1,r}catch(i){this.readable=!1,this.emit("error",i),this.emit("close")}};o.decode=W;o.isValid=G;o.verify=M;P.exports=o});var q=c(s=>{var F=R(),v=D(),de=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];s.ALGORITHMS=de;s.sign=F.sign;s.verify=v.verify;s.decode=v.decode;s.isValid=v.isValid;s.createSign=function(r){return new F(r)};s.createVerify=function(r){return new v(r)}});var f={};C(f,{ALGORITHMS:()=>ye,createSign:()=>Se,createVerify:()=>ge,decode:()=>be,default:()=>qe,isValid:()=>pe,sign:()=>ve,verify:()=>me});var N=O(q());u(f,O(q()));var{ALGORITHMS:ye,sign:ve,verify:me,decode:be,isValid:pe,createSign:Se,createVerify:ge}=N,{default:L,...we}=N,qe=L!==void 0?L:we;export{ye as ALGORITHMS,Se as createSign,ge as createVerify,be as decode,qe as default,pe as isValid,ve as sign,me as verify};
//# sourceMappingURL=jws.mjs.map